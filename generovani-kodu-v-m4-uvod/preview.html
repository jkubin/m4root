<!-- DO NOT EDIT! This file is generated automatically! -->
<!doctype html>
<html id="css" lang="cs">
<head>
<meta charset="utf-8">
<title>Generování kódu v M4: úvod</title>
<link rel="stylesheet" type="text/css" href="../html/root_cz.css">
<style>.m4-ev{background:#f5f5f5}.urs p[id$="-toc"]>a>b{font-weight:normal;margin-right:.6em}.urs a[id^="m4-ref"]{font-size:.65em;vertical-align:super}.m4-A .m4-a,.m4-B .m4-b,.m4-C .m4-c,.m4-D .m4-d,.m4-E .m4-e,.m4-F .m4-f,.m4-G .m4-g,.m4-dh{background:lawngreen}.m4-R .m4-r{background:gold}.m4-S .m4-s{font-weight:bold}.m4-X .m4-x{visibility:hidden}.urs q{font-style:initial}.urs q::before{content:"\201e"}.urs q::after{content:"\201c"}#m4--toc{position:relative}#m4--toc>div{position:absolute;right:0;top:0}#m4--toc>div>div{display:inline-block}.m4-dwnl a{margin-left:.4em}.m4-updt{color:#666;text-align:right;margin-left:.6em}.m4-ch,.m4-bh,.m4-cmd{position:relative}.m4-bh>a:first-child::before,.m4-ch>a:first-child::before{font-size:.9em;font-weight:normal;position:absolute;right:100%;width:1.3em}.m4-ch>a:first-child::before{content:"\2630"}.m4-ch>a:first-child+a{margin-right:.4em}.m4-ch>a:last-child::before,.m4-bh>a:last-child::before{content:"\1f845";font-size:.65em;margin-left:.3em;position:absolute}.m4-ch>a:first-child,.m4-ch>a:last-child,.m4-bh>a:first-child,.m4-bh>a:last-child{opacity:0}.m4-ch:hover>a:first-child,.m4-ch:hover>a:last-child,.m4-bh:hover>a:first-child,.m4-bh:hover>a:last-child{opacity:1}.m4-xp{border-bottom:1px dotted #000;cursor:help}.m4-xp:active::after{content:" (" attr(title) ")"}.m4-note::before{content:"\1f5b9";margin-right:.2em;font-size:1.5em}.urs .m4-note,.urs .m4-info,.urs .m4-excl,.urs .m4-warn{padding-top:.2em;padding-bottom:.4em}.m4-note ul{margin-bottom:0;margin-left:1em}ol.m4-refs a:first-child::before{content:"\2191"}ol.m4-refs a:first-child{margin-right:.3em;text-decoration:none}.m4-l2{padding-left:1em}.m4-bh>a:first-child::before{content:"\1f517"}.m4-info::before{content:"\1f6c8";margin-right:.2em;font-size:1.5em}.m4-src{counter-reset:m4-nl}.m4-src>code>.m4-cb+a::before,.m4-cmd>code>.m4-cb+a::before{content:"\1f517"}.m4-src>code>.m4-cb+a,.m4-cmd>code>.m4-cb+a{font-weight:normal}.m4-src>code,.m4-cmd>code{border-radius:0 4px;border:1px solid #ddd;font-size:.7em;font-weight:bold;padding:2px 4px;position:absolute;right:0;text-align:right;top:0}.m4-src>code a,.m4-cmd>code a{margin-left:.6em}.m4-src>code>div{background:#eee;font-weight:initial;padding:0 2px;text-align:left}.m4-src>code>.m4-sha+a{background:#eee;color:inherit;margin:0 .6em}.m4-src>pre.m4-re{left:0;overflow:visible;padding-left:0;padding-right:0;position:absolute;top:0}.m4-src>pre+pre{background:none}.m4-src,.m4-src>pre,.m4-src>pre.m4-re>div{position:relative}.m4-src>pre.m4-re>div::before{content:counter(m4-nl);counter-increment:m4-nl;left:-3em;position:absolute;text-align:right;top:0;width:2.5em}.m4-src>pre.m4-re>div::after{content:" "}.m4-cb{cursor:pointer}.m4-cb::before{content:"\1f4cb"}.m4-hgl{border-bottom:1px dashed #000;cursor:help}.m4-cmd>pre{font-weight:bold;padding-right:0;white-space:normal;word-break:normal}.m4-cmd>code{visibility:hidden}.m4-cmd:hover>code{visibility:visible}.m4-cmd>pre a{color:inherit}.m4-root>pre::before{content:"# ";font-weight:normal}.m4-usc>pre::before{content:"$ ";font-weight:normal}.m4-sha{background:#eee;cursor:pointer;text-decoration:#f04c23 underline dashed}.m4-l3{padding-left:2em}</style>
</head>
<body id="root" class="js-advert-branding-click-event js-advert-sas-position-mark-background p-text design-page--theme-default design-page--root-cz design-page design-body design-page--has-advert--article-intext-1 design-page--has-advert--as-clanky-300x250 design-page--has-advert--mobile-footer design-page--has-advert--mobile-vignette design-page--has-advert--sidebar-sticky-1 design-page--has-advert--leaderboard design-page--has-advert--rectangle design-page--has-advert--sidebar-sticky-2 design-page--has-advert--megaboard">
<div class="parter-cpex-branding-wrapper design-advert-background-outer-element design-page__content" data-partner-cpex-branding-wrapper-z-index="0">
<div class=" js-sticker-init layout-main--has-sidebar--default layout-main--has-sidebar  layout-main main">
<div class="js-sticker-compare-wrapper layout-columns layout-main__content">
<div class="layout-columns__item--main layout-columns__item">
<div class="design-tile--version-1 design-tile">
<h1 class="detail__heading design-heading--level-1 design-heading">Generování kódu v M4: úvod</h1>
<div class="design-list--articles--article-detail  design-list--articles--opener design-list--articles design-list list-reset">
<div class="design-list__item">
<div class="design-article--opener--simple design-article--opener design-article--with-image design-article design-tile">
<span class=" element-print-hidden  design-article__image-outer">
<img class="design-image--responsive design-image design-article__image" src="../img/m4tux.png" width="670" height="377" alt=" ">
<span class="design-article__image-author">Autor: jkubin</span>
</span>
<div class="design-article__text">
<div class="design-article__perex">
<div class="design-article__perex-content">Makro procesor M4 se používá ke generování libovolně složitého kódu z&nbsp;jednoduchého zdrojového kódu.
Úvodní díl seriálu obsahuje jeho historii, základní principy jazyka, příklady použití a&nbsp;nutné předpoklady pro jeho zvládnutí.</div>
</div>
</div>
</div>
</div>
</div>
<div class="detail__article ">
<div class=" layout-article-content">
<div class="element-margin-top-half php-urs urs">
<div id="m4--toc"><h2>Obsah</h2><div><div class="m4-dwnl"><a href="../intro.mc" style="font-weight:bold" title="zdrojový kód článku">mc</a><a href="../generovani-kodu-v-m4-uvod/spell.txt" title="vygenerovaný text pro kontrolu překlepů a žargonu (určeno pro Vim)">spl</a><a href="../generovani-kodu-v-m4-uvod.txt" title="vygenerovaný text pro odhad počtu znaků">txt</a><a href="../generovani-kodu-v-m4-uvod/publish.txt" title="vygenerovaný text, který právě čtete a který byl vložen do redakčního systému (CMS)">pub</a><br><a href="../generovani-kodu-v-m4-uvod/index.html" title="vygenerovaná html stránka pro off-line vývoj">dev</a><a href="../generovani-kodu-v-m4-uvod/preview.html" title="vygenerovaná html stránka pro off-line náhled">pre</a><a href="../generovani-kodu-v-m4-uvod.c" title="vygenerovaný zdrojový kód C">c</a></div><div class="m4-updt">aktualizováno<br>19. ledna 2021</div></div></div>
<noscript><div title="pro informaci" class="rs-tip-major m4-info">Srozumitelnost ukázek zdrojového kódu zvyšuje povolený JavaScript.</div></noscript>
<p id="m4-uvod-toc"><a href="#m4-uvod"><b>1</b>Úvod</a></p>
<p id="m4-priklady-pro-ctenare-toc" class="m4-l2"><a href="#m4-priklady-pro-ctenare"><b>1.1</b>Příklady pro čtenáře</a></p>
<p id="m4-historie-makro-jazyku-toc"><a href="#m4-historie-makro-jazyku"><b>2</b>Historie makro jazyků</a></p>
<p id="m4-zaklady-jazyka-m4-toc"><a href="#m4-zaklady-jazyka-m4"><b>3</b>Základy jazyka M4</a></p>
<p id="m4-bezkontextova-gramatika-toc" class="m4-l2"><a href="#m4-bezkontextova-gramatika"><b>3.1</b>Bezkontextová gramatika</a></p>
<p id="m4-automaty-toc" class="m4-l2"><a href="#m4-automaty"><b>3.2</b>Automaty</a></p>
<p id="m4-vystupni-fronty-toc" class="m4-l2"><a href="#m4-vystupni-fronty"><b>3.3</b>Výstupní fronty</a></p>
<p id="m4-hlavni-pouziti-m4-toc"><a href="#m4-hlavni-pouziti-m4"><b>4</b>Hlavní použití M4</a></p>
<p id="m4-generovani-kodu-toc" class="m4-l2"><a href="#m4-generovani-kodu"><b>4.1</b>Generování kódu</a></p>
<p id="m4-preprocesor-toc" class="m4-l2"><a href="#m4-preprocesor"><b>4.2</b>Preprocesor</a></p>
<p id="m4-predpoklady-pro-zvladnuti-m4-toc"><a href="#m4-predpoklady-pro-zvladnuti-m4"><b>5</b>Předpoklady pro zvládnutí M4</a></p>
<p id="m4-zaklady-gramatik-toc" class="m4-l2"><a href="#m4-zaklady-gramatik"><b>5.1</b>Základy gramatik</a></p>
<p id="m4-zaklady-automatu-toc" class="m4-l2"><a href="#m4-zaklady-automatu"><b>5.2</b>Základy automatů</a></p>
<p id="m4-gnu-make-toc" class="m4-l2"><a href="#m4-gnu-make"><b>5.3</b>(GNU) make</a></p>
<p id="m4-vim-toc" class="m4-l2"><a href="#m4-vim"><b>5.4</b>Vim</a></p>
<p id="m4-talent-a-cas-toc" class="m4-l2"><a href="#m4-talent-a-cas"><b>5.5</b>Talent a čas</a></p>
<p id="m4-links-toc"><a href="#m4-links"><b>6</b>Odkazy</a></p>
<hr>
<p id="m4-priklady-generovani-kodu-toc"><a href="#m4-priklady-generovani-kodu" title="Příloha"><b>A</b>Příklady generování kódu</a></p>
<p id="m4-priklady-preprocesoru-toc"><a href="#m4-priklady-preprocesoru" title="Příloha"><b>B</b>Příklady preprocesoru</a></p>
<p id="m4-m4w-priklady-toc"><a href="#m4-m4w-priklady" title="Příloha"><b>C</b>M4: příklady</a></p>
<p id="m4-proc-pouzivat-m4-a-proc-neq-toc"><a href="#m4-proc-pouzivat-m4-a-proc-neq" title="Příloha"><b>D</b>Proč používat M4 a&nbsp;proč ne?</a></p>
<!-- article content -->
<h2 id="m4-uvod" class="m4-ch"><a href="#m4-uvod-toc" title="Obsah"></a><a href="#m4-uvod" title="⚓">1</a>Úvod<a href="#m4--toc" title="Nahoru"></a></h2>
<p>Čtenáři tohoto seriálu se naučí psát skripty pro strojové generování kódu.
Strojově generovaný kód může být libovolně složitý a&nbsp;může obsahovat další vnitřní závislosti.
Vzájemně závislé soubory se složitým kódem jsou pro člověka jen těžce udržitelné v&nbsp;konzistentním stavu.
Je už nutné použít nějaký mechanismus pro generování kódu.
Generování kódu provádí nástroj určený pro transformaci textu – <b>makro procesor</b>.</p>
<p id="m4-what-is-the-series-about">Seriál je zaměřen na praktické použití <b>univerzálního makro procesoru M4</b> (dále jen M4) pomocí malých příkladů.
Popisuje také teoretický základ všech implementací.
Cílem seriálu je seznámit čtenáře s&nbsp;tímto <span title="m4 – je program příkazové řádky" class="m4-xp">nástrojem</span> a&nbsp;také programovacím <span title="M4 – je programovací jazyk" class="m4-xp">jazykem</span>.
<a href="#m4-hlavni-pouziti-m4" title="Hlavní použití M4">Na co se používá</a>, jak se v&nbsp;něm programuje a&nbsp;jaké jsou jeho <a href="#m4-proc-generovat-kod-v-m4" title="👍 Proč generovat kód v M4">výhody</a> a&nbsp;<a href="#m4-proc-se-vyhnout-m4" title="👎 Proč se vyhnout M4">nevýhody</a>.</p>
<div title="poznámka" class="rs-tip-major m4-note">Vícejazyčný seriál <q><b>Generování kódu v M4</b></q> je generován M4 skripty<a href="http://github.com/jkubin/m4root" title="Generování kódu v M4" id="m4-ref1">[1]</a>,
které (možná) usnadní psaní článků a&nbsp;seriálů pro <a href="https://www.root.cz/" title="Root.cz – informace nejen ze světa Linuxu">www.root.cz</a> také jiným autorům.
Výsledkem seriálu je také sada ukázkových skriptů pro generování kódu.</div>
<p>Úvodní díl popisuje základní principy jazyka na jednoduchých příkladech.
Všechny příklady používají přepisovací pravidla <a href="#m4-bezkontextova-gramatika" title="Bezkontextová gramatika">bezkontextové gramatiky</a>.
Později se naučíme používat <a href="#m4-vystupni-fronty" title="Výstupní fronty">výstupní fronty</a>,
<a href="#m4-automaty" title="Automaty">automaty</a>, asociativní paměti, zásobníky a&nbsp;zásobníkové automaty.
Naučíme se také psát <a href="#m4-testovaci-automat" title="Testovací automat">testovací automaty</a> pro testování vstupních dat.</p>
<h3 id="m4-priklady-pro-ctenare" class="m4-ch"><a href="#m4-priklady-pro-ctenare-toc" title="Obsah"></a><a href="#m4-priklady-pro-ctenare" title="⚓">1.1</a>Příklady pro čtenáře<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklady pro čtenáře tvoří komplementární část seriálu a&nbsp;budou do jisté míry vytvářeny na základě podnětů v&nbsp;diskuzi pod článkem.
Na začátku každého dílu je popsána nějaká část jazyka M4 doplněná sadou příkladů na konci.
Každý díl je možné číst v&nbsp;libovolném pořadí.</p>
<ul>
<li><a href="#m4-priklady-generovani-kodu" title="Příklady generování kódu">Příklady generování kódu</a></li>
<li><a href="#m4-priklady-preprocesoru" title="Příklady preprocesoru">Příklady preprocesoru</a></li>
<li><a href="#m4-m4w-priklady" title="M4: příklady">M4: příklady</a></li>
<li><a href="#m4-proc-pouzivat-m4-a-proc-neq" title="Proč používat M4 a proč ne?">Proč používat M4 a&nbsp;proč ne?</a></li>
<li><a href="http://github.com/jkubin/m4root" title="Generování kódu v M4">http://github.com/jkubin/m4root</a> – projekt generující tento seriál</li>
</ul>
<h2 id="m4-historie-makro-jazyku" class="m4-ch"><a href="#m4-historie-makro-jazyku-toc" title="Obsah"></a><a href="#m4-historie-makro-jazyku" title="⚓">2</a>Historie makro jazyků<a href="#m4--toc" title="Nahoru"></a></h2>
<p>Makro jazyky byly vynalezeny v&nbsp;době, kdy dominoval jazyk symbolických adres – <abbr title="Jazyk Symbolických Adres – assembler">JSA</abbr>.
Zdrojový kód JSA velmi často obsahuje shodné sekvence instrukcí odlišující se pouze hodnotami operandů.
Shodné sekvence instrukcí je možné seskupit do jednoho slova, nebo-li <b>makro instrukce</b>.
Jméno obvykle popisuje účel skryté sekvence instrukcí.
Makro instrukce se přeloží makro procesorem na původní sekvenci instrukcí, která se posléze přeloží do spustitelného strojového kódu.
Programování v&nbsp;JSA pomocí makro instrukcí je jednodušší, rychlejší a&nbsp;méně náchylné k&nbsp;lidským chybám.</p>
<p>Později byly makro jazyky použity k&nbsp;rozšíření kompilovaných programovacích jazyků, protože umožnily psát zdrojový kód na vyšší úrovni abstrakce než jakou poskytuje samotný programovací jazyk.
Rychlost, výkonnost a efektivita složitého programovacího jazyka nižší úrovně je zachována díky makro jazykům.
Avšak je důležité dobře rozumět všem vrstvám kódu.</p>
<h3 id="m4-gpm-general-purpose-macro-gen" class="m4-bh"><a href="#m4-gpm-general-purpose-macro-gen" title="⚓"></a>GPM (General Purpose Macro-generator)<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Základní myšlenku přepisování textových řetězců s&nbsp;argumenty, které se přepíší do dalších rekurzivně přepisovatelných řetězců, představil
<a href="https://en.wikipedia.org/wiki/Christopher_Strachey" title="Wikipedie"><span class="rs-person">Christopher Strachey</span></a> ve svém
<abbr title="General Purpose Macro-generator">GPM</abbr><a href="http://dx.doi.org/10.1093/comjnl/8.3.225" title="A&nbsp;General Purpose Macro-generator" id="m4-ref2">[2]</a> v&nbsp;roce 1965.
Další generace makro procesorů M3 a&nbsp;M4 původní <abbr title="General Purpose Macro-generator">GPM</abbr> v&nbsp;podstatě už jen rozšiřovaly.
Základní myšlenka původního návrhu ale zůstala stejná.</p>
<h3 id="m4-m3" class="m4-bh"><a href="#m4-m3" title="⚓"></a>M3<a href="#m4--toc" title="Nahoru"></a></h3>
<p><a href="https://cs.wikipedia.org/wiki/Dennis_Ritchie" title="Wikipedie"><span class="rs-person">Dennis Ritchie</span></a> převzal základní myšlenku <abbr title="General Purpose Macro-generator">GPM</abbr> a&nbsp;napsal vylepšený makro procesor pro generování zdrojového kódu programovacího jazyka C (1972), který sám navrhl.
Nový <b>m</b>akro procesor napsal pro minipočítač AP-<b>3</b>, odtud jméno <b>M3</b>.
Tento přímý předchůdce současného M4 dokázal výrazně ušetřit těžkou a&nbsp;časově náročnou práci, čímž zaujal vývojáře programující v&nbsp;jiných jazycích (<abbr title="FORmula TRANslation">FORTRAN</abbr>, <abbr title="COmmon Business-Oriented Language">COBOL</abbr>, <abbr title="Programming Language One">PL/I</abbr>, …).
Vývojáři upravovali M3 pro tyto jazyky čímž ho proměnili na univerzálně použitelný makro procesor M4.</p>
<div title="m4 ∈ {množina nástrojů UNIX-u}" class="rs-tip-major m4-note"><span class="rs-person">Dennis Ritchie</span> byl také spolutvůrcem operačního systému UNIX a&nbsp;proto:<ul>
<li>M4 je minimalistický a&nbsp;rychlý, <a href="https://cs.wikipedia.org/wiki/Filosofie_Unixu" title="Filosofie UNIX-u
Wikipedie">dělá jednu věc a&nbsp;tu dělá dobře</a></li>
<li>výhradně spoléhá na neinteraktivní rozhraní příkazové řádky</li>
<li>parametry a&nbsp;závislosti M4 skriptů popisuje <code>Makefile</code></li>
<li>znakem <code>#</code> začíná jednořádkový komentář jako v&nbsp;UNIX-ovém shell-u</li>
<li>proměnné <code>$@</code>, <code>$*</code>, <code>$#</code>, <code>$0</code>, <code>$1</code>, <code>$2</code>, <code>$3</code>, … mají podobný význam jako v&nbsp;shell-u</li>
<li>oddělovač argumentů je čárka</li>
</ul>
</div>
<p>Makro procesor M3 rozšířil také <span class="rs-person">Jim E. Weythman</span>, autor programové konstrukce, která se používá téměř v&nbsp;každém M4 skriptu:</p>
<div id="m4-common-code" class="m4-src"><pre>divert(-1)
…
define(…)
…
divert(0)dnl
…</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-common-code" title="⚓"></a></code></div>
<div title="poznámka" class="rs-tip-major m4-note">Klíčové slovo <code title="divert(-1), divert(0), divert(1), …, divert(2147483647)" class="m4-hgl" data-0="1,5">divert(<a href="https://cs.wikipedia.org/wiki/Cel%C3%A9_%C4%8D%C3%ADslo" title="celé číslo">ℤ</a>)</code> přepíná výstupní fronty.
Argument <code>-1</code> zcela vypne jakýkoliv textový výstup.
Argument <code>0</code> přepne výstup na <code>stdout</code> (standardní výstup).</div>
<h3 id="m4-m4" class="m4-bh"><a href="#m4-m4" title="⚓"></a>M4<a href="#m4--toc" title="Nahoru"></a></h3>
<p><a href="https://cs.wikipedia.org/wiki/Brian_Kernighan" title="Wikipedie"><span class="rs-person">Brian Kernighan</span></a> makro procesor M3 rozšířil na <a href="https://cs.wikipedia.org/wiki/Preprocesor" title="Wikipedie">preprocesor</a> jazyka FORTRAN 66,
aby mohl vytvořit hybridní jazykovou nadstavbu pojmenovanou <abbr title="RATional FORtran"><b>RATFOR</b></abbr><a href="https://wolfram.schneider.org/bsd/7thEdManVol2/ratfor/ratfor.pdf" title="RATFOR — A Preprocessor for a Rational Fortran" id="m4-ref3">[3]</a>.
Základní programové konstrukce této nadstavby (podmínky, cykly) jsou stejné jako v&nbsp;jazyce C.
Programování v&nbsp;RATFOR-u se tak podobá programování v&nbsp;<q>céčku</q>.
Makro procesor zdrojový kód překládá zpátky do FORTRAN-u, poté kompilátor provede překlad do strojového kódu.</p>
<div title="jazyk M4 doplňuje jazyk C" class="rs-tip-major m4-note">Všimněte si <a href="#m4-ba-preprocesor-jazyka-c-a-m4" title="`' Preprocesor jazyka C a M4">téměř dokonalé symbiózy</a> s&nbsp;jazykem&nbsp;C<ul>
<li>direktivy <abbr title="Preprocesor jazyka C">CPP</abbr> <code>#define</code>, <code>#include</code>, <code>#ifdef</code>, … jsou pro M4 komentáře</li>
<li>klíčová slova oddělená od závorek mezerou, ztrácí svůj původní význam
<ul><li>M4 například ignoruje funkci <code>void define (char c, int i) {…}</code></li></ul></li>
<li>argumenty maker oddělují čárky stejně jako argumenty funkcí jazyka&nbsp;C
<ul><li>je-li definováno makro <code>FUNC(char c, int i)</code>, jeho proměnné jsou:
<code>$# → 2</code>, <code>$0 → FUNC</code>, <code>$1 → char c</code>, <code>$2 → int i</code></li></ul></li>
<li><b>levý</b> <a href="#m4-rizeni-expanze-neterminalu" title="Řízení expanze neterminálů">řídící znak</a> <code>`</code> není součástí syntaxe rodiny jazyků&nbsp;C</li>
<li><b>pravý</b> řídící znak <code>'</code> nevadí, není-li součástí makra
<ul><li>oba řídící znaky lze skrýt do uživatelských maker <code>LL()</code>, <code>RR()</code></li></ul></li>
<li>makra se píší <code>VELKYMI_PISMENY</code>, stejně jako <a href="https://cs.wikipedia.org/wiki/Termin%C3%A1ln%C3%AD_a_netermin%C3%A1ln%C3%AD_symbol" title="Wikipedie">neterminální symboly</a>
<ul><li>tím je vymezen jejich jmenný prostor</li></ul></li>
</ul>
</div>
<p>Uživatelský manuál<a href="https://wolfram.schneider.org/bsd/7thEdManVol2/m4/m4.pdf" title="The M4 Macro Processor" id="m4-ref4">[4]</a> zmiňuje ještě další, zde neuvedené spoluautory.
Bylo by tedy značně nespravedlivé napsat, že autory makro procesoru M4 (1977) jsou <i>pouze</i> dva lidé.</p>
<img src="../img/authors.jpg" alt="&nbsp;" width="960" height="400" id="m4-the-authors" title="Christopher Strachey, Dennis Ritchie, Brian Kernighan">
<p><em>Obrázek <a href="#m4-the-authors" title="⚓">1</a>: Christopher Strachey<a href="https://www.computerhope.com/people/christopher_strachey.htm" title="Christopher Strachey" id="m4-ref5">[5]</a>,
Dennis Ritchie<a href="https://pc.zoznam.sk/novinka/zomrel-tvorca-unixu-jazyka-c" title="Dennis Ritchie" id="m4-ref6">[6]</a>,
Brian Kernighan<a href="https://www.cs.cmu.edu/~mihaib/kernighan-interview/" title="Brian Kernighan" id="m4-ref7">[7]</a></em></p>
<h3 id="m4-gnu-m4" class="m4-bh"><a href="#m4-gnu-m4" title="⚓"></a>GNU M4<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Dnes existuje několik implementací lišící se od původní implementace spíše drobnostmi.
Nejrozšířenější implementace M4 je <b>GNU M4</b> používaná pro <a href="https://en.wikipedia.org/wiki/GNU_Build_System" title="Wikipedie">Autotools</a>
a&nbsp;pro překlad jednoduchého konfiguračního souboru <code>sendmail.mc</code> na složitý <code>sendmail.cf</code>.
Autorem této implementace z&nbsp;roku 1990 je <a href="https://www.seindal.dk/rene/gnu/"><span class="rs-person">René&nbsp;Seindal</span></a>.
Následující příkaz nainstaluje <span title="s malým „m“" class="m4-xp">m4</span>:</p>
<div id="m4-install" title="příkaz nainstaluje také další důležité balíčky" class="m4-cmd m4-root"><pre>dnf -y install make m4 pinfo</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-install" title="⚓"></a></code></div>
<p>Podrobný popis klíčových slov se nachází v&nbsp;dokumentaci<a href="https://www.gnu.org/software/m4/manual/" title="GNU M4 - GNU macro processor" id="m4-ref8">[8]</a>:</p>
<div id="m4-anch-4" class="m4-src"><pre>$ <b>pinfo m4</b>
$ <b>man m4</b>
$ <b>m4 --help</b></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-4" title="⚓"></a></code></div>
<h2 id="m4-zaklady-jazyka-m4" class="m4-ch"><a href="#m4-zaklady-jazyka-m4-toc" title="Obsah"></a><a href="#m4-zaklady-jazyka-m4" title="⚓">3</a>Základy jazyka M4<a href="#m4--toc" title="Nahoru"></a></h2>
<p>Základem jazyka M4 je <b>bezkontextová gramatika</b>, <b>automaty</b>, <b>zásobníky</b> a&nbsp;<b>výstupní fronty</b>.
Pro pochopení jazyka M4 je proto velmi důležité rozumět základním pojmům teorie formálních jazyků –
co jsou <a href="https://cs.wikipedia.org/wiki/Termin%C3%A1ln%C3%AD_a_netermin%C3%A1ln%C3%AD_symbol" title="Wikipedie">terminální symboly</a> (stručně <b>terminály</b>) a&nbsp;neterminální symboly (stručně <b>neterminály</b>).
Zmíněné pojmy si podrobněji vysvětlíme někdy později.
Cílem tohoto úvodního dílu je hlavně ukázat praktické použití M4 na příkladech.</p>
<h3 id="m4-bezkontextova-gramatika" class="m4-ch"><a href="#m4-bezkontextova-gramatika-toc" title="Obsah"></a><a href="#m4-bezkontextova-gramatika" title="⚓">3.1</a>Bezkontextová gramatika<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Bezkontextová gramatika (krátce <abbr title="Context-Free Grammar – bezkontextová gramatika">CFG</abbr>) je <a href="#m4-formalni-gramatika-chomskeho" title="Formální gramatika (Chomského typu)">formální gramatika</a>, ve které mají všechna přepisovací pravidla tvar <code class="m4-hgl" data-2="1" data-3="2">A → β</code>.
Neterminál <code class="m4-hgl" data-2="D">A</code> se <span class="m4-hgl" data-2="E">přepíše</span> na libovolně dlouhý řetězec <abbr title="pravá strana přepisovacího pravidla"><code class="m4-hgl" data-2="F">β</code></abbr> složený z&nbsp;<span class="m4-hgl" data-2="B">neterminálů <code>N</code></span> <span class="m4-hgl" data-2="G">nebo</span> <span class="m4-hgl" data-2="A">terminálů <code>Σ</code></span>.
<span class="m4-hgl" data-2="C"><a href="https://en.wikipedia.org/wiki/Kleene_star" title="Wikipedie">Kleeneho hvězda</a></span> znamená, že se neterminál <code class="m4-hgl" data-2="D" data-3="D">A</code> může přepsat na <abbr title="epsilon – prázdný symbol"><code>ε</code></abbr> (přepisovací pravidlo <code class="m4-hgl" data-3="5,6">A → ε</code>).</p>
<div id="m4-all-context-free-grammar-rules" title="přepisovací pravidla bezkontextové gramatiky" class="m4-src"><pre>P: <span class="m4-d">A</span> <span class="m4-e">→</span> <span class="m4-f">β</span>
   <span class="m4-d">A</span> ∈ <span class="m4-b">N</span>
   <span class="m4-f">β</span> ∈ (<span class="m4-b">N</span> <span class="m4-g">∪</span> <span class="m4-a">Σ</span>)<span class="m4-c">*</span></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-all-context-free-grammar-rules" title="⚓"></a></code></div>
<h4 id="m4-prepisovaci-pravidla-m4" class="m4-bh"><a href="#m4-prepisovaci-pravidla-m4" title="⚓"></a>Přepisovací pravidla M4<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Přepisovací pravidla M4 <span class="m4-hgl" data-2="1" data-3="2">jsou stejná</span> jako přepisovací pravidla bezkontextové gramatiky.</p>
<div id="m4-rewriting-rules" title="přepisovací pravidla M4" class="m4-src"><pre># A → β
define(`<span class="m4-d">A</span>', `<span class="m4-f">β</span>')

# A → ε
define(`<span class="m4-d">A</span>')
define(`<span class="m4-d">A</span>', `')</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-rewriting-rules" title="⚓"></a></code></div>
<p>Všechna klíčová slova M4 jsou neterminály (makra), provedou nějakou akci a&nbsp;přepíší se na <abbr title="epsilon – prázdný symbol"><code>ε</code></abbr> nebo jiný symbol.
Všechna klíčová slova lze přejmenovat nebo úplně vypnout.
Tato vlastnost je velmi důležitá pro režim preprocesoru.</p>
<div id="m4-keywords-are-nonterminals" title="klíčová slova M4 jsou neterminály" class="m4-src"><pre>divert(ℤ) → ε
define(`A', `β') → ε
ifelse(`', `', `yes', `no') → yes
ifelse(`', `', `ifdef(`dnl', `1', `0')', `no') → ifdef(`dnl', `1', `0') → 1
…</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-keywords-are-nonterminals" title="⚓"></a></code></div>
<h4 id="m4-rizeni-expanze-neterminalu" class="m4-bh"><a href="#m4-rizeni-expanze-neterminalu" title="⚓"></a>Řízení expanze neterminálů<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Výchozí dvojice znaků <code>`'</code> v&nbsp;M4 řídí expanzi neterminálů.
Klíčové slovo <code>changequote()</code> je může změnit na jiné znaky, například {<code title="hranaté závorky" class="m4-xp">[]</code>, <code title="netisknutelné znaky" class="m4-xp">␂␆</code>, <code title="UTF-8 znaky" class="m4-xp">⟦⟧</code>}.
Neterminály, které nechceme (ihned) expandovat, jsou obklopeny touto dvojicí znaků.
Při průchodu makro procesorem jsou všechny symboly mezi touto dvojicí znaků <b>terminálními symboly</b> a&nbsp;vnější dvojice znaků je odstraněna.
Další průchod již způsobí expanzi původně chráněných neterminálů.
Dvojice řídících znaků se nastavuje na začátku kořenového souboru.</p>
<h3 id="m4-automaty" class="m4-ch"><a href="#m4-automaty-toc" title="Obsah"></a><a href="#m4-automaty" title="⚓">3.2</a>Automaty<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Automaty slouží jako <q>přepínače</q> pravidel gramatiky.
Používají přepisovací pravidla gramatiky jako uzly a&nbsp;mění své stavy podle vstupních symbolů.
Aktuálně používané přepisovací pravidlo produkuje do výstupní fronty (nebo do několika výstupních front)
specifický kód, dokud automat nepřejde do jiného uzlu s&nbsp;jiným přepisovacím pravidlem.
Příklady <a href="#m4-jsonw-generujici-automat" title="⟦⟧ JSON: generující automat">generujících automatů</a> jsou ukázány v&nbsp;příloze.</p>
<h3 id="m4-vystupni-fronty" class="m4-ch"><a href="#m4-vystupni-fronty-toc" title="Obsah"></a><a href="#m4-vystupni-fronty" title="⚓">3.3</a>Výstupní fronty<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Výstupní fronty jsou dočasné úložiště pro části výsledného kódu.
Tyto části výsledného kódu jsou produkovány přepisovacími pravidly gramatiky, které přepisují vstupní symboly.
Klíčové slovo <code>divert(ℤ)</code> nastavuje aktuální výstupní frontu.
Na závěr jsou všechny neprázdné fronty vypsány ve vzestupném pořadí na standardní výstup a&nbsp;složí výsledný kód z&nbsp;částí kódu.
<a href="#m4-htmlw-vystupni-fronty" title="⟦⟧ HTML: výstupní fronty">Výstupní fronty</a> jsou ukázány v&nbsp;příloze.</p>
<div title="pro informaci" class="rs-tip-major m4-info"><b>Zásobníky</b> si ukážeme později.</div>
<h2 id="m4-hlavni-pouziti-m4" class="m4-ch"><a href="#m4-hlavni-pouziti-m4-toc" title="Obsah"></a><a href="#m4-hlavni-pouziti-m4" title="⚓">4</a>Hlavní použití M4<a href="#m4--toc" title="Nahoru"></a></h2>
<p>M4 se používá ke generování zdrojového kódu libovolného programovacího jazyka nebo jako preprocesor jakéhokoliv zdrojového kódu.</p>
<h3 id="m4-generovani-kodu" class="m4-ch"><a href="#m4-generovani-kodu-toc" title="Obsah"></a><a href="#m4-generovani-kodu" title="⚓">4.1</a>Generování kódu<a href="#m4--toc" title="Nahoru"></a></h3>
<p>M4 transformuje vstupní data ze souborů <abbr title="Macro Configuration"><code>.mc</code></abbr> na výsledná data následujícím příkazem:</p>
<div id="m4-files-on-command-line" title="← nejobecnější.m4 … nejspeciálnější.m4 →" class="m4-cmd m4-usc"><pre>m4 root.m4 stem.m4 branch.m4 leaf.m4 input1.mc input2.mc > output.file</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-files-on-command-line" title="⚓"></a></code></div>
<p>Během načítání souborů jsou prováděny dvě základní operace:</p>
<ol>
<li>čtení transformačních pravidel ze souborů s&nbsp;příponou <code>.m4</code></li>
<li>expanze maker uvnitř souborů s&nbsp;příponou <code>.mc</code></li>
</ol>
<p>Soubory <code>input1.mc</code> a&nbsp;<code>input2.mc</code> obsahují <b>vstupní data</b> ve specifickém formátu, který umožňuje jejich transformaci na <b>výstupní data</b> podle pravidel v&nbsp;předchozích <code>.m4</code> souborech.
Datové soubory <code>.mc</code> obvykle neobsahují žádná transformační pravidla.</p>
<p>Vstupní data mohou také přicházet z&nbsp;kolony:</p>
<div id="m4-anch-9" title="vstupní kód → generování zdrojového kódu → soubor" class="m4-cmd m4-usc"><pre>cat input.mc | m4 root.m4 stem.m4 branch.m4 leaf.m4 - > output.file</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-9" title="⚓"></a></code></div>
<div id="m4-anch-10" title="vstupní kód → generování zdrojového kódu → program" class="m4-cmd m4-usc"><pre>cat input.mc | m4 root.m4 stem.m4 branch.m4 leaf.m4 - | gcc -x c -o progr -</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-10" title="⚓"></a></code></div>
<p>Vyzkoušejte: <a href="#m4-priklady-generovani-kodu" title="Příklady generování kódu">Příklady generování kódu</a></p>
<h3 id="m4-preprocesor" class="m4-ch"><a href="#m4-preprocesor-toc" title="Obsah"></a><a href="#m4-preprocesor" title="⚓">4.2</a>Preprocesor<a href="#m4--toc" title="Nahoru"></a></h3>
<p>M4 může pracovat v&nbsp;režimu preprocesoru a může být také součástí kolony.
Vstupní zdrojový kód jím prochází beze změny s&nbsp;výjimkou neterminálních symbolů.
Nalezené neterminály jsou expandovány na terminály a&nbsp;odchází spolu se zdrojovým kódem na výstup.
M4 může rozšířit jakýkoliv jiný jazyk, kde je preprocesor nedostatečný (bez rekurze) nebo žádný.
Důležité je zvolit vhodný levý znak pro řízení expanze neterminálů, který nesmí kolidovat se znakem vstupního zdrojového kódu.
Kolize znaku je ale snadno řešitelná regulárním výrazem.</p>
<div id="m4-anch-11" title="M4 jako preprocesor – obecně" class="m4-cmd m4-usc"><pre>m4 root.m4 stem.m4 branch.m4 leaf.m4 file.c > preproc.file.c</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-11" title="⚓"></a></code></div>
<div id="m4-anch-12" title="M4 jako preprocesor – bez dočasného souboru" class="m4-cmd m4-usc"><pre>m4 root.m4 stem.m4 branch.m4 leaf.m4 file.c | gcc -x c -o progr -</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-12" title="⚓"></a></code></div>
<h4 id="m4-ba-vychozi-znaky" class="m4-bh"><a href="#m4-ba-vychozi-znaky" title="⚓"></a><code>`'</code> Výchozí znaky<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Konfliktní znak <code>`</code> ze vstupního zdrojového kódu je skryt do makra <code>`'LL()</code>.
Prázdný pár řídících znaků <code>`'</code> před makrem <code>LL()</code> slouží jako <a href="#m4-lr-hw-zavorky-lr-l-r-lhr-ldnl" title="[] .h: závorky [], [,], [⟦#⟧], [⟦dnl⟧]">oddělovač symbolů</a>.
Při průchodu zdrojového kódu makro procesorem se makro <code>`'LL()</code> přepíše zpátky na původní znak <code>`</code> a&nbsp;prázdný pár <code>`'</code> je odstraněn.</p>
<div id="m4-anch-13" title="M4 jako preprocesor s řídícími znaky: `'" class="m4-cmd m4-usc"><pre>sed 's/`/`'\''LL()/g' any.src | m4 rootq.m4 leaf.m4 -</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-13" title="⚓"></a></code></div>
<p>Vyskytují-li se ve vstupním kódu komentáře <code>#</code> nebo <code>dnl</code>, je nutné je skrýt.
Znaky <code>`'</code> <a href="#m4-lr-hw-zavorky-lr-l-r-lhr-ldnl" title="[] .h: závorky [], [,], [⟦#⟧], [⟦dnl⟧]">vypnou</a> původní význam komentářů a budou odebrány při průchodu makro procesorem.<br>
Komentáře M4 <code>#</code> a <code>dnl</code> jsou skryty mezi výchozí znaky: <code>`#'</code> <code>`dnl'</code></p>
<div id="m4-anch-14" title="M4 jako preprocesor s řídícími znaky: `'" class="m4-cmd m4-usc"><pre>sed 's/`/`'\''LL()/g;s/#\|\&lt;dnl\>/`&amp;'\''/g' any.src | m4 rootq.m4 leaf.m4 -</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-14" title="⚓"></a></code></div>
<div id="m4-anch-15" title="M4 jako preprocesor s řídícími znaky jinak: `'" class="m4-cmd m4-usc"><pre>sed 's/`/`'\''LL()/g;s/#/`#'\''/g;s/\&lt;dnl\>/`dnl'\''/g' any.src | m4 …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-15" title="⚓"></a></code></div>
<h4 id="m4-lr-hranate-zavorky" class="m4-bh"><a href="#m4-lr-hranate-zavorky" title="⚓"></a><code>[]</code> Hranaté závorky<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Použijeme-li pro <a href="#m4-rizeni-expanze-neterminalu" title="Řízení expanze neterminálů">řízení expanze neterminálů</a> hranaté závorky, stejným způsobem je skryta levá <code>[</code> hranatá závorka.
Vše ostatní platí jako pro výchozí znaky <code>`'</code>.</p>
<div id="m4-anch-16" title="M4 jako preprocesor s řídícími znaky: []" class="m4-cmd m4-usc"><pre>sed 's/\[/[]LL()/g' any.src | m4 rootb.m4 leaf.m4 - | …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-16" title="⚓"></a></code></div>
<p>Komentáře M4 <code>#</code> a <code>dnl</code> jsou skryté mezi závorkami: <code>[#]</code> <code>[dnl]</code></p>
<div id="m4-anch-17" title="M4 jako preprocesor s řídícími znaky: []" class="m4-cmd m4-usc"><pre>sed 's/\[/[]LL()/g;s/#\|\&lt;dnl\>/[&amp;]/g' any.src | m4 rootb.m4 leaf.m4 - | …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-17" title="⚓"></a></code></div>
<div id="m4-anch-18" title="M4 jako preprocesor s řídícími znaky jinak: []" class="m4-cmd m4-usc"><pre>sed 's/\[/[]LL()/g;s/#/[#]/g;s/\&lt;dnl\>/[dnl]/g' any.src | m4 rootb.m4 …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-18" title="⚓"></a></code></div>
<h4 id="m4-netisknutelne-znaky" class="m4-bh"><a href="#m4-netisknutelne-znaky" title="⚓"></a><code>␂␆</code> Netisknutelné znaky<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Pro řízení expanze neterminálů lze použít netisknutelné znaky <b><code>␂</code></b> (<samp>0x02</samp>) a&nbsp;<b><code>␆</code></b> (<samp>0x06</samp>).
Tyto znaky nemohou kolidovat s&nbsp;tisknutelnými znaky zdrojového kódu.</p>
<div id="m4-anch-19" title="M4 jako preprocesor s řídícími znaky: ␂␆" class="m4-cmd m4-usc"><pre>m4 rootn.m4 leaf.m4 any.src | gcc …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-19" title="⚓"></a></code></div>
<p>Komentáře M4 <code>#</code> a <code>dnl</code> jsou skryty mezi netisknutelné znaky: <code>␂#␆</code> <code>␂dnl␆</code></p>
<div id="m4-anch-20" title="M4 jako preprocesor s řídícími znaky: ␂␆" class="m4-cmd m4-usc"><pre>sed 's/#\|\&lt;dnl\>/␂&amp;␆/g' any.src | m4 rootn.m4 leaf.m4 - | gcc …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-20" title="⚓"></a></code></div>
<div id="m4-anch-21" title="M4 jako preprocesor s řídícími znaky jinak: ␂␆" class="m4-cmd m4-usc"><pre>sed 's/#/␂#␆/g;s/\&lt;dnl\>/␂dnl␆/g' any.src | m4 rootn.m4 leaf.m4 - | gcc …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-21" title="⚓"></a></code></div>
<h4 id="m4-utf-8-znaky" class="m4-bh"><a href="#m4-utf-8-znaky" title="⚓"></a><code>⟦⟧</code> UTF-8 znaky<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Expanzi neterminálů může také řídit vhodně zvolený pár UTF-8 znaků.
Běžný zdrojový kód takové znaky neobsahuje, proto nemusíme řešit kolizi levého řídícího <code>⟦</code> znaku.
UTF-8 znaky nabízí podobné výhody jako netisknutelné znaky.</p>
<div id="m4-anch-22" title="M4 jako preprocesor s řídícími znaky: ⟦⟧" class="m4-cmd m4-usc"><pre>m4 rootu.m4 leaf.m4 any.src | gcc …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-22" title="⚓"></a></code></div>
<p>Komentáře M4 <code>#</code> a <code>dnl</code> jsou skryty mezi UTF-8 znaky: <code>⟦#⟧</code> <code>⟦dnl⟧</code></p>
<div id="m4-anch-23" title="M4 jako preprocesor s řídícími znaky: ⟦⟧" class="m4-cmd m4-usc"><pre>sed 's/#\|\&lt;dnl\>/⟦&amp;⟧/g' any.src | m4 rootu.m4 leaf.m4 - | gcc …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-23" title="⚓"></a></code></div>
<div id="m4-anch-24" title="M4 jako preprocesor s řídícími znaky jinak: ⟦⟧" class="m4-cmd m4-usc"><pre>sed 's/#/⟦#⟧/g;s/\&lt;dnl\>/⟦dnl⟧/g' any.src | m4 rootu.m4 leaf.m4 - | gcc …</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-24" title="⚓"></a></code></div>
<p>Vyzkoušejte: <a href="#m4-priklady-preprocesoru" title="Příklady preprocesoru">Příklady preprocesoru</a></p>
<h4 id="m4-smiseny-rezim" class="m4-bh"><a href="#m4-smiseny-rezim" title="⚓"></a>Smíšený režim<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Smíšený režim je kombinací předchozích režimů a&nbsp;je používán hlavně na pokusy.
Data nejsou oddělena od transformačních pravidel.
Listový soubor <code>leaf.m4</code> obsahuje definice těchto pravidel spolu se vstupními daty.</p>
<div id="m4-anch-25" title="jak se naučit M4" class="m4-cmd m4-usc"><pre>m4 root.m4 leaf.m4</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-25" title="⚓"></a></code></div>
<p>Vyzkoušejte: <a href="#m4-m4w-priklady" title="M4: příklady">M4: příklady</a></p>
<h2 id="m4-predpoklady-pro-zvladnuti-m4" class="m4-ch"><a href="#m4-predpoklady-pro-zvladnuti-m4-toc" title="Obsah"></a><a href="#m4-predpoklady-pro-zvladnuti-m4" title="⚓">5</a>Předpoklady pro zvládnutí M4<a href="#m4--toc" title="Nahoru"></a></h2>
<p>Pro úspěšné zvládnutí tohoto makro jazyka je důležité splnit několik předpokladů.
M4 není jednoduchý jazyk, protože není možné v&nbsp;něm myslet a&nbsp;programovat jako v&nbsp;běžném programovacím jazyce.
Nejdůležitější je uvědomit si, že se v&nbsp;něm programují přepisovací pravidla gramatiky.
Každý řetězec je buď terminální nebo neterminální symbol včetně všech klíčových slov jazyka (symboly <code>#</code> a&nbsp;<code>,</code> jsou speciální případy neterminálů).</p>
<div title="poznámka" class="rs-tip-major m4-note">M4 záměrně nemá klíčová slova pro <b>cykly</b> (<code>for</code>/<code>while</code>), protože jeho základ je zcela jiný, než jaký mají procedurální nebo funkcionální jazyky.<hr>
<ul>
<li><b>cykly</b> jsou pouze levorekurzivní nebo pravorekurzivní</li>
<li><b>větví</b> se <a href="#m4-vetveni-gramatikou" title="⟦⟧ Větvení gramatikou">řetězením symbolů</a> nebo klíčovými slovy <code>ifelse()</code>, <code>ifdef()</code></li>
</ul>
</div>
<h3 id="m4-zaklady-gramatik" class="m4-ch"><a href="#m4-zaklady-gramatik-toc" title="Obsah"></a><a href="#m4-zaklady-gramatik" title="⚓">5.1</a>Základy gramatik<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Základem všech gramatik jsou <span class="m4-hgl" data-5="6">přepisovací pravidla</span>, jejichž podobu obecně popisuje:</p>
<h4 id="m4-formalni-gramatika-chomskeho" class="m4-bh"><a href="#m4-formalni-gramatika-chomskeho" title="⚓"></a>Formální gramatika (Chomského typu)<a href="#m4--toc" title="Nahoru"></a></h4>
<div id="m4-formal-definition" class="m4-src"><pre>G = (N, Σ, P, S)
N: konečná množina neterminálních symbolů
Σ: konečná množina terminálních symbolů
   N ∩ Σ = ø
P: konečná množina přepisovacích pravidel
   <span class="m4-x">(N ∪ Σ)*</span> <span class="m4-s">N</span> <span class="m4-x">(N ∪ Σ)*</span> → <span class="m4-s">(N ∪ Σ)*</span>
S: je počáteční (startovací) symbol
   S ∈ N</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-formal-definition" title="⚓"></a></code></div>
<p><a href="https://cs.wikipedia.org/wiki/Form%C3%A1ln%C3%AD_gramatika" title="Wikipedie">Formální gramatika</a> popisuje <a href="https://cs.wikipedia.org/wiki/Chomsk%C3%A9ho_hierarchie" title="Chomského hierarchie
(Wikipedie)">podmnožiny</a>
přepisovacích pravidel <a href="https://cs.wikipedia.org/wiki/Form%C3%A1ln%C3%AD_jazyk" title="Wikipedie">formálního jazyka</a>.
Jedna z&nbsp;podmnožin se jmenuje <span class="m4-hgl" data-5="S,X"><a href="https://cs.wikipedia.org/wiki/Bezkontextov%C3%A1_gramatika" title="Wikipedie">bezkontextová gramatika</a></span>,
krátce <abbr title="Context-Free Grammar – bezkontextová gramatika">CFG</abbr>.
Jak již bylo dříve zmíněno, přepisovací pravidla CFG pracují stejně jako přepisovací pravidla jazyka M4.
Některý z&nbsp;následujících dílů seriálu se podrobněji zaměří na formální gramatiky.</p>
<h3 id="m4-zaklady-automatu" class="m4-ch"><a href="#m4-zaklady-automatu-toc" title="Obsah"></a><a href="#m4-zaklady-automatu" title="⚓">5.2</a>Základy automatů<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Schopnost používat převážně dvoustavové automaty je zásadní věc pro psaní jednoduchých M4 skriptů, protože převážná většina skriptů používá <a href="#m4-cw-maly-automat" title="⟦⟧ C: malý automat">malé automaty</a>.</p>
<h4 id="m4-testovaci-automat" class="m4-bh"><a href="#m4-testovaci-automat" title="⚓"></a>Testovací automat<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Pořadí vstupních symbolů nebo jejich kontext lze otestovat automatem.
Splňují-li vstupní symboly požadované vlastnosti, automat skončí v&nbsp;uzlu s&nbsp;dvojitým kroužkem, kterým se označuje akceptující stav.</p>
<img src="../img/dfa.png" alt="&nbsp;" width="274" height="155" id="m4-dfa-img" title="deterministický konečný automat (DFA)">
<p><em>Obrázek <a href="#m4-dfa-img" title="⚓">2</a>: Příklad automatu<a href="https://cs.wikipedia.org/wiki/Teorie_automat%C5%AF" title="Teorie automatů" id="m4-ref9">[9]</a> akceptující sudý počet (žádný je také sudý) symbolů <code>0</code>, ignorující symboly <code>1</code>.
Automat je shodný s&nbsp;regulárním výrazem <code>(1*01*01*)*1*</code>.</em></p>
<p>Předchozí automat lze zapsat jako ASCII art doprovázející M4 skript:</p>
<div id="m4-anch-27" title="ASCII art jako dokumentace M4 kódu" class="m4-src"><pre>#          ____1
#         |   /
#      ___V__/   0    ____
# --->// S1 \\------>/ S2 \---.1
#     \\____//&lt;------\____/&lt;--'
#                0</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-27" title="⚓"></a></code></div>
<h4 id="m4-generujici-automat" class="m4-bh"><a href="#m4-generujici-automat" title="⚓"></a>Generující automat<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Vstupní symboly mění uzly automatu, čímž zároveň mění přepisovací pravidla pro generování kódu.
Příklad <a href="#m4-jsonw-generujici-automat" title="⟦⟧ JSON: generující automat">generujícího automatu</a> naleznete v&nbsp;příloze:</p>
<div id="m4-anch-28" title="ASCII art generujícího automatu" class="m4-src"><pre>#      _______      ___________
# --->/ ERROR \--->/ NEXT_ITEM \---.
#     \_______/    \___________/&lt;--'</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-anch-28" title="⚓"></a></code></div>
<h3 id="m4-gnu-make" class="m4-ch"><a href="#m4-gnu-make-toc" title="Obsah"></a><a href="#m4-gnu-make" title="⚓">5.3</a>(GNU) make<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Dobře navržený generátor kódu se obvykle skládá z&nbsp;několika menších souborů, jejichž pořadí, závislosti a&nbsp;parametry se zapisují do souboru <code>Makefile</code>.
Dobrá znalost tvorby <code>Makefile</code> je proto základním předpokladem pro zvládnutí M4.
Čtení a údržba zdrojového kódu celkově zabere vždy více času než jeho tvorba.
Dobře strukturovaný <code>Makefile</code> proto zásadním způsobem přispívá k&nbsp;celkové přehlednosti výsledného generátoru kódu.</p>
<div title="tímto tématem se budeme zabývat jindy" class="rs-tip-major m4-note">Spouštění <code>make</code><a href="https://www.gnu.org/software/make/manual/make.html" title="GNU Make Manual" id="m4-ref10">[10]</a> z&nbsp;editoru kódu pomocí vhodné klávesové zkratky zásadně urychluje vývoj M4 kódu.
Soubor <code>~/.vimrc</code> obsahuje <code>nnoremap &lt;c-j&gt; :make&lt;cr&gt;</code>.</div>
<h3 id="m4-vim" class="m4-ch"><a href="#m4-vim-toc" title="Obsah"></a><a href="#m4-vim" title="⚓">5.4</a>Vim<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Zvládnutí editoru Vim<a href="https://www.vim.org/" title="Vim – všudypřítomný textový editor" id="m4-ref11">[11]</a> je důležitým předpokladem pro pohodlí a&nbsp;rychlost psaní kódu M4.
Vim zkratky, definované klíčovým slovem <code>iabbrev</code>, ušetří velké množství zbytečně napsaného textu.
Tyto zkratky také významně snižují výskyt téměř neviditelných chyb způsobených nepárovou závorkou, čímž šetří ztracený čas vynaložený na ladění kódu.</p>
<h3 id="m4-talent-a-cas" class="m4-ch"><a href="#m4-talent-a-cas-toc" title="Obsah"></a><a href="#m4-talent-a-cas" title="⚓">5.5</a>Talent a čas<a href="#m4--toc" title="Nahoru"></a></h3>
<p>M4 obvykle nejde zcela zvládnout přes víkend, zvláště chybí-li základy<a href="https://is.muni.cz/elportal/estud/fi/js06/ib005/Formalni_jazyky_a_automaty_I.pdf" title="Automaty a&nbsp;formální jazyky I" id="m4-ref12">[12]</a>
<a href="https://cs.wikipedia.org/wiki/Teorie_automat%C5%AF" title="Wikipedie">teorie&nbsp;automatů</a> a&nbsp;<a href="https://cs.wikipedia.org/wiki/Form%C3%A1ln%C3%AD_gramatika" title="Wikipedie">formálních&nbsp;gramatik</a>.
Ke zvládnutí jazyka M4 je nutné v&nbsp;něm programovat delší období a&nbsp;napsat množství špatného (složitého) M4 kódu, který z&nbsp;vlastní vůle přepíšete kvůli lepšímu nápadu.
Tímto způsobem je možné postupně získat praxi.</p>
<!-- article references -->
<h2 id="m4-links" class="m4-ch"><a href="#m4-links-toc" title="Obsah"></a><a href="#m4-links" title="⚓">6</a>Odkazy<a href="#m4--toc" title="Nahoru"></a></h2>
<ol class="m4-refs">
<li><a href="#m4-ref1" title="odkaz v textu"></a><b>Generování kódu v M4</b>, šablona s&nbsp;příklady pro <a href="https://www.root.cz" title="Root.cz – informace nejen ze světa Linuxu">www.root.cz</a>
<a href="http://github.com/jkubin/m4root">http://github.com/jkubin/m4root</a></li>
<li><a href="#m4-ref2" title="odkaz v textu"></a><b>A&nbsp;General Purpose Macro-generator</b>, Computer Journal 8, 3 (1965), 225–41
<a href="http://dx.doi.org/10.1093/comjnl/8.3.225">http://dx.doi.org/10.1093/comjnl/8.3.225</a></li>
<li><a href="#m4-ref3" title="odkaz v textu"></a><b>RATFOR — A Preprocessor for a Rational Fortran</b>, Brian W. Kernighan
<a href="https://wolfram.schneider.org/bsd/7thEdManVol2/ratfor/ratfor.pdf">https://wolfram.schneider.org/bsd/7thEdManVol2/ratfor/ratfor.pdf</a></li>
<li><a href="#m4-ref4" title="odkaz v textu"></a><b>The M4 Macro Processor</b>, Bell Laboratories (1977)
<a href="https://wolfram.schneider.org/bsd/7thEdManVol2/m4/m4.pdf">https://wolfram.schneider.org/bsd/7thEdManVol2/m4/m4.pdf</a></li>
<li><a href="#m4-ref5" title="odkaz v textu"></a><b>Christopher Strachey</b>, Computer Hope – Free computer help since 1998
<a href="https://www.computerhope.com/people/christopher_strachey.htm">https://www.computerhope.com/people/christopher_strachey.htm</a></li>
<li><a href="#m4-ref6" title="odkaz v textu"></a><b>Dennis Ritchie</b>, Zomrel tvorca Unixu a&nbsp;jazyka&nbsp;C
<a href="https://pc.zoznam.sk/novinka/zomrel-tvorca-unixu-jazyka-c">https://pc.zoznam.sk/novinka/zomrel-tvorca-unixu-jazyka-c</a></li>
<li><a href="#m4-ref7" title="odkaz v textu"></a><b>Brian Kernighan</b>, An Interview with Brian Kernighan
<a href="https://www.cs.cmu.edu/~mihaib/kernighan-interview/">https://www.cs.cmu.edu/~mihaib/kernighan-interview/</a></li>
<li><a href="#m4-ref8" title="odkaz v textu"></a><b>GNU M4 - GNU macro processor</b>, Free Software Foundation
<a href="https://www.gnu.org/software/m4/manual/">https://www.gnu.org/software/m4/manual/</a></li>
<li><a href="#m4-ref9" title="odkaz v textu"></a><b>Teorie automatů</b>, From Wikipedia, the free encyclopedia
<a href="https://cs.wikipedia.org/wiki/Teorie_automat%C5%AF">https://cs.wikipedia.org/wiki/Teorie_automat%C5%AF</a></li>
<li><a href="#m4-ref10" title="odkaz v textu"></a><b>GNU Make Manual</b>, Free Software Foundation
<a href="https://www.gnu.org/software/make/manual/make.html">https://www.gnu.org/software/make/manual/make.html</a></li>
<li><a href="#m4-ref11" title="odkaz v textu"></a><b>Vim – všudypřítomný textový editor</b>, který edituje text rychlostí myšlenky
<a href="https://www.vim.org/">https://www.vim.org/</a></li>
<li><a href="#m4-ref12" title="odkaz v textu"></a><b>Automaty a&nbsp;formální jazyky I</b>, Učební text FI MU
<a href="https://is.muni.cz/elportal/estud/fi/js06/ib005/Formalni_jazyky_a_automaty_I.pdf">https://is.muni.cz/elportal/estud/fi/js06/ib005/Formalni_jazyky_a_automaty_I.pdf</a></li>
<li><b>Automaty a&nbsp;gramatiky</b>, Michal Chytil, 1. vydání, Praha, 331 s. 1984.
<a href="https://is.muni.cz/publication/173173">https://is.muni.cz/publication/173173</a></li>
</ol>
<!-- appendix content -->
<h2 id="m4-priklady-generovani-kodu" class="m4-ch"><a href="#m4-priklady-generovani-kodu-toc" title="Obsah"></a><a href="#m4-priklady-generovani-kodu" title="⚓">A</a>Příklady generování kódu<a href="#m4--toc" title="Nahoru"></a></h2>
<div title="pro informaci" class="rs-tip-major m4-info">Znaky {<code title="uvozovky" class="m4-xp">`'</code>, <code title="hranaté závorky" class="m4-xp">[]</code>, <code title="netisknutelné znaky" class="m4-xp">␂␆</code>, <code title="UTF-8 znaky" class="m4-xp">⟦⟧</code>} v&nbsp;názvu příkladu <a href="../generovani-kodu-v-m4-uvod/preview.html#m4-rizeni-expanze-neterminalu" title="Řízení expanze neterminálů">řídí expanzi neterminálů</a>.</div>
<p id="m4-vstupni-zdrojovy-kod-toc" class="m4-l2"><a href="#m4-vstupni-zdrojovy-kod"><b>A.1</b><code>⟦⟧</code> Vstupní zdrojový kód</a></p>
<p id="m4-csvw-nejjednodussi-priklad-toc" class="m4-l2"><a href="#m4-csvw-nejjednodussi-priklad"><b>A.2</b><code>⟦⟧</code> CSV: nejjednodušší příklad</a></p>
<p id="m4-csvw-pocitadlo-toc" class="m4-l2"><a href="#m4-csvw-pocitadlo"><b>A.3</b><code>⟦⟧</code> CSV: počítadlo</a></p>
<p id="m4-upravy-specialnich-znaku-toc" class="m4-l2"><a href="#m4-upravy-specialnich-znaku"><b>A.4</b><code title="jak se to dělá" style="cursor:help">💡</code> Úpravy speciálních znaků</a></p>
<p id="m4-cw-vystupni-fronta-toc" class="m4-l2"><a href="#m4-cw-vystupni-fronta"><b>A.5</b><code>⟦⟧</code> C: výstupní fronta</a></p>
<p id="m4-iniw-externi-prikaz-toc" class="m4-l2"><a href="#m4-iniw-externi-prikaz"><b>A.6</b><code>⟦⟧</code> INI: externí příkaz</a></p>
<p id="m4-hw-hex-pocitadlo-toc" class="m4-l2"><a href="#m4-hw-hex-pocitadlo"><b>A.7</b><code>⟦⟧</code> .h: hex počítadlo</a></p>
<p id="m4-cw-maly-automat-toc" class="m4-l2"><a href="#m4-cw-maly-automat"><b>A.8</b><code>⟦⟧</code> C: malý automat</a></p>
<p id="m4-cw-maly-automat-2-toc" class="m4-l2"><a href="#m4-cw-maly-automat-2"><b>A.9</b><code>⟦⟧</code> C: malý automat 2</a></p>
<p id="m4-htmlw-vystupni-fronty-toc" class="m4-l2"><a href="#m4-htmlw-vystupni-fronty"><b>A.10</b><code>⟦⟧</code> HTML: výstupní fronty</a></p>
<p id="m4-vetveni-gramatikou-toc" class="m4-l2"><a href="#m4-vetveni-gramatikou"><b>A.11</b><code>⟦⟧</code> Větvení gramatikou</a></p>
<p id="m4-jsonw-generujici-automat-toc" class="m4-l2"><a href="#m4-jsonw-generujici-automat"><b>A.12</b><code>⟦⟧</code> JSON: generující automat</a></p>
<p id="m4-jsonw-pojmenovane-fronty-toc" class="m4-l3"><a href="#m4-jsonw-pojmenovane-fronty"><b>A.12.1</b><code>⟦⟧</code> JSON: pojmenované fronty</a></p>
<p id="m4-jsonw-generovane-indexy-front-toc" class="m4-l3"><a href="#m4-jsonw-generovane-indexy-front"><b>A.12.2</b><code>⟦⟧</code> JSON: generované indexy front</a></p>
<p id="m4-iniw-nespojity-index-front-toc" class="m4-l2"><a href="#m4-iniw-nespojity-index-front"><b>A.13</b><code>⟦⟧</code> INI: nespojitý index front</a></p>
<p id="m4-xmlw-smisene-zpravy-toc" class="m4-l2"><a href="#m4-xmlw-smisene-zpravy"><b>A.14</b><code>⟦⟧</code> XML: smíšené zprávy</a></p>
<p id="m4-xmlw-oddelene-zpravy-toc" class="m4-l2"><a href="#m4-xmlw-oddelene-zpravy"><b>A.15</b><code>⟦⟧</code> XML: oddělené zprávy</a></p>
<p id="m4-bash-echo-dretezecd-toc" class="m4-l2"><a href="#m4-bash-echo-dretezecd"><b>A.16</b><code>⟦⟧</code> Bash <code>$ echo &quot;řetězec&quot;</code></a></p>
<p id="m4-bash-echo-aretezeca-toc" class="m4-l2"><a href="#m4-bash-echo-aretezeca"><b>A.17</b><code>⟦⟧</code> Bash <code>$ echo 'řetězec'</code></a></p>
<div title="poznámka" class="rs-tip-major m4-note">Příklady v&nbsp;této příloze jsou složitější a&nbsp;jejich cílem je ukázat praktické použití jazyka M4.
Podrobněji budou vysvětleny později.</div>
<h3 id="m4-vstupni-zdrojovy-kod" class="m4-ch"><a href="#m4-vstupni-zdrojovy-kod-toc" title="Obsah"></a><a href="#m4-vstupni-zdrojovy-kod" title="⚓">A.1</a><code>⟦⟧</code> Vstupní zdrojový kód<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Vstupní zdrojový kód je podobný <abbr title="Comma Separated Values">CSV</abbr>, který se převede na libovolně složitý cílový kód jiného jazyka pomocí <abbr title="Context-Free Grammar – bezkontextová gramatika">CFG</abbr>, automatů a&nbsp;výstupních front.
Zásobníky v&nbsp;příkladech nejsou použity.
Vstupní zdrojový kód obsahuje speciální znaky, které je nutné skrýt:</p>
<div id="m4-messages_messages_raw-mc" class="m4-src"><pre># 2018/05/15 Josef Kubin

<span class="m4-r">ERROR</span>(⟦COMPLEX⟧,     ⟦!"#$%&amp;'()*+,-./:;&lt;=>?@[\]^_`{|}~⟧)
QUERY(⟦READABLE⟧,    ⟦Is badly written M4 code readable [N/y]?⟧)
<span class="m4-r">ERROR</span>(⟦SUCCESS⟧,     ⟦Too complex M4 code failed successfully.⟧)
WARNING(⟦ADDICTIVE⟧, ⟦Programming in M4 is addictive!⟧)
<span class="m4-r">ERROR</span>(⟦NO_FAULT⟧,    ⟦It's not a language fault!⟧)
WARNING(⟦NO_ERRORS⟧, ⟦No other errors were found.⟧)</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages_raw.mc" title="messages/messages_raw.mc
date: 20210103 13:28:44
sha1sum: d1f057c
size: 420 B">messages_raw.mc</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages_raw-mc" title="⚓"></a></code></div>
<div title="poznámka" class="rs-tip-major m4-note">Vstupní soubor může také obsahovat poznámky, které nemusí být skryté v&nbsp;komentářích <code>#</code>, <code>dnl</code>, <code>ifelse([…])</code> nebo <code>[… někde uvnitř závorek …]</code>.</div>
<h3 id="m4-csvw-nejjednodussi-priklad" class="m4-ch"><a href="#m4-csvw-nejjednodussi-priklad-toc" title="Obsah"></a><a href="#m4-csvw-nejjednodussi-priklad" title="⚓">A.2</a><code>⟦⟧</code> CSV: nejjednodušší příklad<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Tento příklad nepoužívá výstupní fronty, <span class="m4-hgl" data-9="R,5" data-10="1-3" data-8="R,3,5,7">pouze vypisuje</span> <abbr title="Comma Separated Values">CSV</abbr> oddělené znakem <code>TAB</code> na <span class="m4-hgl" data-9="4">standardní výstup</span>.</p>
<div id="m4-messages_hello-csv-m4" class="m4-src"><pre># A → β
define(⟦<span class="m4-r">ERROR</span>⟧, ⟦

	divert(0)dnl
⟦$1	$2⟧
divert(-1)
⟧)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/hello.csv.m4" title="messages/hello.csv.m4
date: 20201226 21:52:28
sha1sum: 020529d
size: 78 B">hello.csv.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_hello-csv-m4" title="⚓"></a></code></div>
<div id="m4-messages_hello-csv-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/hello.csv.m4" title="messages/hello.csv.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 020529d
size: 78 B">hello.csv.m4</a> <a href="../messages/messages_raw.mc" title="messages/messages_raw.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: d1f057c
size: 420 B">messages_raw.mc</a> > <a href="../messages/hello.csv" title="messages/hello.csv
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 429f847
size: 126 B">hello.csv</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_hello-csv-command" title="⚓"></a></code></div>
<div id="m4-messages_hello-csv" class="m4-src"><pre>COMPLEX	!"#$%&amp;'()*+,-./:;&lt;=>?@[\]^_`{|}~
SUCCESS	Too complex M4 code failed successfully.
NO_FAULT	It's not a language fault!</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/hello.csv" title="messages/hello.csv
date: 20210103 13:28:44
sha1sum: 429f847
size: 126 B">hello.csv</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_hello-csv" title="⚓"></a></code></div>
<h3 id="m4-csvw-pocitadlo" class="m4-ch"><a href="#m4-csvw-pocitadlo-toc" title="Obsah"></a><a href="#m4-csvw-pocitadlo" title="⚓">A.3</a><code>⟦⟧</code> CSV: počítadlo<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad používá makro <code class="m4-hgl" data-11="A">COUNT_UP</code> ze souboru <code>countu.m4</code>, jehož <abbr title="pravá strana přepisovacího pravidla"><code>β</code></abbr> se zkopíruje do pravé strany makra <code class="m4-hgl" data-11="2">COUNTER</code>.
Během první expanze <code class="m4-hgl" data-11="5">COUNTER</code> proběhne inicializace jeho startovací hodnoty.
<span class="m4-hgl" data-11="B">Další expanze</span> vrátí <span class="m4-hgl" data-12="A">číselný terminální symbol</span> a&nbsp;proběhne zvýšení vnitřního pomocného (globálního) symbolu o&nbsp;jedničku.
<code>COUNTER</code> je malý automat.</p>
<div id="m4-messages_counter-csv-m4" class="m4-src"><pre># A → β
define(⟦COUNTER⟧, defn(⟦<span class="m4-a">COUNT_UP</span>⟧))

# init counter
COUNTER(1)

# A → β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
ERR_⟦⟧<span class="m4-b">COUNTER</span>	⟦$1	$2⟧
divert(-1)
⟧)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/counter.csv.m4" title="messages/counter.csv.m4
date: 20201226 21:52:28
sha1sum: 63e2693
size: 179 B">counter.csv.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_counter-csv-m4" title="⚓"></a></code></div>
<div id="m4-messages_counter-csv-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../messages/counter.csv.m4" title="messages/counter.csv.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 63e2693
size: 179 B">counter.csv.m4</a> <a href="../messages/messages_raw.mc" title="messages/messages_raw.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: d1f057c
size: 420 B">messages_raw.mc</a> > <a href="../messages/counter.csv" title="messages/counter.csv
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 367d2b1
size: 144 B">counter.csv</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_counter-csv-command" title="⚓"></a></code></div>
<div id="m4-messages_counter-csv" class="m4-src"><pre>ERR_<span class="m4-a">1</span>	COMPLEX	!"#$%&amp;'()*+,-./:;&lt;=>?@[\]^_`{|}~
ERR_<span class="m4-a">2</span>	SUCCESS	Too complex M4 code failed successfully.
ERR_<span class="m4-a">3</span>	NO_FAULT	It's not a language fault!</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/counter.csv" title="messages/counter.csv
date: 20210103 13:28:44
sha1sum: 367d2b1
size: 144 B">counter.csv</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_counter-csv" title="⚓"></a></code></div>
<h3 id="m4-upravy-specialnich-znaku" class="m4-ch"><a href="#m4-upravy-specialnich-znaku-toc" title="Obsah"></a><a href="#m4-upravy-specialnich-znaku" title="⚓">A.4</a><code title="jak se to dělá" style="cursor:help">💡</code> Úpravy speciálních znaků<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Každý typ výstupního kódu vyžaduje úpravu speciálních znaků.
Klíčové slovo jazyka M4 <code>patsubst()</code> je nevhodné pro tento úkol.
Všechny speciální znaky vstupního souboru proto napřed skryjeme do <span class="m4-hgl" data-13="A">vhodně pojmenovaných maker</span> pomocí regulárních výrazů.</p>
<h4 id="m4-upraveny-vstupni-kod" class="m4-bh"><a href="#m4-upraveny-vstupni-kod" title="⚓"></a>Upravený vstupní kód<a href="#m4--toc" title="Nahoru"></a></h4>
<div id="m4-messages_messages-mc" class="m4-src"><pre title="všechny speciální znaky jsou skryty do maker"># 2018/05/15 Josef Kubin

ERROR(⟦COMPLEX⟧,     ⟦⟦⟧<span class="m4-a">EX()</span>⟦⟧<span class="m4-a">DQ()</span>⟦#⟧⟦⟧<span class="m4-a">DO()</span>%⟦⟧<span class="m4-a">AMP()</span>⟦⟧<span class="m4-a">AP()</span>()*+,-./:;⟦⟧<span class="m4-a">LT()</span>=⟦⟧<span class="m4-a">GT()</span>?@[⟦⟧<span class="m4-a">BS()</span>]^_⟦⟧<span class="m4-a">BQ()</span>{|}~⟧)
QUERY(⟦READABLE⟧,    ⟦Is badly written M4 code readable [N/y]?⟧)
ERROR(⟦SUCCESS⟧,     ⟦Too complex M4 code failed successfully.⟧)
WARNING(⟦ADDICTIVE⟧, ⟦Programming in M4 is addictive⟦⟧<span class="m4-a">EX()</span>⟧)
ERROR(⟦NO_FAULT⟧,    ⟦It⟦⟧<span class="m4-a">AP()</span>s not a language fault⟦⟧<span class="m4-a">EX()</span>⟧)
WARNING(⟦NO_ERRORS⟧, ⟦No other errors were found.⟧)</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
sha1sum: c6496e4
size: 535 B">messages.mc</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-mc" title="⚓"></a></code></div>
<h4 id="m4-prevodni-soubor-pro-xml-xslt" class="m4-bh"><a href="#m4-prevodni-soubor-pro-xml-xslt" title="⚓"></a><code>⟦⟧</code> Převodní soubor pro XML, XSLT, HTML<a href="#m4--toc" title="Nahoru"></a></h4>
<div id="m4-messages_markup-m4" class="m4-src"><pre title="převodní soubor pro značkovací jazyky"># A → β
define(⟦AMP⟧, ⟦&amp;amp;⟧)
define(⟦AP⟧, ⟦'⟧)
define(⟦BQ⟧, ⟦`⟧)
define(⟦BS⟧, ⟦\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦"⟧)
define(⟦EX⟧, ⟦!⟧)
define(⟦GT⟧, ⟦&amp;gt;⟧)
define(⟦LT⟧, ⟦&amp;lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/markup.m4" title="messages/markup.m4
date: 20201226 22:38:15
sha1sum: 98612ec
size: 256 B">markup.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_markup-m4" title="⚓"></a></code></div>
<h4 id="m4-prevodni-soubor-pro-c-json-in" class="m4-bh"><a href="#m4-prevodni-soubor-pro-c-json-in" title="⚓"></a><code>⟦⟧</code> Převodní soubor pro C, JSON, INI: <code>&quot;řetězec&quot;</code><a href="#m4--toc" title="Nahoru"></a></h4>
<div id="m4-messages_code-m4" class="m4-src"><pre title="převodní soubor pro zdrojový kód"># A → β
define(⟦AMP⟧, ⟦&amp;⟧)
define(⟦AP⟧, ⟦'⟧)
define(⟦BQ⟧, ⟦`⟧)
define(⟦BS⟧, ⟦\\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦\"⟧)
define(⟦EX⟧, ⟦!⟧)
define(⟦GT⟧, ⟦>⟧)
define(⟦LT⟧, ⟦&lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
sha1sum: d709e07
size: 248 B">code.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_code-m4" title="⚓"></a></code></div>
<h4 id="m4-prevodni-soubor-pro-bashw-dre" class="m4-bh"><a href="#m4-prevodni-soubor-pro-bashw-dre" title="⚓"></a><code>⟦⟧</code> Převodní soubor pro Bash: <code>&quot;řetězec&quot;</code><a href="#m4--toc" title="Nahoru"></a></h4>
<div id="m4-messages_doubleq-m4" class="m4-src"><pre title="převodní soubor pro Bash &quot;řetězce v uvozovkách&quot;"># A → β
define(⟦AMP⟧, ⟦&amp;⟧)
define(⟦AP⟧, ⟦'⟧)
define(⟦BQ⟧, ⟦\`⟧)
define(⟦BS⟧, ⟦\\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦\"⟧)
define(⟦EX⟧, ⟦"\!"⟧)
define(⟦GT⟧, ⟦>⟧)
define(⟦LT⟧, ⟦&lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/doubleq.m4" title="messages/doubleq.m4
date: 20201226 22:38:15
sha1sum: c94b763
size: 252 B">doubleq.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_doubleq-m4" title="⚓"></a></code></div>
<h4 id="m4-prevodni-soubor-pro-bashw-are" class="m4-bh"><a href="#m4-prevodni-soubor-pro-bashw-are" title="⚓"></a><code>⟦⟧</code> Převodní soubor pro Bash: <code>&apos;řetězec&apos;</code><a href="#m4--toc" title="Nahoru"></a></h4>
<div id="m4-messages_apost-m4" class="m4-src"><pre title="převodní soubor pro Bash 'řetězce v apostrofech'"># A → β
define(⟦AMP⟧, ⟦&amp;⟧)
define(⟦AP⟧, ⟦'\''⟧)
define(⟦BQ⟧, ⟦`⟧)
define(⟦BS⟧, ⟦\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦"⟧)
define(⟦EX⟧, ⟦!⟧)
define(⟦GT⟧, ⟦>⟧)
define(⟦LT⟧, ⟦&lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/apost.m4" title="messages/apost.m4
date: 20201226 22:38:15
sha1sum: e7eec73
size: 249 B">apost.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_apost-m4" title="⚓"></a></code></div>
<h4 id="m4-prevodni-soubor-pro-csv-m4-vr" class="m4-bh"><a href="#m4-prevodni-soubor-pro-csv-m4-vr" title="⚓"></a><code>⟦⟧</code> Převodní soubor pro CSV, M4 (vrátí všechny znaky zpátky)<a href="#m4--toc" title="Nahoru"></a></h4>
<div id="m4-messages_unchanged-m4" class="m4-src"><pre title="převodní soubor vrátí všechny speciální znaky zpátky"># A → β
define(⟦AMP⟧, ⟦&amp;⟧)
define(⟦AP⟧, ⟦'⟧)
define(⟦BQ⟧, ⟦`⟧)
define(⟦BS⟧, ⟦\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦"⟧)
define(⟦EX⟧, ⟦!⟧)
define(⟦GT⟧, ⟦>⟧)
define(⟦LT⟧, ⟦&lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/unchanged.m4" title="messages/unchanged.m4
date: 20201226 22:38:15
sha1sum: d2fb4b9
size: 246 B">unchanged.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_unchanged-m4" title="⚓"></a></code></div>
<h3 id="m4-cw-vystupni-fronta" class="m4-ch"><a href="#m4-cw-vystupni-fronta-toc" title="Obsah"></a><a href="#m4-cw-vystupni-fronta" title="⚓">A.5</a><code>⟦⟧</code> C: výstupní fronta<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad používá jednu <span class="m4-hgl" data-19="15">výstupní frontu</span> na znaky <code class="m4-hgl" data-19="16" data-20="9">};</code> pro uzavření <span class="m4-hgl" data-20="6-8" data-19="5">pole</span> na konci skriptu.</p>
<div id="m4-messages_array-c-m4" class="m4-src"><pre># A → β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
	"$2",
divert(-1)
⟧)

divert(0)dnl
/*
 * DONTE()
 */

char *error[] = {
divert(1)dnl
};
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/array.c.m4" title="messages/array.c.m4
date: 20201226 21:52:28
sha1sum: 8c6c428
size: 151 B">array.c.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_array-c-m4" title="⚓"></a></code></div>
<div id="m4-messages_array-c-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/array.c.m4" title="messages/array.c.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 8c6c428
size: 151 B">array.c.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/array.c" title="messages/array.c
date: 20200331 19:30:06
git rev: 9156810
sha1sum: 9651d22
size: 198 B">array.c</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_array-c-command" title="⚓"></a></code></div>
<div id="m4-messages_array-c" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

char *error[] = {
	"!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~",
	"Too complex M4 code failed successfully.",
	"It's not a language fault!",
};</pre><code><span class="m4-sha">9156810</span><a href="../messages/array.c" title="messages/array.c
date: 20200331 19:30:06
sha1sum: 9651d22
size: 198 B">array.c</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_array-c" title="⚓"></a></code></div>
<h3 id="m4-iniw-externi-prikaz" class="m4-ch"><a href="#m4-iniw-externi-prikaz-toc" title="Obsah"></a><a href="#m4-iniw-externi-prikaz" title="⚓">A.6</a><code>⟦⟧</code> INI: externí příkaz<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad spustí externí příkaz <code class="m4-hgl" data-21="D" data-22="3">date</code> a&nbsp;jeho výstup umístí do hranatých závorek.
Výstupem externího příkazu jsou <span class="m4-hgl" data-21="A">dvě položky oddělené čárkou</span>.
Makro <code class="m4-hgl" data-21="C">SARG1()</code> <span class="m4-hgl" data-21="B">vybere první položku</span>, protože druhá položka obsahuje nežádoucí znak nového řádku <code>LF</code> (<samp>0x0a</samp>).</p>
<div id="m4-messages_hello-ini-m4" class="m4-src"><pre># A → β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
⟦$1⟧="$2"
divert(-1)
⟧)

divert(0)dnl
; DONTE()

<span class="m4-c">SARG1</span>(esyscmd(⟦<span class="m4-d">date '+<span class="m4-b">⟦[hello_%Y%m%d]⟧</span><span class="m4-a">,</span>'</span>⟧))
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/hello.ini.m4" title="messages/hello.ini.m4
date: 20201226 21:52:28
sha1sum: a7f4062
size: 168 B">hello.ini.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_hello-ini-m4" title="⚓"></a></code></div>
<div id="m4-messages_hello-ini-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/hello.ini.m4" title="messages/hello.ini.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: a7f4062
size: 168 B">hello.ini.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/hello.ini" title="messages/hello.ini
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: e38f80a
size: 205 B">hello.ini</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_hello-ini-command" title="⚓"></a></code></div>
<div id="m4-messages_hello-ini" class="m4-src"><pre>; DO NOT EDIT! This file is generated automatically!

[hello_20210118]
COMPLEX="!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"
SUCCESS="Too complex M4 code failed successfully."
NO_FAULT="It's not a language fault!"</pre><code><span class="m4-sha">02f55b8</span><a href="../messages/hello.ini" title="messages/hello.ini
date: 20210118 19:23:51
sha1sum: e38f80a
size: 205 B">hello.ini</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_hello-ini" title="⚓"></a></code></div>
<h3 id="m4-hw-hex-pocitadlo" class="m4-ch"><a href="#m4-hw-hex-pocitadlo-toc" title="Obsah"></a><a href="#m4-hw-hex-pocitadlo" title="⚓">A.7</a><code>⟦⟧</code> .h: hex počítadlo<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad používá makro <code class="m4-hgl" data-23="A,2">COUNTER</code> pro číslování výsledných <abbr title="Preprocesor jazyka C">CPP</abbr> <span class="m4-hgl" data-23="11" data-24="8-10">maker</span> a&nbsp;jednu výstupní frontu.
Fronta číslo <code class="m4-hgl" data-23="23">1</code> obsahuje direktivu preprocesoru <code class="m4-hgl" data-23="24" data-24="12">#endif</code> pro zakončení hlavičkového souboru.
Převod dekadické hodnoty počítadla na <span class="m4-hgl" data-23="B">dvoumístné hex-a číslo</span> provádí klíčové slovo <code class="m4-hgl" data-23="C">eval()</code>.</p>
<div id="m4-messages_messages-h-m4" class="m4-src"><pre># A → β
define(⟦<span class="m4-a">COUNTER</span>⟧, defn(⟦COUNT_UP⟧))

# init counter
<span class="m4-a">COUNTER(0)</span>

# A → β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
⟦#define $1		0x⟧<span class="m4-c">eval</span>(<span class="m4-a">COUNTER</span>, <span class="m4-b">16, 2</span>)
divert(-1)
⟧)

divert(0)dnl
/*
 * DONTE()
 */

#ifndef __ERROR_H
#define __ERROR_H

divert(1)
#endif /* __ERROR_H */
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/messages.h.m4" title="messages/messages.h.m4
date: 20201226 21:52:28
sha1sum: cc44faa
size: 304 B">messages.h.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-h-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-h-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../messages/messages.h.m4" title="messages/messages.h.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: cc44faa
size: 304 B">messages.h.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.h" title="messages/messages.h
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: a2f1f33
size: 190 B">messages.h</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-h-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-h" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

#ifndef __ERROR_H
#define __ERROR_H

#define COMPLEX		0x00
#define SUCCESS		0x01
#define NO_FAULT		0x02

#endif /* __ERROR_H */</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.h" title="messages/messages.h
date: 20210103 13:28:44
sha1sum: a2f1f33
size: 190 B">messages.h</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-h" title="⚓"></a></code></div>
<h3 id="m4-cw-maly-automat" class="m4-ch"><a href="#m4-cw-maly-automat-toc" title="Obsah"></a><a href="#m4-cw-maly-automat" title="⚓">A.8</a><code>⟦⟧</code> C: malý automat<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad používá <span class="m4-hgl" data-25="1-4">malý automat</span> <code class="m4-hgl" data-25="7">NEW_LINE</code> pro generování znaku nového řádku <code class="m4-hgl" data-25="A" data-26="A">\n</code> a&nbsp;jednu výstupní frontu číslo <code class="m4-hgl" data-25="22">1</code> do které se vloží znaky <code class="m4-hgl" data-25="B">";</code> pro uzavření výsledného řetězce.
Poprvé se <code class="m4-hgl" data-25="C">NEW_LINE</code> přepíše na <abbr title="epsilon – prázdný symbol"><code class="m4-hgl" data-25="D">ε</code></abbr>, podruhé a dále se přepíše na <code class="m4-hgl" data-25="A" data-26="A">\n</code>.</p>
<div id="m4-messages_stringl-c-m4" class="m4-src"><pre>#     NEW_LINE automaton
#      ___      ____
# --->/ <span class="m4-d">ε</span> \--->/ <span class="m4-a">\n</span> \---.
#     \___/    \____/&lt;--'

# A → β
define(⟦NEW_LINE⟧, ⟦define(⟦$0⟧, ⟦<span class="m4-a">\n</span>⟧)⟧)

# A → β
define(⟦ERROR⟧, ⟦

	divert(0)<span class="m4-c">NEW_LINE</span>⟦⟧$2⟦⟧dnl
divert(-1)
⟧)

divert(0)dnl
/*
 * DONTE()
 */

char error[] =
"divert(1)<span class="m4-b">";</span>
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/stringl.c.m4" title="messages/stringl.c.m4
date: 20201226 21:52:28
sha1sum: daf85ec
size: 329 B">stringl.c.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_stringl-c-m4" title="⚓"></a></code></div>
<div id="m4-messages_stringl-c-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/stringl.c.m4" title="messages/stringl.c.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: daf85ec
size: 329 B">stringl.c.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/stringl.c" title="messages/stringl.c
date: 20200331 19:30:06
git rev: 9156810
sha1sum: dc45b92
size: 185 B">stringl.c</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_stringl-c-command" title="⚓"></a></code></div>
<div id="m4-messages_stringl-c" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

char error[] =
"!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~<span class="m4-a">\n</span>Too complex M4 code failed successfully.<span class="m4-a">\n</span>It's not a language fault!";</pre><code><span class="m4-sha">9156810</span><a href="../messages/stringl.c" title="messages/stringl.c
date: 20200331 19:30:06
sha1sum: dc45b92
size: 185 B">stringl.c</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_stringl-c" title="⚓"></a></code></div>
<h3 id="m4-cw-maly-automat-2" class="m4-ch"><a href="#m4-cw-maly-automat-2-toc" title="Obsah"></a><a href="#m4-cw-maly-automat-2" title="⚓">A.9</a><code>⟦⟧</code> C: malý automat 2<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Tento příklad je podobný předchozímu, avšak každý řetězec <span class="m4-hgl" data-27="A" data-28="A">je na novém řádku</span>.</p>
<div id="m4-messages_string-c-m4" class="m4-src"><pre>#      NEW_LINE automaton
#      ___      _________
# --->/ ε \--->/ \n"\xa" \---.
#     \___/    \_________/&lt;--'

# A → β
define(⟦NEW_LINE⟧, ⟦define(⟦$0⟧, ⟦<span class="m4-a">\n"
"</span>⟧)⟧)

# A → β
define(⟦ERROR⟧, ⟦

	divert(0)NEW_LINE⟦⟧$2⟦⟧dnl
divert(-1)
⟧)

divert(0)dnl
/*
 * DONTE()
 */

char error[] =
"divert(1)";
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/string.c.m4" title="messages/string.c.m4
date: 20201226 21:52:28
sha1sum: 4b4d1b8
size: 348 B">string.c.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_string-c-m4" title="⚓"></a></code></div>
<div id="m4-messages_string-c-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/string.c.m4" title="messages/string.c.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 4b4d1b8
size: 348 B">string.c.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/string.c" title="messages/string.c
date: 20200331 19:30:06
git rev: 9156810
sha1sum: 76ca62e
size: 191 B">string.c</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_string-c-command" title="⚓"></a></code></div>
<div id="m4-messages_string-c" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

char error[] =
"!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~<span class="m4-a">\n"
"</span>Too complex M4 code failed successfully.<span class="m4-a">\n"
"</span>It's not a language fault!";</pre><code><span class="m4-sha">9156810</span><a href="../messages/string.c" title="messages/string.c
date: 20200331 19:30:06
sha1sum: 76ca62e
size: 191 B">string.c</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_string-c" title="⚓"></a></code></div>
<h3 id="m4-htmlw-vystupni-fronty" class="m4-ch"><a href="#m4-htmlw-vystupni-fronty-toc" title="Obsah"></a><a href="#m4-htmlw-vystupni-fronty" title="⚓">A.10</a><code>⟦⟧</code> HTML: výstupní fronty<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad používá <span class="m4-hgl" data-29="9,27,29">dvě výstupní fronty</span>.
Fronta číslo <code class="m4-hgl" data-29="9,27">1</code> obsahuje <span class="m4-hgl" data-29="10" data-30="16-21">odstavce</span>,
fronta číslo <code class="m4-hgl" data-29="29">2</code> <span class="m4-hgl" data-29="30-31" data-30="22-23">uzavírací značky HTML</span> stránky.
<span class="m4-hgl" data-29="8" data-30="9-14">Navigační odkazy</span> nemusí být nikde uloženy, <span class="m4-hgl" data-29="7">jdou přímo na výstup</span>.
Zprávy typu <code class="m4-hgl" data-29="15">QUERY</code> a&nbsp;<code class="m4-hgl" data-29="16">WARNING</code> jsou zpracovány stejně jako zprávy typu <code class="m4-hgl" data-29="5-12">ERROR</code>.</p>
<div id="m4-messages_messages-html-m4" class="m4-src"><pre># vim:ft=m4

# A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
		⟦&lt;li>$0: &lt;a href="#$1">$1&lt;/a>&lt;/li>⟧
divert(1)dnl
	&lt;p id="⟦$1⟧">$2&lt;/p>
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧, defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
&lt;!-- DONTE() -->
&lt;!doctype html>
&lt;html lang="en">
	&lt;meta charset="utf-8">
	&lt;title>__file__&lt;/title>
&lt;body>
	&lt;h1>The power of M4&lt;/h1>
	&lt;ul>
divert(1)dnl
	&lt;/ul>
divert(2)dnl
&lt;/body>
&lt;/html>
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/messages.html.m4" title="messages/messages.html.m4
date: 20201226 21:52:28
sha1sum: 3911284
size: 468 B">messages.html.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-html-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-html-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/messages.html.m4" title="messages/messages.html.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 3911284
size: 468 B">messages.html.m4</a> <a href="../messages/markup.m4" title="messages/markup.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: 98612ec
size: 256 B">markup.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.html" title="messages/messages.html
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 20b155f
size: 866 B">messages.html</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-html-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-html" class="m4-src"><pre>&lt;!-- DO NOT EDIT! This file is generated automatically! -->
&lt;!doctype html>
&lt;html lang="en">
	&lt;meta charset="utf-8">
	&lt;title>messages.html.m4&lt;/title>
&lt;body>
	&lt;h1>The power of M4&lt;/h1>
	&lt;ul>
		&lt;li>ERROR: &lt;a href="#COMPLEX">COMPLEX&lt;/a>&lt;/li>
		&lt;li>QUERY: &lt;a href="#READABLE">READABLE&lt;/a>&lt;/li>
		&lt;li>ERROR: &lt;a href="#SUCCESS">SUCCESS&lt;/a>&lt;/li>
		&lt;li>WARNING: &lt;a href="#ADDICTIVE">ADDICTIVE&lt;/a>&lt;/li>
		&lt;li>ERROR: &lt;a href="#NO_FAULT">NO_FAULT&lt;/a>&lt;/li>
		&lt;li>WARNING: &lt;a href="#NO_ERRORS">NO_ERRORS&lt;/a>&lt;/li>
	&lt;/ul>
	&lt;p id="COMPLEX">!"#$%&amp;amp;'()*+,-./:;&amp;lt;=&amp;gt;?@[\]^_`{|}~&lt;/p>
	&lt;p id="READABLE">Is badly written M4 code readable [N/y]?&lt;/p>
	&lt;p id="SUCCESS">Too complex M4 code failed successfully.&lt;/p>
	&lt;p id="ADDICTIVE">Programming in M4 is addictive!&lt;/p>
	&lt;p id="NO_FAULT">It's not a language fault!&lt;/p>
	&lt;p id="NO_ERRORS">No other errors were found.&lt;/p>
&lt;/body>
&lt;/html></pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.html" title="messages/messages.html
date: 20210103 13:28:44
sha1sum: 20b155f
size: 866 B">messages.html</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-html" title="⚓"></a></code></div>
<h3 id="m4-vetveni-gramatikou" class="m4-ch"><a href="#m4-vetveni-gramatikou-toc" title="Obsah"></a><a href="#m4-vetveni-gramatikou" title="⚓">A.11</a><code>⟦⟧</code> Větvení gramatikou<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad ukazuje <a href="#m4-vetveni-gramatikou-zakladni-p" title="Větvení gramatikou – základní princip">větvení gramatikou</a>, argumenty maker se ignorují.
Vstupní neterminály se přepisují na terminály <code title="🐛" class="m4-hgl" data-31="6,13" data-32="A">ERROR → 🐛</code>,
<code title="🐜" class="m4-hgl" data-31="6,14" data-32="B">QUERY → 🐜</code>,
<code title="🐝" class="m4-hgl" data-31="6,15" data-32="C">WARNING → 🐝</code>.</p>
<div id="m4-messages_insect-txt-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
$0_INSECT⟦⟧dnl
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧,   defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))
define(⟦ERROR_INSECT⟧,   ⟦🐛⟧)
define(⟦QUERY_INSECT⟧,   ⟦🐜⟧)
define(⟦WARNING_INSECT⟧, ⟦🐝⟧)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/insect.txt.m4" title="messages/insect.txt.m4
date: 20201226 21:52:28
sha1sum: ce656e5
size: 307 B">insect.txt.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_insect-txt-m4" title="⚓"></a></code></div>
<div id="m4-messages_insect-txt-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/insect.txt.m4" title="messages/insect.txt.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: ce656e5
size: 307 B">insect.txt.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/insect.txt" title="messages/insect.txt
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: a08c5e8
size: 24 B">insect.txt</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_insect-txt-command" title="⚓"></a></code></div>
<div id="m4-messages_insect-txt" class="m4-src"><pre><span class="m4-a">🐛</span><span class="m4-b">🐜</span><span class="m4-a">🐛</span><span class="m4-c">🐝</span><span class="m4-a">🐛</span><span class="m4-c">🐝</span></pre><code><span class="m4-sha">b53eafe</span><a href="../messages/insect.txt" title="messages/insect.txt
date: 20200106 16:21:10
sha1sum: a08c5e8
size: 24 B">insect.txt</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_insect-txt" title="⚓"></a></code></div>
<h4 id="m4-vetveni-gramatikou-zakladni-p" class="m4-bh"><a href="#m4-vetveni-gramatikou-zakladni-p" title="⚓"></a>Větvení gramatikou – základní princip<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Proměnná <code class="m4-hgl" data-33="A">$0</code> se nahradí za <span class="m4-hgl" data-33="B">jméno makra</span> a&nbsp;<span class="m4-hgl" data-33="C">zřetězí se s&nbsp;dalším symbolem</span>.
<span class="m4-hgl" data-33="B,C">Nově vzniklý neterminál</span> se přepíše na odpovídající <span class="m4-hgl" data-33="D">terminální symbol</span> (číslo fronty nebo jméno).</p>
<div id="m4-nonterminals-for-branches" title="větvení gramatikou v M4" class="m4-src"><pre><span class="m4-a">$0</span>_QU → <span class="m4-b">ERROR</span><span class="m4-c">_QU</span> → <span class="m4-d">2</span>
<span class="m4-a">$0</span>_END → <span class="m4-b">ERROR</span><span class="m4-c">_END</span> → <span class="m4-d">3</span>
<span class="m4-a">$0</span>_NAME → <span class="m4-b">ERROR</span><span class="m4-c">_NAME</span> → <span class="m4-d">error</span>
<span class="m4-a">$0</span>_QU → <span class="m4-b">QUERY</span><span class="m4-c">_QU</span> → <span class="m4-d">0</span>
<span class="m4-a">$0</span>_END → <span class="m4-b">QUERY</span><span class="m4-c">_END</span> → <span class="m4-d">1</span>
<span class="m4-a">$0</span>_NAME → <span class="m4-b">QUERY</span><span class="m4-c">_NAME</span> → <span class="m4-d">query</span>
…</pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-nonterminals-for-branches" title="⚓"></a></code></div>
<h3 id="m4-jsonw-generujici-automat" class="m4-ch"><a href="#m4-jsonw-generujici-automat-toc" title="Obsah"></a><a href="#m4-jsonw-generujici-automat" title="⚓">A.12</a><code>⟦⟧</code> JSON: generující automat<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad používá <span class="m4-hgl" data-34="14,30">dvě výstupní fronty</span> a&nbsp;jeden <span class="m4-hgl" data-34="1-3">generující automat</span>.
První chybová zpráva <code>ERROR(⟦…⟧)</code> ve stavu <code class="m4-hgl" data-34="6-17">ERROR</code> vygeneruje <span class="m4-hgl" data-34="12,15" data-35="3,7">záhlaví se závorkami</span> a&nbsp;vypíše <span class="m4-hgl" data-34="11">na výstup</span> <span class="m4-hgl" data-34="13" data-35="4">první záznam</span>.
<span class="m4-hgl" data-34="8,9">Automat přejde</span> do stavu <code class="m4-hgl" data-34="20-25">NEXT_ITEM</code> což je <abbr title="takové pravidlo se používá jako pravá strana jiného přepisovacího pravidla"><code class="m4-hgl" data-34="19">β</code> pravidlo</abbr>.
Následující chybové zprávy ve stavu <code class="m4-hgl" data-34="20-25">NEXT_ITEM</code> pouze <span class="m4-hgl" data-34="22">vypisují na výstup</span> <span class="m4-hgl" data-34="23" data-35="5,6">jednotlivé záznamy</span>.
Na závěr výstupní fronty číslo <code class="m4-hgl" data-34="14">1</code> a&nbsp;<code class="m4-hgl" data-34="30">2</code> vypíšou znaky <code class="m4-hgl" data-34="15" data-35="7">]</code> a&nbsp;<code class="m4-hgl" data-34="31" data-35="8">}}</code> čímž zakončí výsledný JSON.</p>
<div id="m4-messages_atm-json-m4" class="m4-src"><pre>#      _______      ___________
# --->/ ERROR \--->/ NEXT_ITEM \---.
#     \_______/    \___________/&lt;--'

# A → β
define(⟦ERROR⟧, ⟦

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))

	divert(0),
	"error": [
		{"⟦$1⟧": "$2"}dnl
divert(1)
	]
divert(-1)
⟧)

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert(0),
		{"⟦$1⟧": "$2"}dnl
divert(-1)
⟧)

divert(0)dnl
{"generating_automaton": {
	"_comment": "DONTE()"dnl
divert(2)dnl
}}
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/atm.json.m4" title="messages/atm.json.m4
date: 20201226 21:52:28
sha1sum: f09f617
size: 474 B">atm.json.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_atm-json-m4" title="⚓"></a></code></div>
<div id="m4-messages_atm-json-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/atm.json.m4" title="messages/atm.json.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: f09f617
size: 474 B">atm.json.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/atm.json" title="messages/atm.json
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 841e816
size: 269 B">atm.json</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_atm-json-command" title="⚓"></a></code></div>
<div id="m4-messages_atm-json" class="m4-src"><pre>{"generating_automaton": {
	"_comment": "DO NOT EDIT! This file is generated automatically!",
	"error": [
		{"COMPLEX": "!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"},
		{"SUCCESS": "Too complex M4 code failed successfully."},
		{"NO_FAULT": "It's not a language fault!"}
	]
}}</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/atm.json" title="messages/atm.json
date: 20210103 13:28:44
sha1sum: 841e816
size: 269 B">atm.json</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_atm-json" title="⚓"></a></code></div>
<h4 id="m4-jsonw-pojmenovane-fronty" class="m4-ch"><a href="#m4-jsonw-pojmenovane-fronty-toc" title="Obsah"></a><a href="#m4-jsonw-pojmenovane-fronty" title="⚓">A.12.1</a><code>⟦⟧</code> JSON: pojmenované fronty<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Příklad zpracovává další zprávy typu <code>QUERY</code> a&nbsp;<code>WARNING</code>.
Používá tři automaty a&nbsp;šest výstupních front.
Generujeme-li složitější zdrojový kód, brzy narazíme na problém udržení konzistence indexů pro výstupní fronty.
Abychom se vyhnuli zmatku, pojmenujeme si fronty a&nbsp;místo čísel používáme jména.
Abychom nemuseli definovat podobná pravidla, zkopírujeme si pravou stranu <code>ERROR</code> (je to také <abbr title="takové pravidlo se používá jako pravá strana jiného přepisovacího pravidla"><code class="m4-hgl" data-36="21">β</code> pravidlo</abbr>) do pravé strany pravidel <code>QUERY</code> a&nbsp;<code>WARNING</code>.</p>
<div id="m4-messages_qnames-json-m4" class="m4-src"><pre># DO NOT WRITE INDEXES MANUALLY, use counter!
define(⟦QUERY_QU⟧,     0)
define(⟦QUERY_END⟧,    1)
define(⟦ERROR_QU⟧,     2)
define(⟦ERROR_END⟧,    3)
define(⟦WARNING_QU⟧,   4)
define(⟦WARNING_END⟧,  5)
define(⟦LAST_QUEUE⟧,   6)

# names of message types
define(⟦WARNING_NAME⟧, ⟦warning⟧)
define(⟦ERROR_NAME⟧,   ⟦error⟧)
define(⟦QUERY_NAME⟧,   ⟦query⟧)

#      _________      ___________
# --->/  ERROR  \--->/ NEXT_ITEM \---.
#     |  QUERY  |    \___________/&lt;--'
#     \_WARNING_/

# A → β
# β
define(⟦ERROR⟧, ⟦

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))

	divert($0_QU),
	"$0_NAME": [
		{"⟦$1⟧": "$2"}dnl
divert($0_END)
	]dnl
divert(-1)
⟧)

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert($0_QU),
		{"⟦$1⟧": "$2"}dnl
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧,        defn(⟦ERROR⟧))
define(⟦WARNING⟧,      defn(⟦ERROR⟧))

divert(0)dnl
{"queue_names": {
	"_comment": "DONTE()"dnl
divert(LAST_QUEUE)
}}
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/qnames.json.m4" title="messages/qnames.json.m4
date: 20201226 21:52:28
sha1sum: 1e3b868
size: 1027 B">qnames.json.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_qnames-json-m4" title="⚓"></a></code></div>
<div id="m4-messages_qnames-json-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/qnames.json.m4" title="messages/qnames.json.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 1e3b868
size: 1027 B">qnames.json.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/qnames.json" title="messages/qnames.json
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 3c39e26
size: 452 B">qnames.json</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_qnames-json-command" title="⚓"></a></code></div>
<div id="m4-messages_qnames-json" class="m4-src"><pre>{"queue_names": {
	"_comment": "DO NOT EDIT! This file is generated automatically!",
	"query": [
		{"READABLE": "Is badly written M4 code readable [N/y]?"}
	],
	"error": [
		{"COMPLEX": "!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"},
		{"SUCCESS": "Too complex M4 code failed successfully."},
		{"NO_FAULT": "It's not a language fault!"}
	],
	"warning": [
		{"ADDICTIVE": "Programming in M4 is addictive!"},
		{"NO_ERRORS": "No other errors were found."}
	]
}}</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/qnames.json" title="messages/qnames.json
date: 20210103 13:28:44
sha1sum: 3c39e26
size: 452 B">qnames.json</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_qnames-json" title="⚓"></a></code></div>
<h4 id="m4-jsonw-generovane-indexy-front" class="m4-ch"><a href="#m4-jsonw-generovane-indexy-front-toc" title="Obsah"></a><a href="#m4-jsonw-generovane-indexy-front" title="⚓">A.12.2</a><code>⟦⟧</code> JSON: generované indexy front<a href="#m4--toc" title="Nahoru"></a></h4>
<p>Během vývoje se často mění pořadí a&nbsp;počet výstupních front, což také vyžaduje častou změnu jejich indexů.
<span class="m4-hgl" data-38="A">Indexy je proto vhodné generovat</span>.
Můžeme pak používat prakticky neomezený počet front.
Následující příklad ukazuje, jak se tyto indexy generují.</p>
<div id="m4-messages_queues-m4" class="m4-src"><pre># defines a counter for output queues
# A → β
define(⟦QUEUE_INDEX⟧, defn(⟦COUNT_UP⟧))

# index of the first output queue (0 is stdout)
QUEUE_INDEX(0)

# symbolic names for indices of output queues
# A → β
define(⟦QUERY_QU⟧,     <span class="m4-a">QUEUE_INDEX</span>)
define(⟦QUERY_END⟧,    <span class="m4-a">QUEUE_INDEX</span>)
define(⟦ERROR_QU⟧,     <span class="m4-a">QUEUE_INDEX</span>)
define(⟦ERROR_END⟧,    <span class="m4-a">QUEUE_INDEX</span>)
define(⟦WARNING_QU⟧,   <span class="m4-a">QUEUE_INDEX</span>)
define(⟦WARNING_END⟧,  <span class="m4-a">QUEUE_INDEX</span>)
# Keep it last!
define(⟦LAST_QUEUE⟧,   <span class="m4-a">QUEUE_INDEX</span>)

# names of message types
# A → β
define(⟦WARNING_NAME⟧, ⟦warning⟧)
define(⟦ERROR_NAME⟧,   ⟦error⟧)
define(⟦QUERY_NAME⟧,   ⟦query⟧)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
sha1sum: 79f498c
size: 674 B">queues.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_queues-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-json-m4" class="m4-src"><pre>#      _________      ___________
# --->/  ERROR  \--->/ NEXT_ITEM \---.
#     |  QUERY  |    \___________/&lt;--'
#     \_WARNING_/

# A → β
# β
define(⟦ERROR⟧, ⟦

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))

	divert($0_QU),
	"$0_NAME": [
		{"⟦$1⟧": "$2"}dnl
divert($0_END)
	]dnl
divert(-1)
⟧)

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert($0_QU),
		{"⟦$1⟧": "$2"}dnl
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧,   defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
{"messages": {
	"_comment": "DONTE()"dnl
divert(LAST_QUEUE)
}}
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/messages.json.m4" title="messages/messages.json.m4
date: 20201226 21:52:28
sha1sum: f74c194
size: 609 B">messages.json.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-json-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-json-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 79f498c
size: 674 B">queues.m4</a> <a href="../messages/messages.json.m4" title="messages/messages.json.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: f74c194
size: 609 B">messages.json.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.json" title="messages/messages.json
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: cc6ff19
size: 449 B">messages.json</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-json-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-json" class="m4-src"><pre>{"messages": {
	"_comment": "DO NOT EDIT! This file is generated automatically!",
	"query": [
		{"READABLE": "Is badly written M4 code readable [N/y]?"}
	],
	"error": [
		{"COMPLEX": "!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"},
		{"SUCCESS": "Too complex M4 code failed successfully."},
		{"NO_FAULT": "It's not a language fault!"}
	],
	"warning": [
		{"ADDICTIVE": "Programming in M4 is addictive!"},
		{"NO_ERRORS": "No other errors were found."}
	]
}}</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.json" title="messages/messages.json
date: 20210103 13:28:44
sha1sum: cc6ff19
size: 449 B">messages.json</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-json" title="⚓"></a></code></div>
<h3 id="m4-iniw-nespojity-index-front" class="m4-ch"><a href="#m4-iniw-nespojity-index-front-toc" title="Obsah"></a><a href="#m4-iniw-nespojity-index-front" title="⚓">A.13</a><code>⟦⟧</code> INI: nespojitý index front<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad používá <span class="m4-hgl" data-41="1-4">tři automaty</span> a&nbsp;dvě výstupní fronty číslo <code class="m4-hgl" data-41="10,26">2</code> a&nbsp;<code class="m4-hgl" data-41="10,26">4</code> definované v&nbsp;odděleném souboru.
<span class="m4-hgl" data-41="11" data-42="3,6,11">Názvy INI sekcí</span> jsou generovány <span class="m4-hgl" data-41="A,R">řetězením symbolů</span> (viz. <a href="#m4-vetveni-gramatikou-zakladni-p" title="Větvení gramatikou – základní princip">větvení</a>).
Příklad používá stejný soubor pro výstupní fronty jako <a href="#m4-jsonw-generovane-indexy-front" title="⟦⟧ JSON: generované indexy front">příklad</a> pro generování JSON.</p>
<div id="m4-messages_messages-ini-m4" class="m4-src"><pre>#      _________      ___________
# --->/  ERROR  \--->/ NEXT_ITEM \---.
#     |  QUERY  |    \___________/&lt;--'
#     \_WARNING_/

# A → β
# β
define(⟦ERROR⟧, ⟦

	divert($0_QU)
[<span class="m4-r">$0</span><span class="m4-a">_NAME</span>]
⟦$1⟧="$2"
divert(-1)

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))
⟧)

# A → β
define(⟦QUERY⟧,   defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert($0_QU)dnl
⟦$1⟧="$2"
divert(-1)
⟧)

divert(0)dnl
; DONTE()
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/messages.ini.m4" title="messages/messages.ini.m4
date: 20201226 21:52:28
sha1sum: fb8782f
size: 512 B">messages.ini.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-ini-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-ini-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/messages.ini.m4" title="messages/messages.ini.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: fb8782f
size: 512 B">messages.ini.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 79f498c
size: 674 B">queues.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.ini" title="messages/messages.ini
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: cf65110
size: 352 B">messages.ini</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-ini-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-ini" class="m4-src"><pre>; DO NOT EDIT! This file is generated automatically!

[query]
READABLE="Is badly written M4 code readable [N/y]?"

[error]
COMPLEX="!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"
SUCCESS="Too complex M4 code failed successfully."
NO_FAULT="It's not a language fault!"

[warning]
ADDICTIVE="Programming in M4 is addictive!"
NO_ERRORS="No other errors were found."</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.ini" title="messages/messages.ini
date: 20210103 13:28:44
sha1sum: cf65110
size: 352 B">messages.ini</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-ini" title="⚓"></a></code></div>
<h3 id="m4-xmlw-smisene-zpravy" class="m4-ch"><a href="#m4-xmlw-smisene-zpravy-toc" title="Obsah"></a><a href="#m4-xmlw-smisene-zpravy" title="⚓">A.14</a><code>⟦⟧</code> XML: smíšené zprávy<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad používá jednu výstupní frontu číslo <code class="m4-hgl" data-43="21">1</code> pro uzavírací značku <code class="m4-hgl" data-43="22" data-44="28">&lt;/messages&gt;</code>.</p>
<div id="m4-messages_mixed-xml-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
	&lt;$0_NAME>
		&lt;name>⟦$1⟧&lt;/name>
		&lt;value>$2&lt;/value>
	&lt;/$0_NAME>
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧, defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
&lt;!-- DONTE() -->
&lt;?xml version="1.0" encoding="utf-8"?>
&lt;messages>
divert(1)dnl
&lt;/messages>
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/mixed.xml.m4" title="messages/mixed.xml.m4
date: 20201226 21:52:28
sha1sum: d43ef91
size: 347 B">mixed.xml.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_mixed-xml-m4" title="⚓"></a></code></div>
<div id="m4-messages_mixed-xml-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 79f498c
size: 674 B">queues.m4</a> <a href="../messages/mixed.xml.m4" title="messages/mixed.xml.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: d43ef91
size: 347 B">mixed.xml.m4</a> <a href="../messages/markup.m4" title="messages/markup.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: 98612ec
size: 256 B">markup.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/mixed.xml" title="messages/mixed.xml
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: b907138
size: 702 B">mixed.xml</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_mixed-xml-command" title="⚓"></a></code></div>
<div id="m4-messages_mixed-xml" class="m4-src"><pre>&lt;!-- DO NOT EDIT! This file is generated automatically! -->
&lt;?xml version="1.0" encoding="utf-8"?>
&lt;messages>
	&lt;error>
		&lt;name>COMPLEX&lt;/name>
		&lt;value>!"#$%&amp;amp;'()*+,-./:;&amp;lt;=&amp;gt;?@[\]^_`{|}~&lt;/value>
	&lt;/error>
	&lt;query>
		&lt;name>READABLE&lt;/name>
		&lt;value>Is badly written M4 code readable [N/y]?&lt;/value>
	&lt;/query>
	&lt;error>
		&lt;name>SUCCESS&lt;/name>
		&lt;value>Too complex M4 code failed successfully.&lt;/value>
	&lt;/error>
	&lt;warning>
		&lt;name>ADDICTIVE&lt;/name>
		&lt;value>Programming in M4 is addictive!&lt;/value>
	&lt;/warning>
	&lt;error>
		&lt;name>NO_FAULT&lt;/name>
		&lt;value>It's not a language fault!&lt;/value>
	&lt;/error>
	&lt;warning>
		&lt;name>NO_ERRORS&lt;/name>
		&lt;value>No other errors were found.&lt;/value>
	&lt;/warning>
&lt;/messages></pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/mixed.xml" title="messages/mixed.xml
date: 20210103 13:28:44
sha1sum: b907138
size: 702 B">mixed.xml</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_mixed-xml" title="⚓"></a></code></div>
<h3 id="m4-xmlw-oddelene-zpravy" class="m4-ch"><a href="#m4-xmlw-oddelene-zpravy-toc" title="Obsah"></a><a href="#m4-xmlw-oddelene-zpravy" title="⚓">A.15</a><code>⟦⟧</code> XML: oddělené zprávy<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Příklad seskupuje zprávy podle jejich typu pomocí výstupních front.</p>
<div id="m4-messages_messages-xml-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))

	divert($0_QU)dnl
	&lt;$0_NAME>
		&lt;item>
			&lt;name>⟦$1⟧&lt;/name>
			&lt;value>$2&lt;/value>
		&lt;/item>
divert($0_END)dnl
	&lt;/$0_NAME>
divert(-1)
⟧)

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert($0_QU)dnl
		&lt;item>
			&lt;name>⟦$1⟧&lt;/name>
			&lt;value>$2&lt;/value>
		&lt;/item>
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧,        defn(⟦ERROR⟧))
define(⟦WARNING⟧,      defn(⟦ERROR⟧))

divert(0)dnl
&lt;!-- DONTE() -->
&lt;?xml version="1.0" encoding="utf-8"?>
&lt;messages>
divert(LAST_QUEUE)dnl
&lt;/messages>
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/messages.xml.m4" title="messages/messages.xml.m4
date: 20201226 21:52:28
sha1sum: bea84ce
size: 618 B">messages.xml.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-xml-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-xml-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 79f498c
size: 674 B">queues.m4</a> <a href="../messages/messages.xml.m4" title="messages/messages.xml.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: bea84ce
size: 618 B">messages.xml.m4</a> <a href="../messages/markup.m4" title="messages/markup.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: 98612ec
size: 256 B">markup.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.xml" title="messages/messages.xml
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 038f4ab
size: 767 B">messages.xml</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-xml-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-xml" class="m4-src"><pre>&lt;!-- DO NOT EDIT! This file is generated automatically! -->
&lt;?xml version="1.0" encoding="utf-8"?>
&lt;messages>
	&lt;query>
		&lt;item>
			&lt;name>READABLE&lt;/name>
			&lt;value>Is badly written M4 code readable [N/y]?&lt;/value>
		&lt;/item>
	&lt;/query>
	&lt;error>
		&lt;item>
			&lt;name>COMPLEX&lt;/name>
			&lt;value>!"#$%&amp;amp;'()*+,-./:;&amp;lt;=&amp;gt;?@[\]^_`{|}~&lt;/value>
		&lt;/item>
		&lt;item>
			&lt;name>SUCCESS&lt;/name>
			&lt;value>Too complex M4 code failed successfully.&lt;/value>
		&lt;/item>
		&lt;item>
			&lt;name>NO_FAULT&lt;/name>
			&lt;value>It's not a language fault!&lt;/value>
		&lt;/item>
	&lt;/error>
	&lt;warning>
		&lt;item>
			&lt;name>ADDICTIVE&lt;/name>
			&lt;value>Programming in M4 is addictive!&lt;/value>
		&lt;/item>
		&lt;item>
			&lt;name>NO_ERRORS&lt;/name>
			&lt;value>No other errors were found.&lt;/value>
		&lt;/item>
	&lt;/warning>
&lt;/messages></pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.xml" title="messages/messages.xml
date: 20210103 13:28:44
sha1sum: 038f4ab
size: 767 B">messages.xml</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_messages-xml" title="⚓"></a></code></div>
<h3 id="m4-bash-echo-dretezecd" class="m4-ch"><a href="#m4-bash-echo-dretezecd-toc" title="Obsah"></a><a href="#m4-bash-echo-dretezecd" title="⚓">A.16</a><code>⟦⟧</code> Bash <code>$ echo &quot;řetězec&quot;</code><a href="#m4--toc" title="Nahoru"></a></h3>
<div id="m4-messages_doubleq-sh-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
echo "$2"
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧, defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
#!/bin/bash
#
⟦#⟧ DONTE()

divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/doubleq.sh.m4" title="messages/doubleq.sh.m4
date: 20201226 21:52:28
sha1sum: 8de61d2
size: 229 B">doubleq.sh.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_doubleq-sh-m4" title="⚓"></a></code></div>
<div id="m4-messages_doubleq-sh-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/doubleq.sh.m4" title="messages/doubleq.sh.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 8de61d2
size: 229 B">doubleq.sh.m4</a> <a href="../messages/doubleq.m4" title="messages/doubleq.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: c94b763
size: 252 B">doubleq.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/doubleq.sh" title="messages/doubleq.sh
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: 747c4db
size: 324 B">doubleq.sh</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_doubleq-sh-command" title="⚓"></a></code></div>
<div id="m4-messages_doubleq-sh" class="m4-src"><pre>#!/bin/bash
#
# DO NOT EDIT! This file is generated automatically!

echo ""\!"\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_\`{|}~"
echo "Is badly written M4 code readable [N/y]?"
echo "Too complex M4 code failed successfully."
echo "Programming in M4 is addictive"\!""
echo "It's not a language fault"\!""
echo "No other errors were found."</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/doubleq.sh" title="messages/doubleq.sh
date: 20201226 22:38:15
sha1sum: 747c4db
size: 324 B">doubleq.sh</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_doubleq-sh" title="⚓"></a></code></div>
<h3 id="m4-bash-echo-aretezeca" class="m4-ch"><a href="#m4-bash-echo-aretezeca-toc" title="Obsah"></a><a href="#m4-bash-echo-aretezeca" title="⚓">A.17</a><code>⟦⟧</code> Bash <code>$ echo 'řetězec'</code><a href="#m4--toc" title="Nahoru"></a></h3>
<div id="m4-messages_apost-sh-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
echo '$2'
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧, defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
#!/bin/bash
#
⟦#⟧ DONTE()

divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/apost.sh.m4" title="messages/apost.sh.m4
date: 20201226 21:52:28
sha1sum: 6c78a02
size: 229 B">apost.sh.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_apost-sh-m4" title="⚓"></a></code></div>
<div id="m4-messages_apost-sh-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../messages/apost.sh.m4" title="messages/apost.sh.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 6c78a02
size: 229 B">apost.sh.m4</a> <a href="../messages/apost.m4" title="messages/apost.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: e7eec73
size: 249 B">apost.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/apost.sh" title="messages/apost.sh
date: 20201225 10:46:17
git rev: 5964776
sha1sum: 854fc6e
size: 318 B">apost.sh</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_apost-sh-command" title="⚓"></a></code></div>
<div id="m4-messages_apost-sh" class="m4-src"><pre>#!/bin/bash
#
# DO NOT EDIT! This file is generated automatically!

echo '!"#$%&amp;'\''()*+,-./:;&lt;=>?@[\]^_`{|}~'
echo 'Is badly written M4 code readable [N/y]?'
echo 'Too complex M4 code failed successfully.'
echo 'Programming in M4 is addictive!'
echo 'It'\''s not a language fault!'
echo 'No other errors were found.'</pre><code><span class="m4-sha">5964776</span><a href="../messages/apost.sh" title="messages/apost.sh
date: 20201225 10:46:17
sha1sum: 854fc6e
size: 318 B">apost.sh</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-messages_apost-sh" title="⚓"></a></code></div>
<h2 id="m4-priklady-preprocesoru" class="m4-ch"><a href="#m4-priklady-preprocesoru-toc" title="Obsah"></a><a href="#m4-priklady-preprocesoru" title="⚓">B</a>Příklady preprocesoru<a href="#m4--toc" title="Nahoru"></a></h2>
<div title="pro informaci" class="rs-tip-major m4-info">Znaky {<code title="uvozovky" class="m4-xp">`'</code>, <code title="hranaté závorky" class="m4-xp">[]</code>, <code title="netisknutelné znaky" class="m4-xp">␂␆</code>, <code title="UTF-8 znaky" class="m4-xp">⟦⟧</code>} v&nbsp;názvu příkladu <a href="../generovani-kodu-v-m4-uvod/preview.html#m4-rizeni-expanze-neterminalu" title="Řízení expanze neterminálů">řídí expanzi neterminálů</a>.</div>
<p id="m4-ba-preprocesor-jazyka-c-a-m4-toc" class="m4-l2"><a href="#m4-ba-preprocesor-jazyka-c-a-m4"><b>B.1</b><code>`'</code> Preprocesor jazyka C&nbsp;a&nbsp;M4</a></p>
<p id="m4-ba-cssw-vlozeni-souboru-komen-toc" class="m4-l2"><a href="#m4-ba-cssw-vlozeni-souboru-komen"><b>B.2</b><code>`'</code> CSS: vložení souboru, komentář</a></p>
<p id="m4-bashw-netisknutelne-znaky-toc" class="m4-l2"><a href="#m4-bashw-netisknutelne-znaky"><b>B.3</b><b><code>␂␆</code></b> Bash: netisknutelné znaky</a></p>
<h3 id="m4-ba-preprocesor-jazyka-c-a-m4" class="m4-ch"><a href="#m4-ba-preprocesor-jazyka-c-a-m4-toc" title="Obsah"></a><a href="#m4-ba-preprocesor-jazyka-c-a-m4" title="⚓">B.1</a><code>`'</code> Preprocesor jazyka C&nbsp;a&nbsp;M4<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Direktivy <a href="https://cs.wikipedia.org/wiki/Preprocesor_jazyka_C" title="Preprocesor jazyka C">CPP</a> jsou pro M4 jednořádkový komentář, což brání nežádoucí expanzi stejně pojmenovaných maker.
Definujeme-li bezpečnější makro <code class="m4-hgl" data-51="5" data-52="12">SAF()</code>, stejně pojmenované makro <code class="m4-hgl" data-52="8,11">SAF ()</code> nebude přepsáno.
Jmenný prostor <abbr title="Preprocesor jazyka C">CPP</abbr> tak <b>může</b> být zcela oddělen od jmenného prostoru M4.
Problematický znak <code>`</code> je skryt do makra <code class="m4-hgl" data-52="24">LL()</code>.
Apostrof <code class="m4-hgl" data-52="A" data-53="A">'</code> ve zdrojovém kódu ničemu nevadí.
Apostrof uvnitř makra <code class="m4-hgl" data-51="4" data-52="B">ORD<s style="color:red"><span style="color:rgba(0,0,0,.75)">()</span></s></code> je skryt do makra <code class="m4-hgl" data-51="A">RR()</code>.
Všimněte si jmen funkcí <code class="m4-hgl" data-52="17,27" data-53="17,27">define ()</code> nebo <code class="m4-hgl" data-52="18,28" data-53="18,28">ifelse ()</code> a&nbsp;kde je expandován <code class="m4-hgl" data-52="C" data-53="C" data-51="C">SYMBOL</code>.</p>
<div id="m4-preproc_file-c-m4" class="m4-src"><pre># ORDinary and SAFe macros have different expansion:

# A → β
define(`ORD', `$0_M4 <span class="m4-a">RR()</span><span class="m4-c">SYMBOL</span>`'<span class="m4-a">RR()</span>')
define(`SAF', `ifelse(`$#', `0', ``$0'', `($1) * ($1)	/* $0_M4 <span class="m4-c">SYMBOL</span> */')')

divert(0)dnl</pre><code><span class="m4-sha">cf9fdc8</span><a href="../preproc/file.c.m4" title="preproc/file.c.m4
date: 20210110 15:33:50
sha1sum: 7e01510
size: 196 B">file.c.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_file-c-m4" title="⚓"></a></code></div>
<div id="m4-preproc_file-c" class="m4-src"><pre>/*
 * DONTE()
 */

#include &lt;stdio.h>	/* CPP <span class="m4-c">SYMBOL</span> */

#define <span class="m4-c">SYMBOL</span>		/* CPP <span class="m4-c">SYMBOL</span> */
#define SAF(x)		((x) * ((x) - 1))	/* CPP <span class="m4-c">SYMBOL</span> */
#define ORD(x)		CPP <span class="m4-c">SYMBOL</span> x

int a = SAF (1 + 1);	/* CPP */
int b = SAF(2 + 2);	/* M4 */
char chr = <span class="m4-a">'</span>x<span class="m4-a">'</span>;
char foo[] = "Let<span class="m4-a">'</span>s say: <span class="m4-a">'</span><span class="m4-c">SYMBOL</span><span class="m4-a">'</span>";
char bar[] = "<span class="m4-b">ORD</span> (args, are, ignored)";

static void define (char *s) { puts(s);}
static void ifelse (char *s) { puts(s);}

int main(void)
{

#ifdef <span class="m4-c">SYMBOL</span>			/* <span class="m4-c">SYMBOL</span> */
	puts("LL()<span class="m4-c">SYMBOL</span><span class="m4-a">'</span>");	/* note: `LL()<span class="m4-c">SYMBOL</span><span class="m4-a">'</span> */
#endif

	define (foo);		/* <span class="m4-c">SYMBOL</span> */
	ifelse (bar);		/* <span class="m4-c">SYMBOL</span>() */

	return 0;
}</pre><code><span class="m4-sha">cf9fdc8</span><a href="../preproc/file.c" title="preproc/file.c
date: 20210110 15:33:50
sha1sum: 1fe5bfc
size: 583 B">file.c</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_file-c" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-c-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0q.m4" title="gfiles/root0q.m4
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: eb74312
size: 1154 B">root0q.m4</a> <a href="../preproc/file.c.m4" title="preproc/file.c.m4
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: 7e01510
size: 196 B">file.c.m4</a> <a href="../preproc/file.c" title="preproc/file.c
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: 1fe5bfc
size: 583 B">file.c</a> > <a href="../preproc/preproc.file.c" title="preproc/preproc.file.c
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: 041f49a
size: 700 B">preproc.file.c</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_preproc-file-c-command" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-c" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

#include &lt;stdio.h>	/* CPP <span class="m4-c">SYMBOL</span> */

#define <span class="m4-c">SYMBOL</span>		/* CPP <span class="m4-c">SYMBOL</span> */
#define SAF(x)		((x) * ((x) - 1))	/* CPP <span class="m4-c">SYMBOL</span> */
#define ORD(x)		CPP <span class="m4-c">SYMBOL</span> x

int a = SAF (1 + 1);	/* CPP */
int b = (2 + 2) * (2 + 2)	/* SAF_M4 Hello, world! */;	/* M4 */
char chr = <span class="m4-a">'</span>x<span class="m4-a">'</span>;
char foo[] = "Let<span class="m4-a">'</span>s say: <span class="m4-a">'</span>Hello, world!<span class="m4-a">'</span>";
char bar[] = "ORD_M4 <span class="m4-a">'</span>Hello, world!<span class="m4-a">'</span> (args, are, ignored)";

static void define (char *s) { puts(s);}
static void ifelse (char *s) { puts(s);}

int main(void)
{

#ifdef <span class="m4-c">SYMBOL</span>			/* <span class="m4-c">SYMBOL</span> */
	puts("`Hello, world!<span class="m4-a">'</span>");	/* note: LL()<span class="m4-c">SYMBOL</span> */
#endif

	define (foo);		/* Hello, world! */
	ifelse (bar);		/* Hello, world! */

	return 0;
}</pre><code><span class="m4-sha">cf9fdc8</span><a href="../preproc/preproc.file.c" title="preproc/preproc.file.c
date: 20210110 15:33:50
sha1sum: 041f49a
size: 700 B">preproc.file.c</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_preproc-file-c" title="⚓"></a></code></div>
<h3 id="m4-ba-cssw-vlozeni-souboru-komen" class="m4-ch"><a href="#m4-ba-cssw-vlozeni-souboru-komen-toc" title="Obsah"></a><a href="#m4-ba-cssw-vlozeni-souboru-komen" title="⚓">B.2</a><code>`'</code> CSS: vložení souboru, komentář<a href="#m4--toc" title="Nahoru"></a></h3>
<p>CSS používá znak <code class="m4-hgl" data-55="A" data-57="A">#</code> pro kódy barev, což je také začátek jednořádkového M4 komentáře.
Klíčové slovo <code class="m4-hgl" data-56="A">changecom(/*,*/)</code> nastaví víceřádkový komentář <code class="m4-hgl" data-57="B" data-56="C">/* … */</code> a&nbsp;přepíše se na <abbr title="epsilon – prázdný symbol"><code>ε</code></abbr>.
Komentáře se vypínají stejným klíčovým slovem <code class="m4-hgl" data-56="B">changecom</code> bez parametrů.</p>
<div id="m4-preproc_foo-css" class="m4-src"><pre title="soubor vložený makro procesorem">.foo {
	border: WIDTH 2px 1px;
}</pre><code><span class="m4-sha">9e13656</span><a href="../preproc/foo.css" title="preproc/foo.css
date: 20200211 02:32:35
sha1sum: 70f2196
size: 33 B">foo.css</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_foo-css" title="⚓"></a></code></div>
<div id="m4-preproc_file-css-m4" class="m4-src"><pre># CSS preprocessor

define(`WIDTH', `3px')
define(`TOP', `<span class="m4-a">#</span>f00')
define(`SIDES', `<span class="m4-a">#</span>0f0')
define(`BOTTOM', `<span class="m4-a">#</span>00f')
define(`SITE', `www.root.cz')
define(`IMAGE', `m4tux.png')
define(`PATH', `https://SITE/IMAGE')

divert(0)dnl</pre><code><span class="m4-sha">9e13656</span><a href="../preproc/file.css.m4" title="preproc/file.css.m4
date: 20200211 02:32:35
sha1sum: df580d7
size: 224 B">file.css.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_file-css-m4" title="⚓"></a></code></div>
<div id="m4-preproc_file-css" class="m4-src"><pre>/* DONTE() */<span class="m4-a">changecom(/*,*/)</span>
<span class="m4-c">/* DONTE() */</span>

include(`foo.css')dnl

.bar {
	border-width: WIDTH;
	border-color: TOP SIDES BOTTOM;
	background-image: url('PATH');
}

<span class="m4-c">/* DONTE() */</span>
<span class="m4-b">changecom</span>/* DONTE() */<span class="m4-a">changecom(/*,*/)</span></pre><code><span class="m4-sha">3ed8f6a</span><a href="../preproc/file.css" title="preproc/file.css
date: 20200505 00:05:58
sha1sum: 380eb22
size: 218 B">file.css</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_file-css" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-css-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0q.m4" title="gfiles/root0q.m4
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: eb74312
size: 1154 B">root0q.m4</a> <a href="../preproc/file.css.m4" title="preproc/file.css.m4
date: 20200211 02:32:35
git rev: 9e13656
sha1sum: df580d7
size: 224 B">file.css.m4</a> <a href="../preproc/file.css" title="preproc/file.css
date: 20200505 00:05:58
git rev: 3ed8f6a
sha1sum: 380eb22
size: 218 B">file.css</a> > <a href="../preproc/preproc.file.css" title="preproc/preproc.file.css
date: 20200509 00:48:05
git rev: 41542d1
sha1sum: 65fa35b
size: 293 B">preproc.file.css</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_preproc-file-css-command" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-css" class="m4-src"><pre>/* DO NOT EDIT! This file is generated automatically! */
<span class="m4-b">/* DONTE() */</span>

.foo {
	border: 3px 2px 1px;
}

.bar {
	border-width: 3px;
	border-color: <span class="m4-a">#</span>f00 <span class="m4-a">#</span>0f0 <span class="m4-a">#</span>00f;
	background-image: url('https://www.root.cz/m4tux.png');
}

<span class="m4-b">/* DONTE() */</span>
/* DO NOT EDIT! This file is generated automatically! */</pre><code><span class="m4-sha">41542d1</span><a href="../preproc/preproc.file.css" title="preproc/preproc.file.css
date: 20200509 00:48:05
sha1sum: 65fa35b
size: 293 B">preproc.file.css</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_preproc-file-css" title="⚓"></a></code></div>
<h3 id="m4-bashw-netisknutelne-znaky" class="m4-ch"><a href="#m4-bashw-netisknutelne-znaky-toc" title="Obsah"></a><a href="#m4-bashw-netisknutelne-znaky" title="⚓">B.3</a><b><code>␂␆</code></b> Bash: netisknutelné znaky<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Bash používá oba znaky, <code>`</code> a <code>[</code>.
Nechceme-li je skrývat do makra <code>LL()</code>, můžeme použít pro <a href="#m4-rizeni-expanze-neterminalu" title="Řízení expanze neterminálů">řízení expanze neterminálů</a> <span title="zobrazené jako UTF-8 znaky" class="m4-hgl" data-58="A" data-59="A">netisknutelné znaky</span>, viz. příklad:</p>
<div id="m4-preproc_file-sh-m4" class="m4-src"><pre># vim:mps+=<span class="m4-a">␂</span>\:<span class="m4-a">␆</span>

# A → β
define(<span class="m4-a">␂</span>LEFT<span class="m4-a">␆</span>, <span class="m4-a">␂</span>$<span class="m4-a">␂</span>#<span class="m4-a">␆</span><span class="m4-a">␆</span>)
define(<span class="m4-a">␂</span>OP<span class="m4-a">␆</span>, <span class="m4-a">␂</span>-eq<span class="m4-a">␆</span>)
define(<span class="m4-a">␂</span>RIGHT<span class="m4-a">␆</span>, <span class="m4-a">␂</span>0<span class="m4-a">␆</span>)

divert(0)dnl</pre><code><span class="m4-sha">b53eafe</span><a href="../preproc/file.sh.m4" title="preproc/file.sh.m4
date: 20200106 16:21:10
sha1sum: f1c81b2
size: 106 B">file.sh.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_file-sh-m4" title="⚓"></a></code></div>
<div id="m4-preproc_file-sh" class="m4-src"><pre>#!/bin/bash
#
<span class="m4-a">␂</span>#<span class="m4-a">␆</span> DONTE()

HELLO=`echo 'SYMBOL'`

if [[ LEFT OP RIGHT ]]
then
	echo $HELLO
fi</pre><code><span class="m4-sha">b53eafe</span><a href="../preproc/file.sh" title="preproc/file.sh
date: 20200106 16:21:10
sha1sum: fe8d3e3
size: 94 B">file.sh</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_file-sh" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-sh-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0n.m4" title="gfiles/root0n.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: 8bb195a
size: 1168 B">root0n.m4</a> <a href="../preproc/file.sh.m4" title="preproc/file.sh.m4
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: f1c81b2
size: 106 B">file.sh.m4</a> <a href="../preproc/file.sh" title="preproc/file.sh
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: fe8d3e3
size: 94 B">file.sh</a> > <a href="../preproc/preproc.file.sh" title="preproc/preproc.file.sh
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: 504d5cd
size: 137 B">preproc.file.sh</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_preproc-file-sh-command" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-sh" class="m4-src"><pre>#!/bin/bash
#
# DO NOT EDIT! This file is generated automatically!

HELLO=`echo 'Hello, world!'`

if [[ $# -eq 0 ]]
then
	echo $HELLO
fi</pre><code><span class="m4-sha">b53eafe</span><a href="../preproc/preproc.file.sh" title="preproc/preproc.file.sh
date: 20200106 16:21:10
sha1sum: 504d5cd
size: 137 B">preproc.file.sh</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-preproc_preproc-file-sh" title="⚓"></a></code></div>
<h2 id="m4-m4w-priklady" class="m4-ch"><a href="#m4-m4w-priklady-toc" title="Obsah"></a><a href="#m4-m4w-priklady" title="⚓">C</a>M4: příklady<a href="#m4--toc" title="Nahoru"></a></h2>
<div title="pro informaci" class="rs-tip-major m4-info">Znaky {<code title="uvozovky" class="m4-xp">`'</code>, <code title="hranaté závorky" class="m4-xp">[]</code>, <code title="netisknutelné znaky" class="m4-xp">␂␆</code>, <code title="UTF-8 znaky" class="m4-xp">⟦⟧</code>} v&nbsp;názvu příkladu <a href="../generovani-kodu-v-m4-uvod/preview.html#m4-rizeni-expanze-neterminalu" title="Řízení expanze neterminálů">řídí expanzi neterminálů</a>.</div>
<p id="m4-lr-jsonw-leva-zavorka-l-toc" class="m4-l2"><a href="#m4-lr-jsonw-leva-zavorka-l"><b>C.1</b><code>[]</code> JSON: levá závorka <code>[</code></a></p>
<p id="m4-lr-bashw-pocitadla-toc" class="m4-l2"><a href="#m4-lr-bashw-pocitadla"><b>C.2</b><code>[]</code> Bash: počítadla</a></p>
<p id="m4-lr-hw-zavorky-lr-l-r-lhr-ldnl-toc" class="m4-l2"><a href="#m4-lr-hw-zavorky-lr-l-r-lhr-ldnl"><b>C.3</b><code>[]</code> .h: závorky <code>[]</code>, <code>[,]</code>, <code>[#]</code>, <code>[dnl]</code></a></p>
<p id="m4-lr-awkw-priklady-bezpecnejsic-toc" class="m4-l2"><a href="#m4-lr-awkw-priklady-bezpecnejsic"><b>C.4</b><code>[]</code> AWK: příklady bezpečnějších maker</a></p>
<h3 id="m4-lr-jsonw-leva-zavorka-l" class="m4-ch"><a href="#m4-lr-jsonw-leva-zavorka-l-toc" title="Obsah"></a><a href="#m4-lr-jsonw-leva-zavorka-l" title="⚓">C.1</a><code>[]</code> JSON: levá závorka <code>[</code><a href="#m4--toc" title="Nahoru"></a></h3>
<p>Uvnitř hranatých závorek <code>[… se neterminály neexpandují …]</code>.
Proto je levá hranatá závorka <code>[</code> nahrazena makrem <code class="m4-hgl" data-61="6" data-62="3">LL()</code> z&nbsp;kořenového souboru.</p>
<div id="m4-hello_world_json-m4" class="m4-src"><pre># JSON

divert(0)dnl
{"foo": {
	"_comment": "DONTE()",
	"bar": LL()
		{"baz": "SYMBOL"}
	]
}}</pre><code><span class="m4-sha">39013f2</span><a href="../hello_world/json.m4" title="hello_world/json.m4
date: 20210103 13:26:54
sha1sum: 7e2f54b
size: 94 B">json.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_json-m4" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-json-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0b.m4" title="gfiles/root0b.m4
date: 20210118 19:16:44
git rev: f77d0bc
sha1sum: 5350ae1
size: 1087 B">root0b.m4</a> <a href="../hello_world/json.m4" title="hello_world/json.m4
date: 20210103 13:26:54
git rev: 39013f2
sha1sum: 7e2f54b
size: 94 B">json.m4</a> > <a href="../hello_world/hello_world.json" title="hello_world/hello_world.json
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: 94f820a
size: 120 B">hello_world.json</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_hello_world-json-command" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-json" class="m4-src"><pre>{"foo": {
	"_comment": "DO NOT EDIT! This file is generated automatically!",
	"bar": [
		{"baz": "Hello, world!"}
	]
}}</pre><code><span class="m4-sha">b53eafe</span><a href="../hello_world/hello_world.json" title="hello_world/hello_world.json
date: 20200106 16:21:10
sha1sum: 94f820a
size: 120 B">hello_world.json</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_hello_world-json" title="⚓"></a></code></div>
<h3 id="m4-lr-bashw-pocitadla" class="m4-ch"><a href="#m4-lr-bashw-pocitadla-toc" title="Obsah"></a><a href="#m4-lr-bashw-pocitadla" title="⚓">C.2</a><code>[]</code> Bash: počítadla<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Počítadla <code class="m4-hgl" data-63="A">COUNT_UP</code> a&nbsp;<code class="m4-hgl" data-63="B">COUNT_DOWN</code> jsou definována v&nbsp;souboru <code>countu.m4</code>.
<span class="m4-hgl" data-63="C">Neterminály</span> <code class="m4-hgl" data-63="20" data-64="5">[… uvnitř závorek …]</code> nebudou expandovány, pouze se odeberou vnější závorky.
Nutno použít makro <code class="m4-hgl" data-63="30" data-64="15">LL()</code> z&nbsp;kořenového souboru.</p>
<div id="m4-hello_world_sh-m4" class="m4-src"><pre># A → β
define([<span class="m4-c">LEFT</span>], [$[#]])
define([<span class="m4-c">OP</span>], [-eq])
define([<span class="m4-c">RIGHT</span>], [0])

# define two counters
# A → β
define([__COUNTUP__], defn([<span class="m4-a">COUNT_UP</span>]))
define([__COUNTDN__], defn([<span class="m4-b">COUNT_DOWN</span>]))

# init counters
__COUNTUP__(10)
__COUNTDN__(10)

divert(0)dnl
#!/bin/bash
#
[#] DONTE()

if [ LEFT OP RIGHT ]
then
	echo '__COUNTUP__] SYMBOL LL()__COUNTDN__'
fi

if test LEFT OP RIGHT
then
	echo '__COUNTUP__] SYMBOL LL()__COUNTDN__'
fi

if LL()LL() LEFT OP RIGHT ]]
then
	echo '__COUNTUP__] SYMBOL LL()__COUNTDN__'
fi</pre><code><span class="m4-sha">39013f2</span><a href="../hello_world/sh.m4" title="hello_world/sh.m4
date: 20210103 13:26:54
sha1sum: f9b14e5
size: 511 B">sh.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_sh-m4" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-sh-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: f498f9d
size: 1320 B">root0u.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../hello_world/sh.m4" title="hello_world/sh.m4
date: 20210103 13:26:54
git rev: 39013f2
sha1sum: f9b14e5
size: 511 B">sh.m4</a> > <a href="../hello_world/hello_world.sh" title="hello_world/hello_world.sh
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: 6d2cc4c
size: 236 B">hello_world.sh</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_hello_world-sh-command" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-sh" class="m4-src"><pre>#!/bin/bash
#
# DO NOT EDIT! This file is generated automatically!

if  LEFT OP RIGHT 
then
	echo '10] Hello, world! [10'
fi

if test $# -eq 0
then
	echo '11] Hello, world! [9'
fi

if [[ $# -eq 0 ]]
then
	echo '12] Hello, world! [8'
fi</pre><code><span class="m4-sha">b53eafe</span><a href="../hello_world/hello_world.sh" title="hello_world/hello_world.sh
date: 20200106 16:21:10
sha1sum: 6d2cc4c
size: 236 B">hello_world.sh</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_hello_world-sh" title="⚓"></a></code></div>
<h3 id="m4-lr-hw-zavorky-lr-l-r-lhr-ldnl" class="m4-ch"><a href="#m4-lr-hw-zavorky-lr-l-r-lhr-ldnl-toc" title="Obsah"></a><a href="#m4-lr-hw-zavorky-lr-l-r-lhr-ldnl" title="⚓">C.3</a><code>[]</code> .h: závorky <code>[]</code>, <code>[,]</code>, <code>[#]</code>, <code>[dnl]</code><a href="#m4--toc" title="Nahoru"></a></h3>
<p>Prázdný pár <code class="m4-hgl" data-65="A">[]</code> (nebo prázdný symbol v&nbsp;závorkách <code class="m4-hgl" data-65="A">[ε]</code>) slouží jako oddělovač symbolů.
Závorky kolem znaku komentáře <code class="m4-hgl" data-65="B" data-66="B">[#]</code> vypnou jeho původní význam, stejně jako vypnou význam <i>silnějšího</i> M4 komentáře
<code class="m4-hgl" data-65="C" data-66="C">[dnl]</code>.
Vypnou také původní význam čárky <code>[,]</code> jako oddělovače argumentů maker.
Tyto symboly se stanou obyčejnými terminálními symboly bez jakéhokoliv vedlejšího efektu.</p>
<div id="m4-hello_world_h-m4" class="m4-src"><pre># A → β
define([HELLO], [HELLO_WORLD])

divert(0)dnl
/*
 * <span class="m4-c">[dnl]</span> DONTE()
 */

<span class="m4-b">[#]</span>ifndef __<span class="m4-a">[]</span>HELLO<span class="m4-a">[]</span>_H
<span class="m4-b">[#]</span>define __<span class="m4-a">[]</span>HELLO<span class="m4-a">[]</span>_H

<span class="m4-b">[#]</span>define HELLO	SYMBOL

<span class="m4-b">[#]</span>endif /* __<span class="m4-a">[]</span>HELLO<span class="m4-a">[]</span>_H */</pre><code><span class="m4-sha">ce5cd99</span><a href="../hello_world/h.m4" title="hello_world/h.m4
date: 20200213 14:50:23
sha1sum: 267465d
size: 183 B">h.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_h-m4" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-h-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0b.m4" title="gfiles/root0b.m4
date: 20210118 19:16:44
git rev: f77d0bc
sha1sum: 5350ae1
size: 1087 B">root0b.m4</a> <a href="../hello_world/h.m4" title="hello_world/h.m4
date: 20200213 14:50:23
git rev: ce5cd99
sha1sum: 267465d
size: 183 B">h.m4</a> > <a href="../hello_world/hello_world.h" title="hello_world/hello_world.h
date: 20200213 14:51:13
git rev: 6b10c6c
sha1sum: 306af96
size: 179 B">hello_world.h</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_hello_world-h-command" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-h" class="m4-src"><pre>/*
 * <span class="m4-c">dnl</span> DO NOT EDIT! This file is generated automatically!
 */

<span class="m4-b">#</span>ifndef __HELLO_WORLD_H
<span class="m4-b">#</span>define __HELLO_WORLD_H

<span class="m4-b">#</span>define HELLO_WORLD	Hello, world!

<span class="m4-b">#</span>endif /* __HELLO_WORLD_H */</pre><code><span class="m4-sha">6b10c6c</span><a href="../hello_world/hello_world.h" title="hello_world/hello_world.h
date: 20200213 14:51:13
sha1sum: 306af96
size: 179 B">hello_world.h</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_hello_world-h" title="⚓"></a></code></div>
<h3 id="m4-lr-awkw-priklady-bezpecnejsic" class="m4-ch"><a href="#m4-lr-awkw-priklady-bezpecnejsic-toc" title="Obsah"></a><a href="#m4-lr-awkw-priklady-bezpecnejsic" title="⚓">C.4</a><code>[]</code> AWK: příklady bezpečnějších maker<a href="#m4--toc" title="Nahoru"></a></h3>
<p>Univerzální výstraha <code class="m4-hgl" data-67="A" data-68="A">DONTE</code> se ignoruje bez závorek, stejně jako <code class="m4-hgl" data-67="B" data-68="B">LL</code>, <code>RR</code>, …
Taková makra explicitně vytváří vývojář skriptů, prohlédněte si kořenový soubor <code>root1b.m4</code>.</p>
<div id="m4-hello_world_awk-m4" class="m4-src"><pre># AWK

divert(0)dnl
#!/bin/awk -f
#
[# DONTE()] ---> "DONTE()"

BEGIN { print "<span class="m4-a">DONTE</span>[]() <span class="m4-b">LL</span> () LL() SYMBOL ]" }</pre><code><span class="m4-sha">39013f2</span><a href="../hello_world/awk.m4" title="hello_world/awk.m4
date: 20210103 13:26:54
sha1sum: 83243af
size: 112 B">awk.m4</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_awk-m4" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-awk-command" class="m4-cmd m4-usc"><pre title="příkaz">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root1b.m4" title="gfiles/root1b.m4
date: 20210118 23:26:59
git rev: 44c7674
sha1sum: 10e4b61
size: 1603 B">root1b.m4</a> <a href="../hello_world/awk.m4" title="hello_world/awk.m4
date: 20210103 13:26:54
git rev: 39013f2
sha1sum: 83243af
size: 112 B">awk.m4</a> > <a href="../hello_world/hello_world.awk" title="hello_world/hello_world.awk
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: a92eb9d
size: 135 B">hello_world.awk</a></pre><code><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_hello_world-awk-command" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-awk" class="m4-src"><pre>#!/bin/awk -f
#
# DONTE() ---> "DO NOT EDIT! This file is generated automatically!"

BEGIN { print "<span class="m4-a">DONTE</span>() <span class="m4-b">LL</span> () [ Hello, world! ]" }</pre><code><span class="m4-sha">02f55b8</span><a href="../hello_world/hello_world.awk" title="hello_world/hello_world.awk
date: 20210118 19:23:51
sha1sum: a92eb9d
size: 135 B">hello_world.awk</a><span class="m4-cb" title="vybrat text"></span><a href="#m4-hello_world_hello_world-awk" title="⚓"></a></code></div>
<h2 id="m4-proc-pouzivat-m4-a-proc-neq" class="m4-ch"><a href="#m4-proc-pouzivat-m4-a-proc-neq-toc" title="Obsah"></a><a href="#m4-proc-pouzivat-m4-a-proc-neq" title="⚓">D</a>Proč používat M4 a&nbsp;proč ne?<a href="#m4--toc" title="Nahoru"></a></h2>
<p id="m4-proc-generovat-kod-v-m4-toc" class="m4-l2"><a href="#m4-proc-generovat-kod-v-m4"><b>D.1</b><code>👍</code> Proč generovat kód v&nbsp;M4</a></p>
<p id="m4-proc-se-vyhnout-m4-toc" class="m4-l2"><a href="#m4-proc-se-vyhnout-m4"><b>D.2</b><code>👎</code> Proč se vyhnout M4</a></p>
<h3 id="m4-proc-generovat-kod-v-m4" class="m4-ch"><a href="#m4-proc-generovat-kod-v-m4-toc" title="Obsah"></a><a href="#m4-proc-generovat-kod-v-m4" title="⚓">D.1</a><code>👍</code> Proč generovat kód v&nbsp;M4<a href="#m4--toc" title="Nahoru"></a></h3>
<ul>
<li id="m4-direct-use-of-cfg">přímé použití <a href="#m4-bezkontextova-gramatika" title="Bezkontextová gramatika">bezkontextové gramatiky</a> (rekurze zdarma)
<ul><li>pro transformaci dat stačí napsat minimum M4 kódu</li></ul></li>
<li id="m4-direct-use-of-atm">přímé použití automatů
<ul><li>možnost vymodelovat si potřebné algoritmy (M4 nepotřebuje verze)</li></ul></li>
<li id="m4-direct-use-of-stacks">přímé použití zásobníků
<ul><li>zásobníky propojené s&nbsp;automaty rozšiřují možnosti generátoru kódu</li></ul></li>
<li id="m4-direct-use-of-queues">přímé použití výstupních front pro dočasné uložení výsledných částí kódu
<ul><li>jednotlivé fronty jsou na závěr vypsány na výstup ve vzestupném pořadí</li></ul></li>
<li id="m4-significantly-faster-code-gener">výrazně vyšší rychlost generování kódu (ve srovnání s&nbsp;XSLT)
<ul><li>nízké nároky na výpočetní zdroje</li></ul></li>
</ul>
<h3 id="m4-proc-se-vyhnout-m4" class="m4-ch"><a href="#m4-proc-se-vyhnout-m4-toc" title="Obsah"></a><a href="#m4-proc-se-vyhnout-m4" title="⚓">D.2</a><code>👎</code> Proč se vyhnout M4<a href="#m4--toc" title="Nahoru"></a></h3>
<ul>
<li id="m4-low-level-language">univerzální jazyk nízké úrovně (podobně jako jazyk C)
<ul><li>což výměnou poskytuje ohromnou flexibilitu jako UNIX</li></ul></li>
<li id="m4-nearly-forgotten-language">téměř neexistující komunita vývojářů (podzim 2019)
<ul><li>M4 je zapomenutý jazyk, málo existujících projektů</li></ul></li>
<li id="m4-unusual-language">neobvyklé programovací paradigma vyžadující splnění <a href="#m4-predpoklady-pro-zvladnuti-m4" title="Předpoklady pro zvládnutí M4">několika předpokladů</a>
<ul><li><b>právě proto</b> lze M4 považovat za náročný jazyk</li></ul></li>
<li id="m4-experience-dependent">produktivita značně závisí na zkušenostech (možný problém s&nbsp;termíny)
<ul><li>psaní M4 skriptů vyžaduje <b>základní</b> znalost automatů a gramatik</li></ul></li>
<li id="m4-maintenance-could-be-hard">údržba špatně napsaného M4 kódu není jednoduchá
<ul><li>existující M4 kód je snadné proměnit ve zmatek (nutný dohled!)</li></ul></li>
</ul>
<script>var m4root={init:function(b,c,a,v,G,f,h){var d,e,g,k,l,m,o,p=[],q=[],i,s,t,u,x,y,z,B,C,D,E;for(D of a)D.lastChild.firstChild.onclick=this.b;for(D of c){y=D.y=D.firstElementChild,t=y.innerHTML.split('\n').length,C=y.nextElementSibling;E=document.createElement("pre");E.className=G;if(C&&C.tagName=="CODE"){if(C.childNodes.length==2){C.firstChild.onclick=this.b}else{C.firstChild.onclick=this.a;C.childNodes[2].onclick=this.b}}for(i=0;i<t;i++){e=document.createElement("div");if(i&1)e.className=f;E.appendChild(e)}D.insertBefore(E,y)}for(l of b){B=Object.keys(l.dataset);for(i of B){D=c[i];if(!D.n)D.n=[];D.n.push({w:l,H:l.dataset[i]})}l.onmouseover=function(){var k;if(this.o)for(k of this.o)k.w.classList.add(k.H);if(this.q)for(k of this.q)k.w.classList.add(...k.H)};l.onmouseout=function(){var k;if(this.o)for(k of this.o)k.w.classList.remove(k.H);if(this.q)for(k of this.q)k.w.classList.remove(...k.H)}}for(D of c){if(!D.n)continue;g=1;if(D.style.counterReset)g+=parseInt(D.style.counterReset.split(' ')[1]);E=D.firstElementChild;for(k of D.n){k.H=k.H.replace(/[A-Z]+|[_a-z]\w*|\d+-\d+/g,'"$&"').replace(/^:/,'"":');k.H=/:/.test(k.H)?"{"+k.H+"}":'{"":['+k.H+']}';x=JSON.parse(k.H,function(r,H){if(/^[A-Z]+$/.test(H)){q.push(v+H);return undefined}if(/^\d+-\d+$/.test(H)){m=H.split('-');s=parseInt(m[1]);for(i=m[0];i<=s;i++){H=i-g;if(H>=0)p.push(H)}return undefined}if(Number.isInteger(H)){H-=g;return H>=0?H:undefined}if(Array.isArray(H)){H=H.filter(function(){return true}).concat(p);p=[];return H.length?H:undefined}if(typeof H==='object')return H;return undefined});if(q.length){if(!k.w.q)k.w.q=[];k.w.q.push({w:D.y,H:q});q=[]}o=Object.keys(x);if(o.length){if(!k.w.o)k.w.o=[];for(d of o){u=x[d];z=d?v+d:h;for(i of u)k.w.o.push({w:E.children[i],H:z})}}}}},a:function(){var a=this.parentNode,b,c,d,e;if(this.b){if(this.b.isConnected)a.removeChild(this.b);else a.appendChild(this.b);return}b=document.createElement("div");e=this.nextSibling.title.split('\n');for(d of e){c=document.createElement("div");c.appendChild(document.createTextNode(d));b.appendChild(c)}a.appendChild(this.b=b)},b:function(){var a=this.parentNode.previousSibling,b,c;if(window.getSelection){b=window.getSelection();c=document.createRange();c.selectNodeContents(a);b.removeAllRanges();b.addRange(c)}else{c=document.body.createTextRange();c.moveToElementText(a);c.select()}}}</script>
<script>m4root.init(document.getElementsByClassName("m4-hgl"),document.getElementsByClassName("m4-src"),document.getElementsByClassName("m4-cmd"),"m4-","m4-re","m4-ev","m4-dh")</script>
</div>
</div>
</div>
<div class="element-margin-top  section ">
<div class="section__header">
<h2 class="section__heading">Autor článku</h2>
</div>
<div class="design-box__content">
<div class="author">
<div class="author__pic avatar-round">
<a class="avatar__wrap" href="#" title="Profil autora">
<img class="avatar__img" src="../img/pepa.png" width="70" height="70" alt="Josef Kubín">
</a>
</div>
<div class="author__info">
<div class="author__details">
<h3 class="author__name">
<a href="https://www.root.cz/autori/">Josef Kubín</a>
</h3>
</div>
<div class="author__bio urs">
<p><span class="rs-person">Josef Kubín</span> vystudoval Fakultu&nbsp;informatiky Masarykovy univerzity v Brně</p>
</div>
</div>
</div>
</div>
<div class="design-impressum__item-wrapper--rubrics design-impressum__item-wrapper">
<h3 class="element-heading-reset">
<a class="design-label--empty design-label" href="https://www.root.cz/n/">Nálepky:</a>
</h3>
<ul class="design-list--labels design-list--inline design-list list-reset">
<li>
<a class="design-label--default design-label" href="https://www.root.cz/n/unix/">UNIX</a>
</li>
<li>
<a class="design-label--default design-label" href="https://www.root.cz/n/vim/">Vim</a>
</li>
</ul>
</div>
</div>
</div> 
</div> 
</div> 
</div>
</div>
</body>
</html>
