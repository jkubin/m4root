<!-- DO NOT EDIT! This file is generated automatically! -->
<!doctype html>
<html id="css" lang="en">
<head>
<meta charset="utf-8">
<title>Generating code in M4: introduction</title>
<link rel="stylesheet" type="text/css" href="../html/root_cz.css">
<style>.m4-ev{background:#f5f5f5}.urs p[id$="-toc"]>a>b{font-weight:normal;margin-right:.6em}.urs a[id^="m4-ref"]{font-size:.65em;vertical-align:super}.m4-A .m4-a,.m4-B .m4-b,.m4-C .m4-c,.m4-D .m4-d,.m4-E .m4-e,.m4-F .m4-f,.m4-G .m4-g,.m4-dh{background:lawngreen}.m4-R .m4-r{background:gold}.m4-S .m4-s{font-weight:bold}.m4-X .m4-x{visibility:hidden}.urs q{font-style:initial}.urs q::before{content:"\201c"}.urs q::after{content:"\201d"}#m4--toc{position:relative}#m4--toc>div{position:absolute;right:0;top:0}#m4--toc>div>div{display:inline-block}.m4-dwnl a{margin-left:.4em}.m4-updt{color:#666;text-align:right;margin-left:.6em}.m4-ch,.m4-bh,.m4-cmd{position:relative}.m4-bh>a:first-child::before,.m4-ch>a:first-child::before{font-size:.9em;font-weight:normal;position:absolute;right:100%;width:1.3em}.m4-ch>a:first-child::before{content:"\2630"}.m4-ch>a:first-child+a{margin-right:.4em}.m4-ch>a:last-child::before,.m4-bh>a:last-child::before{content:"\1f845";font-size:.65em;margin-left:.3em;position:absolute}.m4-ch>a:first-child,.m4-ch>a:last-child,.m4-bh>a:first-child,.m4-bh>a:last-child{opacity:0}.m4-ch:hover>a:first-child,.m4-ch:hover>a:last-child,.m4-bh:hover>a:first-child,.m4-bh:hover>a:last-child{opacity:1}.m4-xp{border-bottom:1px dotted #000;cursor:help}.m4-xp:active::after{content:" (" attr(title) ")"}.m4-note::before{content:"\1f5b9";margin-right:.2em;font-size:1.5em}.urs .m4-note,.urs .m4-info,.urs .m4-excl,.urs .m4-warn{padding-top:.2em;padding-bottom:.4em}.m4-note ul{margin-bottom:0;margin-left:1em}ol.m4-refs a:first-child::before{content:"\2191"}ol.m4-refs a:first-child{margin-right:.3em;text-decoration:none}.m4-l2{padding-left:1em}.m4-bh>a:first-child::before{content:"\1f517"}.m4-info::before{content:"\1f6c8";margin-right:.2em;font-size:1.5em}.m4-src{counter-reset:m4-nl}.m4-src>code>.m4-cb+a::before,.m4-cmd>code>.m4-cb+a::before{content:"\1f517"}.m4-src>code>.m4-cb+a,.m4-cmd>code>.m4-cb+a{font-weight:normal}.m4-src>code,.m4-cmd>code{border-radius:0 4px;border:1px solid #ddd;font-size:.7em;font-weight:bold;padding:2px 4px;position:absolute;right:0;text-align:right;top:0}.m4-src>code a,.m4-cmd>code a{margin-left:.6em}.m4-src>code>div{background:#eee;font-weight:initial;padding:0 2px;text-align:left}.m4-src>code>.m4-sha+a{background:#eee;color:inherit;margin:0 .6em}.m4-src>pre.m4-re{left:0;overflow:visible;padding-left:0;padding-right:0;position:absolute;top:0}.m4-src>pre+pre{background:none}.m4-src,.m4-src>pre,.m4-src>pre.m4-re>div{position:relative}.m4-src>pre.m4-re>div::before{content:counter(m4-nl);counter-increment:m4-nl;left:-3em;position:absolute;text-align:right;top:0;width:2.5em}.m4-src>pre.m4-re>div::after{content:" "}.m4-cb{cursor:pointer}.m4-cb::before{content:"\1f4cb"}.m4-hgl{border-bottom:1px dashed #000;cursor:help}.m4-cmd>pre{font-weight:bold;padding-right:0;white-space:normal;word-break:normal}.m4-cmd>code{visibility:hidden}.m4-cmd:hover>code{visibility:visible}.m4-cmd>pre a{color:inherit}.m4-root>pre::before{content:"# ";font-weight:normal}.m4-usc>pre::before{content:"$ ";font-weight:normal}.m4-sha{background:#eee;cursor:pointer;text-decoration:#f04c23 underline dashed}.m4-l3{padding-left:2em}</style>
</head>
<body id="root" class="js-advert-branding-click-event js-advert-sas-position-mark-background p-text design-page--theme-default design-page--root-cz design-page design-body design-page--has-advert--article-intext-1 design-page--has-advert--as-clanky-300x250 design-page--has-advert--mobile-footer design-page--has-advert--mobile-vignette design-page--has-advert--sidebar-sticky-1 design-page--has-advert--leaderboard design-page--has-advert--rectangle design-page--has-advert--sidebar-sticky-2 design-page--has-advert--megaboard">
<div class="parter-cpex-branding-wrapper design-advert-background-outer-element design-page__content" data-partner-cpex-branding-wrapper-z-index="0">
<div class=" js-sticker-init layout-main--has-sidebar--default layout-main--has-sidebar  layout-main main">
<div class="js-sticker-compare-wrapper layout-columns layout-main__content">
<div class="layout-columns__item--main layout-columns__item">
<div class="design-tile--version-1 design-tile">
<h1 class="detail__heading design-heading--level-1 design-heading">Generating code in M4: introduction</h1>
<div class="design-list--articles--article-detail  design-list--articles--opener design-list--articles design-list list-reset">
<div class="design-list__item">
<div class="design-article--opener--simple design-article--opener design-article--with-image design-article design-tile">
<span class=" element-print-hidden  design-article__image-outer">
<img class="design-image--responsive design-image design-article__image" src="../img/m4tux.png" width="670" height="377" alt=" ">
<span class="design-article__image-author">Author: jkubin</span>
</span>
<div class="design-article__text">
<div class="design-article__perex">
<div class="design-article__perex-content">The M4 macro processor is used to generate arbitrarily complex code from simple source code. The introductory part of the series contains its history, the basic principles of language, examples of usage and prerequisites for its mastery.</div>
</div>
</div>
</div>
</div>
</div>
<div class="detail__article ">
<div class=" layout-article-content">
<div class="element-margin-top-half php-urs urs">
<div id="m4--toc"><h2>Content (<a href="../generovani-kodu-v-m4-uvod/preview.html#m4--toc" title="Generování kódu v M4: úvod">Česky</a>)</h2><div><div class="m4-dwnl"><a href="../intro.mc" style="font-weight:bold" title="article source code">mc</a><a href="../generating-code-in-m4-introduction/spell.txt" title="generated text for spell checking and jargon (designed for Vim)">spl</a><a href="../generating-code-in-m4-introduction.txt" title="generated text for estimating the number of characters">txt</a><br><a href="../generating-code-in-m4-introduction/index.html" title="generated html page for off-line development">dev</a><a href="../generating-code-in-m4-introduction/preview.html" title="generated html page for off-line preview">pre</a><a href="../generating-code-in-m4-introduction.c" title="generated source code C">c</a></div><div class="m4-updt">updated<br>January 24, 2021</div></div></div>
<noscript><div title="for information" class="rs-tip-major m4-info">Enabling JavaScript enhances the clarity of the source code samples.</div></noscript>
<p id="m4-introduction-toc"><a href="#m4-introduction"><b>1</b>Introduction</a></p>
<p id="m4-examples-for-readers-toc" class="m4-l2"><a href="#m4-examples-for-readers"><b>1.1</b>Examples for readers</a></p>
<p id="m4-history-of-macro-languages-toc"><a href="#m4-history-of-macro-languages"><b>2</b>History of macro languages</a></p>
<p id="m4-basics-of-m4-toc"><a href="#m4-basics-of-m4"><b>3</b>Basics of M4</a></p>
<p id="m4-context-free-grammar-toc" class="m4-l2"><a href="#m4-context-free-grammar"><b>3.1</b>Context-free grammar</a></p>
<p id="m4-automata-toc" class="m4-l2"><a href="#m4-automata"><b>3.2</b>Automata</a></p>
<p id="m4-output-queues-toc" class="m4-l2"><a href="#m4-output-queues"><b>3.3</b>Output queues</a></p>
<p id="m4-main-uses-of-m4-toc"><a href="#m4-main-uses-of-m4"><b>4</b>Main uses of M4</a></p>
<p id="m4-the-code-generation-toc" class="m4-l2"><a href="#m4-the-code-generation"><b>4.1</b>The code generation</a></p>
<p id="m4-the-preprocessor-toc" class="m4-l2"><a href="#m4-the-preprocessor"><b>4.2</b>The preprocessor</a></p>
<p id="m4-prerequisites-for-mastering-m-toc"><a href="#m4-prerequisites-for-mastering-m"><b>5</b>Prerequisites for mastering M4</a></p>
<p id="m4-fundamentals-of-grammars-toc" class="m4-l2"><a href="#m4-fundamentals-of-grammars"><b>5.1</b>Fundamentals of grammars</a></p>
<p id="m4-fundamentals-of-automata-toc" class="m4-l2"><a href="#m4-fundamentals-of-automata"><b>5.2</b>Fundamentals of automata</a></p>
<p id="m4-gnu-make-toc" class="m4-l2"><a href="#m4-gnu-make"><b>5.3</b>(GNU) make</a></p>
<p id="m4-vim-toc" class="m4-l2"><a href="#m4-vim"><b>5.4</b>Vim</a></p>
<p id="m4-talent-and-time-toc" class="m4-l2"><a href="#m4-talent-and-time"><b>5.5</b>Talent and time</a></p>
<p id="m4-links-toc"><a href="#m4-links"><b>6</b>References</a></p>
<hr>
<p id="m4-code-generation-examples-toc"><a href="#m4-code-generation-examples" title="Appendix"><b>A</b>Code generation examples</a></p>
<p id="m4-preprocessor-examples-toc"><a href="#m4-preprocessor-examples" title="Appendix"><b>B</b>Preprocessor examples</a></p>
<p id="m4-m4w-examples-toc"><a href="#m4-m4w-examples" title="Appendix"><b>C</b>M4: examples</a></p>
<p id="m4-why-to-use-m4-and-why-notq-toc"><a href="#m4-why-to-use-m4-and-why-notq" title="Appendix"><b>D</b>Why to use M4 and why not?</a></p>
<!-- article content -->
<h2 id="m4-introduction" class="m4-ch"><a href="#m4-introduction-toc" title="Content"></a><a href="#m4-introduction" title="⚓">1</a>Introduction<a href="#m4--toc" title="Top"></a></h2>
<p>Readers of this series will learn how to write scripts for machine code generation.
The machine-generated code can be arbitrarily complex and can contain other internal dependencies.
Interdependent files with complex code are hardly sustainable for humans in a&nbsp;consistent state.
It is necessary to use some code generation mechanism.
The code generation is performed by a&nbsp;tool for text transformation – <b>a&nbsp;macro processor</b>.</p>
<p id="m4-what-is-the-series-about">The series focus on the practical use of the <b>universal macro processor M4</b> (hereafter M4) using small examples.
It also describes the theoretical part of all its implementations.
The aim of the series is to acquaint the reader with this <span title="m4 – is a command line program" class="m4-xp">tool</span> and also the programming <span title="M4 – is a programming language" class="m4-xp">language</span>.
<a href="#m4-main-uses-of-m4" title="Main uses of M4">What is it used for</a>, how to program in it and its <a href="#m4-why-to-generate-code-in-m4" title="👍 Why to generate code in M4">advantages</a> and <a href="#m4-why-to-avoid-m4" title="👎 Why to avoid M4">disadvantages</a>.</p>
<div title="note" class="rs-tip-major m4-note">Multilingual series <q><b>Generating code in M4</b></q> are generated by M4 scripts<a href="http://github.com/jkubin/m4root" title="Generating code in M4" id="m4-ref1">[1]</a>,
which will make it easier (maybe) for other authors to write articles on <a href="https://www.root.cz/" title="Root.cz – information not only from the Linux world">www.root.cz</a>.
The result of the series is also a set of sample scripts for generating code.</div>
<p>The introductory part describes the basic principles of the language with simple examples of use.
All examples use rewriting rules of <a href="#m4-context-free-grammar" title="Context-free grammar">context-free grammar</a>.
Later we will learn how to use <a href="#m4-output-queues" title="Output queues">output queues</a>,
<a href="#m4-automata" title="Automata">automata</a>, associative memories, stacks and pushdown automata.
We will also learn how to write <a href="#m4-testing-automaton" title="Testing automaton">testing automata</a> to test input data.</p>
<h3 id="m4-examples-for-readers" class="m4-ch"><a href="#m4-examples-for-readers-toc" title="Content"></a><a href="#m4-examples-for-readers" title="⚓">1.1</a>Examples for readers<a href="#m4--toc" title="Top"></a></h3>
<p>The examples are a&nbsp;complementary part of the series and will be based to some extent on the discussion below the article.
At the beginning of each episode, some parts of the M4 language will be described and supplemented with a&nbsp;set of examples at the end.
Each part can be read in any order.</p>
<ul>
<li><a href="#m4-code-generation-examples" title="Code generation examples">Code generation examples</a></li>
<li><a href="#m4-preprocessor-examples" title="Preprocessor examples">Preprocessor examples</a></li>
<li><a href="#m4-m4w-examples" title="M4: examples">M4: examples</a></li>
<li><a href="#m4-why-to-use-m4-and-why-notq" title="Why to use M4 and why not?">Why to use M4 and why not?</a></li>
<li><a href="http://github.com/jkubin/m4root" title="Generating code in M4">http://github.com/jkubin/m4root</a> – project generating this series</li>
</ul>
<h2 id="m4-history-of-macro-languages" class="m4-ch"><a href="#m4-history-of-macro-languages-toc" title="Content"></a><a href="#m4-history-of-macro-languages" title="⚓">2</a>History of macro languages<a href="#m4--toc" title="Top"></a></h2>
<p>Macro languages were invented when the assembly language (ASM) dominated.
ASM source code usually contains identical instruction sequences that differ only in operand values.
Identical instruction sequences can be grouped into one word or a&nbsp;<b>macro instruction</b>.
The name usually describes the purpose of the hidden sequence of instructions.
These macro instructions are translated by the macro processor to the original instruction sequences, which are then translated into the executable machine code.
Programming in ASM using macro instructions is simpler, faster and less prone to human errors.</p>
<p>Later, macro languages were used to extend compiled programming languages because they made it possible to write a source code at the higher level of abstraction than offered by the programming language itself.
The speed, performance and efficiency of a&nbsp;complex lower-level programming language is maintained through macro languages.
However, it is important to understand all layers of code well.</p>
<h3 id="m4-gpm-general-purpose-macro-gen" class="m4-bh"><a href="#m4-gpm-general-purpose-macro-gen" title="⚓"></a>GPM (General Purpose Macro-generator)<a href="#m4--toc" title="Top"></a></h3>
<p><a href="https://en.wikipedia.org/wiki/Christopher_Strachey" title="Wikipedia"><span class="rs-person">Christopher Strachey</span></a> introduced the basic idea of rewritable strings with arguments which recursively rewrite to other strings in his
<abbr title="General Purpose Macro-generator">GPM</abbr><a href="http://dx.doi.org/10.1093/comjnl/8.3.225" title="A&nbsp;General Purpose Macro-generator" id="m4-ref2">[2]</a> in 1965.
The next generation of M3 and M4 macro processors basically just expanded the original <abbr title="General Purpose Macro-generator">GPM</abbr>.
The basic idea of the original proposal remained the same.</p>
<h3 id="m4-m3" class="m4-bh"><a href="#m4-m3" title="⚓"></a>M3<a href="#m4--toc" title="Top"></a></h3>
<p><a href="https://en.wikipedia.org/wiki/Dennis_Ritchie" title="Wikipedia"><span class="rs-person">Dennis Ritchie</span></a> took over the basic idea of <abbr title="General Purpose Macro-generator">GPM</abbr> and wrote an improved macro processor for generating source code of C&nbsp;(1972) language, which he himself designed.
The new <b>m</b>acro processor was written for the minicomputer AP-<b>3</b>, hence the name <b>M3</b>.
This direct ancestor of the current M4 managed to significantly save heavy and time-consuming work and attract developers programming to other languages (<abbr title="FORmula TRANslation">FORTRAN</abbr>, <abbr title="COmmon Business-Oriented Language">COBOL</abbr>, <abbr title="Programming Language One">PL/I</abbr>, …).
Developers have customized M3 for these languages turning it into a&nbsp;universally usable M4 macro processor.</p>
<div title="m4 ∈ {set of UNIX tools}" class="rs-tip-major m4-note"><span class="rs-person">Dennis Ritchie</span> was also a&nbsp;co-creator of UNIX and therefore:<ul>
<li>M4 is minimalist and fast, <a href="https://en.wikipedia.org/wiki/Unix_philosophy" title="UNIX philosophy
Wikipedia">it does one thing and it does well</a></li>
<li>it relies solely on the non-interactive command line interface</li>
<li>parameters and dependencies of M4 scripts are described by <code>Makefile</code></li>
<li>the <code>#</code> character begins with a&nbsp;one-line comment like in a&nbsp;UNIX shell</li>
<li>variables <code>$@</code>, <code>$*</code>, <code>$#</code>, <code>$0</code>, <code>$1</code>, <code>$2</code>, <code>$3</code>, … have similar meanings as in a&nbsp;UNIX shell</li>
<li>the argument delimiter is comma</li>
</ul>
</div>
<p>The M3 macro processor was also extended by <span class="rs-person">Jim E. Weythman</span>, the author of program construction, which is used in almost every M4 script:</p>
<div id="m4-common-code" class="m4-src"><pre>divert(-1)
…
define(…)
…
divert(0)dnl
…</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-common-code" title="⚓"></a></code></div>
<div title="note" class="rs-tip-major m4-note">The <code title="divert(-1), divert(0), divert(1), …, divert(2147483647)" class="m4-hgl" data-0="1,5">divert(<a href="https://en.wikipedia.org/wiki/Integer" title="integer">ℤ</a>)</code> keyword switches output queues.
Argument <code>-1</code> completely disables any text output.
Argument <code>0</code> switches output to <code>stdout</code> (standard output).</div>
<h3 id="m4-m4" class="m4-bh"><a href="#m4-m4" title="⚓"></a>M4<a href="#m4--toc" title="Top"></a></h3>
<p><a href="https://en.wikipedia.org/wiki/Brian_Kernighan" title="Wikipedia"><span class="rs-person">Brian Kernighan</span></a> has enhanced the M3 macro processor to the FORTRAN 66
<a href="https://en.wikipedia.org/wiki/Preprocessor" title="Wikipedia">preprocessor</a> to create a&nbsp;hybrid language extension named <abbr title="RATional FORtran"><b>RATFOR</b></abbr><a href="https://wolfram.schneider.org/bsd/7thEdManVol2/ratfor/ratfor.pdf" title="RATFOR — A Preprocessor for a Rational Fortran" id="m4-ref3">[3]</a>.
The basic program constructions of this extension (conditions, cycles) are the same as in C&nbsp;language.
Programming in RATFOR is similar to C&nbsp;programming.
The macro processor converts the source code back to FORTRAN, then the compiler performs the usual compilation to machine code.</p>
<div title="M4 language complements C language" class="rs-tip-major m4-note">Note the <a href="#m4-ba-c-preprocessor-and-m4" title="`' C preprocessor and M4">almost perfect symbiosis</a> with the C&nbsp;language:<ul>
<li><abbr title="C preprocessor">CPP</abbr> directives <code>#define</code>, <code>#include</code>, <code>#ifdef</code>, … are comments for M4</li>
<li>most keywords separated from parentheses by a&nbsp;white character lose meaning
<ul><li>for example, M4 ignores <code>void define (char c, int i) {…}</code></li></ul></li>
<li>macro arguments separate commas just like commas in C&nbsp;functions
<ul><li>if the <code>FUNC(char c, int i)</code> macro is defined, its variables are:
<code>$# → 2</code>, <code>$0 → FUNC</code>, <code>$1 → char c</code>, <code>$2 → int i</code></li></ul></li>
<li><b>the left</b> <a href="#m4-nonterminal-expansion-control" title="Nonterminal expansion control">control character</a> <code>`</code> is not a&nbsp;part of the C&nbsp;family syntax</li>
<li><b>the right</b> control character <code>'</code> does not matter if it is not part of the macro<br>
<ul><li>both control characters can be hidden into user-defined macros <code>LL()</code>, <code>RR()</code></li></ul></li>
<li>macros are written <code>IN_UPPERCASE</code>, just like <a href="https://en.wikipedia.org/wiki/Terminal_and_nonterminal_symbols" title="Wikipedia">nonterminal symbols</a>
<ul><li>this delimits their namespace</li></ul></li>
</ul>
</div>
<p>The user manual<a href="https://wolfram.schneider.org/bsd/7thEdManVol2/m4/m4.pdf" title="The M4 Macro Processor" id="m4-ref4">[4]</a> mentions other co-authors not mentioned here.
So it would be fairly unfair to write that the authors of the M4 macro processor (1977) are <i>only</i> two people.</p>
<img src="../img/authors.jpg" alt="&nbsp;" width="960" height="400" id="m4-the-authors" title="Christopher Strachey, Dennis Ritchie, Brian Kernighan">
<p><em>Picture <a href="#m4-the-authors" title="⚓">1</a>: Christopher Strachey<a href="https://www.computerhope.com/people/christopher_strachey.htm" title="Christopher Strachey" id="m4-ref5">[5]</a>,
Dennis Ritchie<a href="https://pc.zoznam.sk/novinka/zomrel-tvorca-unixu-jazyka-c" title="Dennis Ritchie" id="m4-ref6">[6]</a>,
Brian Kernighan<a href="https://www.cs.cmu.edu/~mihaib/kernighan-interview/" title="Brian Kernighan" id="m4-ref7">[7]</a></em></p>
<h3 id="m4-gnu-m4" class="m4-bh"><a href="#m4-gnu-m4" title="⚓"></a>GNU M4<a href="#m4--toc" title="Top"></a></h3>
<p>Today, there are several implementations that differ from the original implementation rather by small details.
The most common implementation of M4 is the <b>GNU M4</b> used for <a href="https://en.wikipedia.org/wiki/GNU_Build_System" title="Wikipedia">Autotools</a>
and for translating the simple <code>sendmail.mc</code> configuration file to complex <code>sendmail.cf</code>.
The author of this implementation (1990) is <a href="https://www.seindal.dk/rene/gnu/"><span class="rs-person">René&nbsp;Seindal</span></a>.
To install <span title="with small letter “m”" class="m4-xp">m4</span>, type the following command:</p>
<div id="m4-install" title="the command also installs other important packages" class="m4-cmd m4-root"><pre>dnf -y install make m4 pinfo</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-install" title="⚓"></a></code></div>
<p>A&nbsp;detailed description of the keywords can be found in the documentation<a href="https://www.gnu.org/software/m4/manual/" title="GNU M4 - GNU macro processor" id="m4-ref8">[8]</a>:</p>
<div id="m4-anch-4" class="m4-src"><pre>$ <b>pinfo m4</b>
$ <b>man m4</b>
$ <b>m4 --help</b></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-4" title="⚓"></a></code></div>
<h2 id="m4-basics-of-m4" class="m4-ch"><a href="#m4-basics-of-m4-toc" title="Content"></a><a href="#m4-basics-of-m4" title="⚓">3</a>Basics of M4<a href="#m4--toc" title="Top"></a></h2>
<p>M4 is based on <b>context-free grammar</b>, <b>automata</b>, <b>stacks</b> and <b>output queues</b>.
To understand M4, it is therefore crucial to understand the basic concepts of formal language theory –
<a href="https://en.wikipedia.org/wiki/Terminal_and_nonterminal_symbols" title="Wikipedia">terminal symbols</a> (briefly <b>terminals</b>) and nonterminal symbols (briefly <b>nonterminals</b>).
These terms will be explained later in more detail.
The objective is to show the basic practical use of M4 language on examples.</p>
<h3 id="m4-context-free-grammar" class="m4-ch"><a href="#m4-context-free-grammar-toc" title="Content"></a><a href="#m4-context-free-grammar" title="⚓">3.1</a>Context-free grammar<a href="#m4--toc" title="Top"></a></h3>
<p>Context-free grammar (shortly <abbr title="Context-Free Grammar">CFG</abbr>) is a&nbsp;<a href="#m4-formal-grammar-chomsky-type" title="Formal grammar (Chomsky type)">formal grammar</a> in which all rules for rewriting have the <code class="m4-hgl" data-2="1" data-3="2">A → β</code> form.
The nonterminal <code class="m4-hgl" data-2="D">A</code> is <span class="m4-hgl" data-2="E">rewritten</span> to an arbitrarily long <abbr title="the right side of the rewriting rule"><code class="m4-hgl" data-2="F">β</code></abbr> string composed of <span class="m4-hgl" data-2="B">nonterminals <code>N</code></span> <span class="m4-hgl" data-2="G">or</span> <span class="m4-hgl" data-2="A">terminals <code>Σ</code></span>.
<span class="m4-hgl" data-2="C"><a href="https://en.wikipedia.org/wiki/Kleene_star" title="Wikipedia">Kleene star</a></span> means that nonterminal <code class="m4-hgl" data-2="D" data-3="D">A</code> can be rewritten to <abbr title="epsilon – empty symbol"><code>ε</code></abbr> (rewriting rule <code class="m4-hgl" data-3="5,6">A → ε</code>).</p>
<div id="m4-all-context-free-grammar-rules" title="context-free grammar rewriting rules" class="m4-src"><pre>P: <span class="m4-d">A</span> <span class="m4-e">→</span> <span class="m4-f">β</span>
   <span class="m4-d">A</span> ∈ <span class="m4-b">N</span>
   <span class="m4-f">β</span> ∈ (<span class="m4-b">N</span> <span class="m4-g">∪</span> <span class="m4-a">Σ</span>)<span class="m4-c">*</span></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-all-context-free-grammar-rules" title="⚓"></a></code></div>
<h4 id="m4-m4-rewriting-rules" class="m4-bh"><a href="#m4-m4-rewriting-rules" title="⚓"></a>M4 rewriting rules<a href="#m4--toc" title="Top"></a></h4>
<p>The rules for rewriting <span class="m4-hgl" data-2="1" data-3="2">are the same</span> for context-free grammar and M4.</p>
<div id="m4-rewriting-rules" title="M4 rewriting rules" class="m4-src"><pre># A → β
define(`<span class="m4-d">A</span>', `<span class="m4-f">β</span>')

# A → ε
define(`<span class="m4-d">A</span>', `')
define(`<span class="m4-d">A</span>')</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-rewriting-rules" title="⚓"></a></code></div>
<p>All M4 keywords are nonterminals (macros), which take action and are rewritten to <abbr title="epsilon – empty symbol"><code>ε</code></abbr> or another symbol.
All keywords can be renamed or turned off completely.
This feature is crucial for the preprocessor mode.</p>
<div id="m4-keywords-are-nonterminals" title="M4 keywords are nonterminals" class="m4-src"><pre>divert(ℤ) → ε
define(`A', `β') → ε
ifelse(`', `', `yes', `no') → yes
ifelse(`', `', `ifdef(`dnl', `1', `0')', `no') → ifdef(`dnl', `1', `0') → 1
…</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-keywords-are-nonterminals" title="⚓"></a></code></div>
<h4 id="m4-nonterminal-expansion-control" class="m4-bh"><a href="#m4-nonterminal-expansion-control" title="⚓"></a>Nonterminal expansion control<a href="#m4--toc" title="Top"></a></h4>
<p>The default character pair <code>`'</code> in M4 controls the expansion of nonterminals.
The keyword <code>changequote()</code> can change them to other characters, for example {<code title="square brackets" class="m4-xp">[]</code>, <code title="nonprintable characters" class="m4-xp">␂␆</code>, <code title="UTF-8 characters" class="m4-xp">⟦⟧</code>}.
The nonterminals that we do not want to (immediately) expand are surrounded by this pair of characters.
When passing through the macro processor, all the symbols between this character pair are <b>terminal symbols</b> and the outer character pair is removed.
The next pass will cause the expansion of the originally protected nonterminals.
The control character pair is set at the beginning of the root file.</p>
<h3 id="m4-automata" class="m4-ch"><a href="#m4-automata-toc" title="Content"></a><a href="#m4-automata" title="⚓">3.2</a>Automata<a href="#m4--toc" title="Top"></a></h3>
<p>Automata serve as <q>switches</q> of grammar rules.
Automata use the grammar rules for rewriting as nodes and change their states according to input symbols.
The currently used rule produces a specific code to the output queue (or several output queues) until the automaton moves to another node with a&nbsp;different rule.
The examples of <a href="#m4-jsonw-generating-automaton" title="⟦⟧ JSON: generating automaton">generating automata</a> are in appendix.</p>
<h3 id="m4-output-queues" class="m4-ch"><a href="#m4-output-queues-toc" title="Content"></a><a href="#m4-output-queues" title="⚓">3.3</a>Output queues<a href="#m4--toc" title="Top"></a></h3>
<p>The output queues temporarily store the portions of the resulting code.
These parts are formed using the grammar rules for rewriting which subsequently rewrite input symbols.
The <code>divert(ℤ)</code> keyword sets the output queue.
Finally, all non-empty queues are dumped in ascending order to the standard output and compose the final code.
The examples of the <a href="#m4-htmlw-output-queues" title="⟦⟧ HTML: output queues">output queues</a> are in the appendix.</p>
<div title="for information" class="rs-tip-major m4-info"><b>Stacks</b> will be described later.</div>
<h2 id="m4-main-uses-of-m4" class="m4-ch"><a href="#m4-main-uses-of-m4-toc" title="Content"></a><a href="#m4-main-uses-of-m4" title="⚓">4</a>Main uses of M4<a href="#m4--toc" title="Top"></a></h2>
<p>M4 is used to generate the source code of any programming language or as a&nbsp;preprocessor for any source code.</p>
<h3 id="m4-the-code-generation" class="m4-ch"><a href="#m4-the-code-generation-toc" title="Content"></a><a href="#m4-the-code-generation" title="⚓">4.1</a>The code generation<a href="#m4--toc" title="Top"></a></h3>
<p>M4 transforms input data from <abbr title="Macro Configuration"><code>.mc</code></abbr> files to output data with the following command:</p>
<div id="m4-files-on-command-line" title="← the_most_general.m4 … the_most_special.m4 →" class="m4-cmd m4-usc"><pre>m4 root.m4 stem.m4 branch.m4 leaf.m4 input1.mc input2.mc > output.file</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-files-on-command-line" title="⚓"></a></code></div>
<p>Two basic operations are performed during file loading:</p>
<ol>
<li>the reading transformation rules from files with the <code>.m4</code> extension</li>
<li>the expansion of macros inside <code>.mc</code> files</li>
</ol>
<p>The <code>input1.mc</code> and <code>input2.mc</code> files contain the <b>input data</b> in a&nbsp;format that allows them to be transformed into <b>output data</b> according to the rules in the previous <code>.m4</code> files.
The <code>.mc</code> data files usually do not contain any transformation rules.</p>
<p>The input data may also come from the pipeline:</p>
<div id="m4-anch-9" title="input code → source code generation → file" class="m4-cmd m4-usc"><pre>cat input.mc | m4 root.m4 stem.m4 branch.m4 leaf.m4 - > output.file</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-9" title="⚓"></a></code></div>
<div id="m4-anch-10" title="input code → source code generation → program" class="m4-cmd m4-usc"><pre>cat input.mc | m4 root.m4 stem.m4 branch.m4 leaf.m4 - | gcc -x c -o progr -</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-10" title="⚓"></a></code></div>
<p>Try: <a href="#m4-code-generation-examples" title="Code generation examples">Code generation examples</a></p>
<h3 id="m4-the-preprocessor" class="m4-ch"><a href="#m4-the-preprocessor-toc" title="Content"></a><a href="#m4-the-preprocessor" title="⚓">4.2</a>The preprocessor<a href="#m4--toc" title="Top"></a></h3>
<p>M4 can operate in the preprocessor mode and can also be part of a&nbsp;pipeline.
The input source code passes unchanged through except for nonterminal symbols.
The nonterminals found are expanded to terminals and the output along with the source code.
M4 can extend any other language where the preprocessor is insufficient (no recursion) or none.
It is important to select the left character for nonterminal expansion control, which must not collide with the input source code character.
However the character collision is easily solved by a regex.</p>
<div id="m4-anch-11" title="M4 as preprocessor – in general" class="m4-cmd m4-usc"><pre>m4 root.m4 stem.m4 branch.m4 leaf.m4 file.c > preproc.file.c</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-11" title="⚓"></a></code></div>
<div id="m4-anch-12" title="M4 as preprocessor – without intermediate file" class="m4-cmd m4-usc"><pre>m4 root.m4 stem.m4 branch.m4 leaf.m4 file.c | gcc -x c -o progr -</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-12" title="⚓"></a></code></div>
<h4 id="m4-ba-default-characters" class="m4-bh"><a href="#m4-ba-default-characters" title="⚓"></a><code>`'</code> Default characters<a href="#m4--toc" title="Top"></a></h4>
<p>The conflicting character <code>`</code> from the input source code is hidden into a&nbsp;macro <code>`'LL()</code>.
An empty pair of control characters <code>`'</code> before the macro serves as a&nbsp;<a href="#m4-lr-hw-brackets-lr-l-r-lhr-ldn" title="[] .h: brackets [], [,], [⟦#⟧], [⟦dnl⟧]">symbol separator</a>.
When the source code is passed through the macro processor, the <code>`'LL()</code> macro is rewritten back to the original <code>`</code> character and the empty pair <code>`'</code> is removed.</p>
<div id="m4-anch-13" title="M4 as preprocessor with control characters: `'" class="m4-cmd m4-usc"><pre>sed 's/`/`'\''LL()/g' any.src | m4 rootq.m4 leaf.m4 -</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-13" title="⚓"></a></code></div>
<p>If there are <code>#</code> or <code>dnl</code> comments in the source code, they must be hidden first.
The characters <code>`'</code> <a href="#m4-lr-hw-brackets-lr-l-r-lhr-ldn" title="[] .h: brackets [], [,], [⟦#⟧], [⟦dnl⟧]">turn off</a> original meaning and will be removed by the macro processor.<br>
M4 <code>#</code> and <code>dnl</code> comments are hidden between default characters: <code>`#'</code> <code>`dnl'</code></p>
<div id="m4-anch-14" title="M4 as preprocessor with control characters: `'" class="m4-cmd m4-usc"><pre>sed 's/`/`'\''LL()/g;s/#\|\&lt;dnl\>/`&amp;'\''/g' any.src | m4 rootq.m4 leaf.m4 -</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-14" title="⚓"></a></code></div>
<div id="m4-anch-15" title="M4 as preprocessor with control characters differently: `'" class="m4-cmd m4-usc"><pre>sed 's/`/`'\''LL()/g;s/#/`#'\''/g;s/\&lt;dnl\>/`dnl'\''/g' any.src | m4 …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-15" title="⚓"></a></code></div>
<h4 id="m4-lr-square-brackets" class="m4-bh"><a href="#m4-lr-square-brackets" title="⚓"></a><code>[]</code> Square brackets<a href="#m4--toc" title="Top"></a></h4>
<p>If square brackets are used to <a href="#m4-nonterminal-expansion-control" title="Nonterminal expansion control">control the expansion</a> of nonterminals, the left <code>[</code> square bracket is hidden in the same way.
Everything else applies as for default characters <code>`'</code>.</p>
<div id="m4-anch-16" title="M4 as preprocessor with control characters: []" class="m4-cmd m4-usc"><pre>sed 's/\[/[]LL()/g' any.src | m4 rootb.m4 leaf.m4 - | …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-16" title="⚓"></a></code></div>
<p>M4 <code>#</code> and <code>dnl</code> comments are hidden between parentheses: <code>[#]</code> <code>[dnl]</code></p>
<div id="m4-anch-17" title="M4 as preprocessor with control characters: []" class="m4-cmd m4-usc"><pre>sed 's/\[/[]LL()/g;s/#\|\&lt;dnl\>/[&amp;]/g' any.src | m4 rootb.m4 leaf.m4 - | …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-17" title="⚓"></a></code></div>
<div id="m4-anch-18" title="M4 as preprocessor with control characters differently: []" class="m4-cmd m4-usc"><pre>sed 's/\[/[]LL()/g;s/#/[#]/g;s/\&lt;dnl\>/[dnl]/g' any.src | m4 rootb.m4 …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-18" title="⚓"></a></code></div>
<h4 id="m4-non-printable-characters" class="m4-bh"><a href="#m4-non-printable-characters" title="⚓"></a><code>␂␆</code> Non printable characters<a href="#m4--toc" title="Top"></a></h4>
<p>Non printable characters <b><code>␂</code></b> (<samp>0x02</samp>) and <b><code>␆</code></b> (<samp>0x06</samp>) can be used to control the expansion of nonterminals.
These characters cannot interfere with printable source code characters.</p>
<div id="m4-anch-19" title="M4 as preprocessor with control characters: ␂␆" class="m4-cmd m4-usc"><pre>m4 rootn.m4 leaf.m4 any.src | gcc …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-19" title="⚓"></a></code></div>
<p>M4 <code>#</code> and <code>dnl</code> comments are hidden between non printable characters: <code>␂#␆</code> <code>␂dnl␆</code></p>
<div id="m4-anch-20" title="M4 as preprocessor with control characters: ␂␆" class="m4-cmd m4-usc"><pre>sed 's/#\|\&lt;dnl\>/␂&amp;␆/g' any.src | m4 rootn.m4 leaf.m4 - | gcc …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-20" title="⚓"></a></code></div>
<div id="m4-anch-21" title="M4 as preprocessor with control characters differently: ␂␆" class="m4-cmd m4-usc"><pre>sed 's/#/␂#␆/g;s/\&lt;dnl\>/␂dnl␆/g' any.src | m4 rootn.m4 leaf.m4 - | gcc …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-21" title="⚓"></a></code></div>
<h4 id="m4-utf-8-characters" class="m4-bh"><a href="#m4-utf-8-characters" title="⚓"></a><code>⟦⟧</code> UTF-8 characters<a href="#m4--toc" title="Top"></a></h4>
<p>Expansion of nonterminals can also be controlled by a suitably selected UTF-8 character pair.
The usual source code does not contain such characters, so we do not have to solve the collision of the left control <code>⟦</code> character.
UTF-8 characters offer similar advantages to non printable characters.</p>
<div id="m4-anch-22" title="M4 as preprocessor with control characters: ⟦⟧" class="m4-cmd m4-usc"><pre>m4 rootu.m4 leaf.m4 any.src | gcc …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-22" title="⚓"></a></code></div>
<p>M4 <code>#</code> and <code>dnl</code> comments are hidden between UTF-8 characters: <code>⟦#⟧</code> <code>⟦dnl⟧</code></p>
<div id="m4-anch-23" title="M4 as preprocessor with control characters: ⟦⟧" class="m4-cmd m4-usc"><pre>sed 's/#\|\&lt;dnl\>/⟦&amp;⟧/g' any.src | m4 rootu.m4 leaf.m4 - | gcc …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-23" title="⚓"></a></code></div>
<div id="m4-anch-24" title="M4 as preprocessor with control characters differently: ⟦⟧" class="m4-cmd m4-usc"><pre>sed 's/#/⟦#⟧/g;s/\&lt;dnl\>/⟦dnl⟧/g' any.src | m4 rootu.m4 leaf.m4 - | gcc …</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-24" title="⚓"></a></code></div>
<p>Try: <a href="#m4-preprocessor-examples" title="Preprocessor examples">Preprocessor examples</a></p>
<h4 id="m4-mixed-mode" class="m4-bh"><a href="#m4-mixed-mode" title="⚓"></a>Mixed mode<a href="#m4--toc" title="Top"></a></h4>
<p>The mixed mode is a&nbsp;combination of the previous modes and is mainly used for experiments.
The data is not separated from the rules for its transformation.
The leaf file <code>leaf.m4</code> contains transformation rule definitions along with input data.</p>
<div id="m4-anch-25" title="how to learn M4" class="m4-cmd m4-usc"><pre>m4 root.m4 leaf.m4</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-25" title="⚓"></a></code></div>
<p>Try: <a href="#m4-m4w-examples" title="M4: examples">M4: examples</a></p>
<h2 id="m4-prerequisites-for-mastering-m" class="m4-ch"><a href="#m4-prerequisites-for-mastering-m-toc" title="Content"></a><a href="#m4-prerequisites-for-mastering-m" title="⚓">5</a>Prerequisites for mastering M4<a href="#m4--toc" title="Top"></a></h2>
<p>To successfully master this macro language it is important to fulfill several prerequisites.
M4 is not a&nbsp;simple language because it is not possible to think and program in it like an ordinary programming language.
The most important thing to realize is that it is used to program the grammar rules for rewriting.
Each string is either a&nbsp;terminal or a&nbsp;nonterminal symbol, including all language keywords (the symbols <code>#</code> and <code>,</code> are special cases of nonterminals).</p>
<div title="note" class="rs-tip-major m4-note">M4 intentionally does not have keywords for <b>cycles</b> (<code>for</code>/<code>while</code>) because its basis is quite different from procedural or functional languages.<hr>
<ul>
<li><b>loops</b> are only left-recursive or right-recursive</li>
<li><b>branching</b> is made by <a href="#m4-branching-by-grammar" title="⟦⟧ Branching by grammar">symbol concatenation</a> or <code>ifelse()</code>, <code>ifdef()</code> keywords</li>
</ul>
</div>
<h3 id="m4-fundamentals-of-grammars" class="m4-ch"><a href="#m4-fundamentals-of-grammars-toc" title="Content"></a><a href="#m4-fundamentals-of-grammars" title="⚓">5.1</a>Fundamentals of grammars<a href="#m4--toc" title="Top"></a></h3>
<p>All grammars are based on the <span class="m4-hgl" data-5="6">rules for rewriting</span> and their forms are generally described:</p>
<h4 id="m4-formal-grammar-chomsky-type" class="m4-bh"><a href="#m4-formal-grammar-chomsky-type" title="⚓"></a>Formal grammar (Chomsky type)<a href="#m4--toc" title="Top"></a></h4>
<div id="m4-formal-definition" class="m4-src"><pre>G = (N, Σ, P, S)
N: a finite set of nonterminal symbols
Σ: a finite set of terminal symbols
   N ∩ Σ = ø
P: a finite set of production (rewrite) rules
   <span class="m4-x">(N ∪ Σ)*</span> <span class="m4-s">N</span> <span class="m4-x">(N ∪ Σ)*</span> → <span class="m4-s">(N ∪ Σ)*</span>
S: is the start symbol
   S ∈ N</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-formal-definition" title="⚓"></a></code></div>
<p>The <a href="https://en.wikipedia.org/wiki/Formal_grammar" title="Wikipedia">Formal grammar</a> describes the <a href="https://en.wikipedia.org/wiki/Chomsky_hierarchy" title="Chomsky hierarchy
(Wikipedia)">subsets</a> of the
<a href="https://en.wikipedia.org/wiki/Formal_language" title="Wikipedia">formal language</a>
rewriting rules and one of the subsets is called <span class="m4-hgl" data-5="S,X"><a href="https://en.wikipedia.org/wiki/Context-free_grammar" title="Wikipedia">context-free grammar</a></span>,
shortly <abbr title="Context-Free Grammar">CFG</abbr>.
As mentioned earlier, the CFG rewriting rules work the same as the M4 rewriting rules.
Some of the following episodes of this series will focus on formal grammar in detail.</p>
<h3 id="m4-fundamentals-of-automata" class="m4-ch"><a href="#m4-fundamentals-of-automata-toc" title="Content"></a><a href="#m4-fundamentals-of-automata" title="⚓">5.2</a>Fundamentals of automata<a href="#m4--toc" title="Top"></a></h3>
<p>The ability to use predominantly two-state automata is an essential thing for writing simple M4 scripts because the vast majority of scripts use <a href="#m4-cw-small-automaton" title="⟦⟧ C: small automaton">small automata</a>.</p>
<h4 id="m4-testing-automaton" class="m4-bh"><a href="#m4-testing-automaton" title="⚓"></a>Testing automaton<a href="#m4--toc" title="Top"></a></h4>
<p>The order of input symbols or their context can be tested by an automaton.
If the input symbols meet the required properties, the automaton ends up in&nbsp;a&nbsp;double-ring node which indicates the accepting state.</p>
<img src="../img/dfa.png" alt="&nbsp;" width="274" height="155" id="m4-dfa-img" title="deterministic finite automaton (DFA)">
<p><em>Picture <a href="#m4-dfa-img" title="⚓">2</a>: Example of an automaton<a href="https://en.wikipedia.org/wiki/Automata_theory" title="Automata theory" id="m4-ref9">[9]</a> accepting an even number (none is even) of symbols <code>0</code>, ignoring symbols <code>1</code>.
The automaton is the same as the regular expression <code>(1*01*01*)*1*</code>.</em></p>
<p>The previous automaton can be written as an ASCII art accompanying the M4 script:</p>
<div id="m4-anch-27" title="ASCII art for M4 code documentation" class="m4-src"><pre>#          ____1
#         |   /
#      ___V__/   0    ____
# --->// S1 \\------>/ S2 \---.1
#     \\____//&lt;------\____/&lt;--'
#                0</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-27" title="⚓"></a></code></div>
<h4 id="m4-generating-automaton" class="m4-bh"><a href="#m4-generating-automaton" title="⚓"></a>Generating automaton<a href="#m4--toc" title="Top"></a></h4>
<p>Input symbols change the nodes of the automaton, thereby changing the rewriting rules for code generation.
See the appendix for <a href="#m4-jsonw-generating-automaton" title="⟦⟧ JSON: generating automaton">this generating automaton</a>:</p>
<div id="m4-anch-28" title="ASCII art of generating automaton" class="m4-src"><pre>#      _______      ___________
# --->/ ERROR \--->/ NEXT_ITEM \---.
#     \_______/    \___________/&lt;--'</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-anch-28" title="⚓"></a></code></div>
<h3 id="m4-gnu-make" class="m4-ch"><a href="#m4-gnu-make-toc" title="Content"></a><a href="#m4-gnu-make" title="⚓">5.3</a>(GNU) make<a href="#m4--toc" title="Top"></a></h3>
<p>A&nbsp;well-designed code generator usually consists of several smaller files whose order, dependencies and parameters are written to the <code>Makefile</code> file.
Good knowledge of <code>Makefile</code> writing is therefore a&nbsp;prerequisite for mastering M4.
Reading and maintaining source code generally takes more time than creating it.
A&nbsp;well-structured <code>Makefile</code> therefore significantly contributes to the overall clarity of the resulting code generator.</p>
<div title="we will deal with this topic at another part" class="rs-tip-major m4-note">Executing <code>make</code><a href="https://www.gnu.org/software/make/manual/make.html" title="GNU Make Manual" id="m4-ref10">[10]</a> from the code editor with a&nbsp;shortcut key will significantly speed up M4 code development.
The file <code>~/.vimrc</code> contains <code>nnoremap &lt;c-j&gt; :make&lt;cr&gt;</code>.</div>
<h3 id="m4-vim" class="m4-ch"><a href="#m4-vim-toc" title="Content"></a><a href="#m4-vim" title="⚓">5.4</a>Vim<a href="#m4--toc" title="Top"></a></h3>
<p>Mastering the Vim<a href="https://www.vim.org/" title="Vim – the ubiquitous text editor" id="m4-ref11">[11]</a> editor is an important prerequisite for the convenience and speed of writing M4 code.
Vim shortcuts, defined by the <code>iabbrev</code> keyword, will save large amounts of unnecessary typing.
These shortcuts also significantly reduce the occurrence of almost invisible errors caused by an unpaired bracket, thus saving the lost time spent on debugging.</p>
<h3 id="m4-talent-and-time" class="m4-ch"><a href="#m4-talent-and-time-toc" title="Content"></a><a href="#m4-talent-and-time" title="⚓">5.5</a>Talent and time<a href="#m4--toc" title="Top"></a></h3>
<p>M4 usually cannot be mastered over the weekend, especially when the fundamentals<a href="https://is.muni.cz/elportal/estud/fi/js06/ib005/Formalni_jazyky_a_automaty_I.pdf" title="Automaty a&nbsp;formální jazyky I" id="m4-ref12">[12]</a> of
<a href="https://en.wikipedia.org/wiki/Automata_theory" title="Wikipedia">automata theory</a> and <a href="https://en.wikipedia.org/wiki/Formal_grammar" title="Wikipedia">formal&nbsp;grammars</a> are lacking.
In order to master the M4 language, it is necessary to program in a&nbsp;longer period of time and write amounts of bad (complex) M4 code that you rewrite for a&nbsp;better idea.
In this way it is possible to gradually gain practice.</p>
<!-- article references -->
<h2 id="m4-links" class="m4-ch"><a href="#m4-links-toc" title="Content"></a><a href="#m4-links" title="⚓">6</a>References<a href="#m4--toc" title="Top"></a></h2>
<ol class="m4-refs">
<li><a href="#m4-ref1" title="link in the text"></a><b>Generating code in M4</b>, a&nbsp;template with examples for <a href="https://www.root.cz" title="Root.cz – information not only from the Linux world">www.root.cz</a>
<a href="http://github.com/jkubin/m4root">http://github.com/jkubin/m4root</a></li>
<li><a href="#m4-ref2" title="link in the text"></a><b>A&nbsp;General Purpose Macro-generator</b>, Computer Journal 8, 3 (1965), 225–41
<a href="http://dx.doi.org/10.1093/comjnl/8.3.225">http://dx.doi.org/10.1093/comjnl/8.3.225</a></li>
<li><a href="#m4-ref3" title="link in the text"></a><b>RATFOR — A Preprocessor for a Rational Fortran</b>, Brian W. Kernighan
<a href="https://wolfram.schneider.org/bsd/7thEdManVol2/ratfor/ratfor.pdf">https://wolfram.schneider.org/bsd/7thEdManVol2/ratfor/ratfor.pdf</a></li>
<li><a href="#m4-ref4" title="link in the text"></a><b>The M4 Macro Processor</b>, Bell Laboratories (1977)
<a href="https://wolfram.schneider.org/bsd/7thEdManVol2/m4/m4.pdf">https://wolfram.schneider.org/bsd/7thEdManVol2/m4/m4.pdf</a></li>
<li><a href="#m4-ref5" title="link in the text"></a><b>Christopher Strachey</b>, Computer Hope – Free computer help since 1998
<a href="https://www.computerhope.com/people/christopher_strachey.htm">https://www.computerhope.com/people/christopher_strachey.htm</a></li>
<li><a href="#m4-ref6" title="link in the text"></a><b>Dennis Ritchie</b>, Zomrel tvorca Unixu a&nbsp;jazyka&nbsp;C
<a href="https://pc.zoznam.sk/novinka/zomrel-tvorca-unixu-jazyka-c">https://pc.zoznam.sk/novinka/zomrel-tvorca-unixu-jazyka-c</a></li>
<li><a href="#m4-ref7" title="link in the text"></a><b>Brian Kernighan</b>, An Interview with Brian Kernighan
<a href="https://www.cs.cmu.edu/~mihaib/kernighan-interview/">https://www.cs.cmu.edu/~mihaib/kernighan-interview/</a></li>
<li><a href="#m4-ref8" title="link in the text"></a><b>GNU M4 - GNU macro processor</b>, Free Software Foundation
<a href="https://www.gnu.org/software/m4/manual/">https://www.gnu.org/software/m4/manual/</a></li>
<li><a href="#m4-ref9" title="link in the text"></a><b>Automata theory</b>, From Wikipedia, the free encyclopedia
<a href="https://en.wikipedia.org/wiki/Automata_theory">https://en.wikipedia.org/wiki/Automata_theory</a></li>
<li><a href="#m4-ref10" title="link in the text"></a><b>GNU Make Manual</b>, Free Software Foundation
<a href="https://www.gnu.org/software/make/manual/make.html">https://www.gnu.org/software/make/manual/make.html</a></li>
<li><a href="#m4-ref11" title="link in the text"></a><b>Vim – the ubiquitous text editor</b>, that edits text at the speed of thought
<a href="https://www.vim.org/">https://www.vim.org/</a></li>
<li><a href="#m4-ref12" title="link in the text"></a><b>Automaty a&nbsp;formální jazyky I</b>, Učební text FI MU
<a href="https://is.muni.cz/elportal/estud/fi/js06/ib005/Formalni_jazyky_a_automaty_I.pdf">https://is.muni.cz/elportal/estud/fi/js06/ib005/Formalni_jazyky_a_automaty_I.pdf</a></li>
<li><b>Automaty a&nbsp;gramatiky</b>, Michal Chytil, 1. vydání, Praha, 331 s. 1984.
<a href="https://is.muni.cz/publication/173173">https://is.muni.cz/publication/173173</a></li>
</ol>
<!-- appendix content -->
<h2 id="m4-code-generation-examples" class="m4-ch"><a href="#m4-code-generation-examples-toc" title="Content"></a><a href="#m4-code-generation-examples" title="⚓">A</a>Code generation examples<a href="#m4--toc" title="Top"></a></h2>
<div title="for information" class="rs-tip-major m4-info">Chars. {<code title="quotation marks" class="m4-xp">`'</code>, <code title="square brackets" class="m4-xp">[]</code>, <code title="nonprintable characters" class="m4-xp">␂␆</code>, <code title="UTF-8 characters" class="m4-xp">⟦⟧</code>} in the name controls the <a href="../generating-code-in-m4-introduction/preview.html#m4-nonterminal-expansion-control" title="Nonterminal expansion control">expansion of nonterminals</a>.</div>
<p id="m4-input-source-code-toc" class="m4-l2"><a href="#m4-input-source-code"><b>A.1</b><code>⟦⟧</code> Input source code</a></p>
<p id="m4-csvw-simplest-example-toc" class="m4-l2"><a href="#m4-csvw-simplest-example"><b>A.2</b><code>⟦⟧</code> CSV: simplest example</a></p>
<p id="m4-csvw-counter-toc" class="m4-l2"><a href="#m4-csvw-counter"><b>A.3</b><code>⟦⟧</code> CSV: counter</a></p>
<p id="m4-modification-of-special-chara-toc" class="m4-l2"><a href="#m4-modification-of-special-chara"><b>A.4</b><code title="how to do it" style="cursor:help">💡</code> Modification of special characters</a></p>
<p id="m4-cw-output-queue-toc" class="m4-l2"><a href="#m4-cw-output-queue"><b>A.5</b><code>⟦⟧</code> C: output queue</a></p>
<p id="m4-iniw-an-external-command-toc" class="m4-l2"><a href="#m4-iniw-an-external-command"><b>A.6</b><code>⟦⟧</code> INI: an external command</a></p>
<p id="m4-hw-hex-counter-toc" class="m4-l2"><a href="#m4-hw-hex-counter"><b>A.7</b><code>⟦⟧</code> .h: hex counter</a></p>
<p id="m4-cw-small-automaton-toc" class="m4-l2"><a href="#m4-cw-small-automaton"><b>A.8</b><code>⟦⟧</code> C: small automaton</a></p>
<p id="m4-cw-small-automaton-2-toc" class="m4-l2"><a href="#m4-cw-small-automaton-2"><b>A.9</b><code>⟦⟧</code> C: small automaton 2</a></p>
<p id="m4-htmlw-output-queues-toc" class="m4-l2"><a href="#m4-htmlw-output-queues"><b>A.10</b><code>⟦⟧</code> HTML: output queues</a></p>
<p id="m4-branching-by-grammar-toc" class="m4-l2"><a href="#m4-branching-by-grammar"><b>A.11</b><code>⟦⟧</code> Branching by grammar</a></p>
<p id="m4-jsonw-generating-automaton-toc" class="m4-l2"><a href="#m4-jsonw-generating-automaton"><b>A.12</b><code>⟦⟧</code> JSON: generating automaton</a></p>
<p id="m4-jsonw-named-queues-toc" class="m4-l3"><a href="#m4-jsonw-named-queues"><b>A.12.1</b><code>⟦⟧</code> JSON: named queues</a></p>
<p id="m4-jsonw-generated-queue-indexes-toc" class="m4-l3"><a href="#m4-jsonw-generated-queue-indexes"><b>A.12.2</b><code>⟦⟧</code> JSON: generated queue indexes</a></p>
<p id="m4-iniw-discontinuous-queue-inde-toc" class="m4-l2"><a href="#m4-iniw-discontinuous-queue-inde"><b>A.13</b><code>⟦⟧</code> INI: discontinuous queue index</a></p>
<p id="m4-xmlw-mixed-messages-toc" class="m4-l2"><a href="#m4-xmlw-mixed-messages"><b>A.14</b><code>⟦⟧</code> XML: mixed messages</a></p>
<p id="m4-xmlw-separated-messages-toc" class="m4-l2"><a href="#m4-xmlw-separated-messages"><b>A.15</b><code>⟦⟧</code> XML: separated messages</a></p>
<p id="m4-bash-echo-dstringd-toc" class="m4-l2"><a href="#m4-bash-echo-dstringd"><b>A.16</b><code>⟦⟧</code> Bash <code>$ echo &quot;string&quot;</code></a></p>
<p id="m4-bash-echo-astringa-toc" class="m4-l2"><a href="#m4-bash-echo-astringa"><b>A.17</b><code>⟦⟧</code> Bash <code>$ echo 'string'</code></a></p>
<div title="note" class="rs-tip-major m4-note">The examples in this appendix are more complex and are intended to demonstrate the practical use of M4.
They will be explained in detail later.</div>
<h3 id="m4-input-source-code" class="m4-ch"><a href="#m4-input-source-code-toc" title="Content"></a><a href="#m4-input-source-code" title="⚓">A.1</a><code>⟦⟧</code> Input source code<a href="#m4--toc" title="Top"></a></h3>
<p>The input source code is similar to <abbr title="Comma Separated Values">CSV</abbr>, which is converted to arbitrarily complex target code of another language using <abbr title="Context-Free Grammar">CFG</abbr>, automata and output queues.
Stacks in the examples are not used.
The input source code contains special characters that must be hidden:</p>
<div id="m4-messages_messages_raw-mc" class="m4-src"><pre># 2018/05/15 Josef Kubin

<span class="m4-r">ERROR</span>(⟦COMPLEX⟧,     ⟦!"#$%&amp;'()*+,-./:;&lt;=>?@[\]^_`{|}~⟧)
QUERY(⟦READABLE⟧,    ⟦Is badly written M4 code readable [N/y]?⟧)
<span class="m4-r">ERROR</span>(⟦SUCCESS⟧,     ⟦Too complex M4 code failed successfully.⟧)
WARNING(⟦ADDICTIVE⟧, ⟦Programming in M4 is addictive!⟧)
<span class="m4-r">ERROR</span>(⟦NO_FAULT⟧,    ⟦It's not a language fault!⟧)
WARNING(⟦NO_ERRORS⟧, ⟦No other errors were found.⟧)</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages_raw.mc" title="messages/messages_raw.mc
date: 20210103 13:28:44
sha1sum: d1f057c
size: 420 B">messages_raw.mc</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages_raw-mc" title="⚓"></a></code></div>
<div title="note" class="rs-tip-major m4-note">The input file may also contain notes that may not be hidden in the comments <code>#</code>, <code>dnl</code>, <code>ifelse(⟦…⟧)</code> or <code>⟦… somewhere inside brackets …⟧</code>.</div>
<h3 id="m4-csvw-simplest-example" class="m4-ch"><a href="#m4-csvw-simplest-example-toc" title="Content"></a><a href="#m4-csvw-simplest-example" title="⚓">A.2</a><code>⟦⟧</code> CSV: simplest example<a href="#m4--toc" title="Top"></a></h3>
<p>This example does not use output queues, <span class="m4-hgl" data-9="R,5" data-10="1-3" data-8="R,3,5,7">it only prints</span> <abbr title="Comma Separated Values">CSV</abbr> separated by <code>TAB</code> to <span class="m4-hgl" data-9="4">standard output</span>.</p>
<div id="m4-messages_hello-csv-m4" class="m4-src"><pre># A → β
define(⟦<span class="m4-r">ERROR</span>⟧, ⟦

	divert(0)dnl
⟦$1    $2⟧
divert(-1)
⟧)</pre><code><span class="m4-sha">825d4a3</span><a href="../messages/hello.csv.m4" title="messages/hello.csv.m4
date: 20210120 19:01:00
sha1sum: 100b66a
size: 81 B">hello.csv.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_hello-csv-m4" title="⚓"></a></code></div>
<div id="m4-messages_hello-csv-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/hello.csv.m4" title="messages/hello.csv.m4
date: 20210120 19:01:00
git rev: 825d4a3
sha1sum: 100b66a
size: 81 B">hello.csv.m4</a> <a href="../messages/messages_raw.mc" title="messages/messages_raw.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: d1f057c
size: 420 B">messages_raw.mc</a> > <a href="../messages/hello.csv" title="messages/hello.csv
date: 20210120 19:01:00
git rev: 825d4a3
sha1sum: e217b28
size: 135 B">hello.csv</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_hello-csv-command" title="⚓"></a></code></div>
<div id="m4-messages_hello-csv" class="m4-src"><pre>COMPLEX    !"#$%&amp;'()*+,-./:;&lt;=>?@[\]^_`{|}~
SUCCESS    Too complex M4 code failed successfully.
NO_FAULT    It's not a language fault!</pre><code><span class="m4-sha">825d4a3</span><a href="../messages/hello.csv" title="messages/hello.csv
date: 20210120 19:01:00
sha1sum: e217b28
size: 135 B">hello.csv</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_hello-csv" title="⚓"></a></code></div>
<h3 id="m4-csvw-counter" class="m4-ch"><a href="#m4-csvw-counter-toc" title="Content"></a><a href="#m4-csvw-counter" title="⚓">A.3</a><code>⟦⟧</code> CSV: counter<a href="#m4--toc" title="Top"></a></h3>
<p>The example uses the <code class="m4-hgl" data-11="A">COUNT_UP</code> macro from the <code>countu.m4</code> file whose <abbr title="the right side of the rewriting rule"><code>β</code></abbr> is copied to the right side of the <code class="m4-hgl" data-11="2">COUNTER</code> macro.
During the first expansion of <code class="m4-hgl" data-11="5">COUNTER</code> its initial value is initialized.
<span class="m4-hgl" data-11="B">Further expansion</span> returns <span class="m4-hgl" data-12="A">the numeric terminal symbol</span> and increases the inner auxiliary (global) symbol by one.
<code>COUNTER</code> is a&nbsp;small automaton.</p>
<div id="m4-messages_counter-csv-m4" class="m4-src"><pre># A → β
define(⟦COUNTER⟧, defn(⟦<span class="m4-a">COUNT_UP</span>⟧))

# init counter
COUNTER(1)

# A → β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
ERR_⟦⟧<span class="m4-b">COUNTER</span>    ⟦$1	$2⟧
divert(-1)
⟧)</pre><code><span class="m4-sha">825d4a3</span><a href="../messages/counter.csv.m4" title="messages/counter.csv.m4
date: 20210120 19:01:00
sha1sum: 856d37d
size: 182 B">counter.csv.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_counter-csv-m4" title="⚓"></a></code></div>
<div id="m4-messages_counter-csv-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../messages/counter.csv.m4" title="messages/counter.csv.m4
date: 20210120 19:01:00
git rev: 825d4a3
sha1sum: 856d37d
size: 182 B">counter.csv.m4</a> <a href="../messages/messages_raw.mc" title="messages/messages_raw.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: d1f057c
size: 420 B">messages_raw.mc</a> > <a href="../messages/counter.csv" title="messages/counter.csv
date: 20210120 19:01:00
git rev: 825d4a3
sha1sum: 8c62269
size: 153 B">counter.csv</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_counter-csv-command" title="⚓"></a></code></div>
<div id="m4-messages_counter-csv" class="m4-src"><pre>ERR_<span class="m4-a">1</span>    COMPLEX	!"#$%&amp;'()*+,-./:;&lt;=>?@[\]^_`{|}~
ERR_<span class="m4-a">2</span>    SUCCESS	Too complex M4 code failed successfully.
ERR_<span class="m4-a">3</span>    NO_FAULT	It's not a language fault!</pre><code><span class="m4-sha">825d4a3</span><a href="../messages/counter.csv" title="messages/counter.csv
date: 20210120 19:01:00
sha1sum: 8c62269
size: 153 B">counter.csv</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_counter-csv" title="⚓"></a></code></div>
<h3 id="m4-modification-of-special-chara" class="m4-ch"><a href="#m4-modification-of-special-chara-toc" title="Content"></a><a href="#m4-modification-of-special-chara" title="⚓">A.4</a><code title="how to do it" style="cursor:help">💡</code> Modification of special characters<a href="#m4--toc" title="Top"></a></h3>
<p>Each type of output code requires the modification of the special characters.
The M4 <code>patsubst()</code> keyword is inappropriate for this type of task.
First, we hide all special characters of the input file into <span class="m4-hgl" data-13="A">appropriately named macros</span> using regular expressions.</p>
<h4 id="m4-modified-input-code" class="m4-bh"><a href="#m4-modified-input-code" title="⚓"></a>Modified input code<a href="#m4--toc" title="Top"></a></h4>
<div id="m4-messages_messages-mc" class="m4-src"><pre title="all special characters are hidden into macros"># 2018/05/15 Josef Kubin

ERROR(⟦COMPLEX⟧,     ⟦⟦⟧<span class="m4-a">EX()</span>⟦⟧<span class="m4-a">DQ()</span>⟦#⟧⟦⟧<span class="m4-a">DO()</span>%⟦⟧<span class="m4-a">AMP()</span>⟦⟧<span class="m4-a">AP()</span>()*+,-./:;⟦⟧<span class="m4-a">LT()</span>=⟦⟧<span class="m4-a">GT()</span>?@[⟦⟧<span class="m4-a">BS()</span>]^_⟦⟧<span class="m4-a">BQ()</span>{|}~⟧)
QUERY(⟦READABLE⟧,    ⟦Is badly written M4 code readable [N/y]?⟧)
ERROR(⟦SUCCESS⟧,     ⟦Too complex M4 code failed successfully.⟧)
WARNING(⟦ADDICTIVE⟧, ⟦Programming in M4 is addictive⟦⟧<span class="m4-a">EX()</span>⟧)
ERROR(⟦NO_FAULT⟧,    ⟦It⟦⟧<span class="m4-a">AP()</span>s not a language fault⟦⟧<span class="m4-a">EX()</span>⟧)
WARNING(⟦NO_ERRORS⟧, ⟦No other errors were found.⟧)</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
sha1sum: c6496e4
size: 535 B">messages.mc</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-mc" title="⚓"></a></code></div>
<h4 id="m4-conversion-file-for-xml-xslt" class="m4-bh"><a href="#m4-conversion-file-for-xml-xslt" title="⚓"></a><code>⟦⟧</code> Conversion file for XML, XSLT, HTML<a href="#m4--toc" title="Top"></a></h4>
<div id="m4-messages_markup-m4" class="m4-src"><pre title="conversion file for markup languages"># A → β
define(⟦AMP⟧, ⟦&amp;amp;⟧)
define(⟦AP⟧, ⟦'⟧)
define(⟦BQ⟧, ⟦`⟧)
define(⟦BS⟧, ⟦\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦"⟧)
define(⟦EX⟧, ⟦!⟧)
define(⟦GT⟧, ⟦&amp;gt;⟧)
define(⟦LT⟧, ⟦&amp;lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/markup.m4" title="messages/markup.m4
date: 20201226 22:38:15
sha1sum: 98612ec
size: 256 B">markup.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_markup-m4" title="⚓"></a></code></div>
<h4 id="m4-conversion-file-for-c-json-in" class="m4-bh"><a href="#m4-conversion-file-for-c-json-in" title="⚓"></a><code>⟦⟧</code> Conversion file for C, JSON, INI: <code>&quot;string&quot;</code><a href="#m4--toc" title="Top"></a></h4>
<div id="m4-messages_code-m4" class="m4-src"><pre title="conversion file for a source code"># A → β
define(⟦AMP⟧, ⟦&amp;⟧)
define(⟦AP⟧, ⟦'⟧)
define(⟦BQ⟧, ⟦`⟧)
define(⟦BS⟧, ⟦\\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦\"⟧)
define(⟦EX⟧, ⟦!⟧)
define(⟦GT⟧, ⟦>⟧)
define(⟦LT⟧, ⟦&lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
sha1sum: d709e07
size: 248 B">code.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_code-m4" title="⚓"></a></code></div>
<h4 id="m4-conversion-file-for-bashw-dst" class="m4-bh"><a href="#m4-conversion-file-for-bashw-dst" title="⚓"></a><code>⟦⟧</code> Conversion file for Bash: <code>&quot;string&quot;</code><a href="#m4--toc" title="Top"></a></h4>
<div id="m4-messages_doubleq-m4" class="m4-src"><pre title="conversion file for Bash &quot;strings in quotation marks&quot;"># A → β
define(⟦AMP⟧, ⟦&amp;⟧)
define(⟦AP⟧, ⟦'⟧)
define(⟦BQ⟧, ⟦\`⟧)
define(⟦BS⟧, ⟦\\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦\"⟧)
define(⟦EX⟧, ⟦"\!"⟧)
define(⟦GT⟧, ⟦>⟧)
define(⟦LT⟧, ⟦&lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/doubleq.m4" title="messages/doubleq.m4
date: 20201226 22:38:15
sha1sum: c94b763
size: 252 B">doubleq.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_doubleq-m4" title="⚓"></a></code></div>
<h4 id="m4-conversion-file-for-bashw-ast" class="m4-bh"><a href="#m4-conversion-file-for-bashw-ast" title="⚓"></a><code>⟦⟧</code> Conversion file for Bash: <code>&apos;string&apos;</code><a href="#m4--toc" title="Top"></a></h4>
<div id="m4-messages_apost-m4" class="m4-src"><pre title="conversion file for Bash 'strings in apostrophes'"># A → β
define(⟦AMP⟧, ⟦&amp;⟧)
define(⟦AP⟧, ⟦'\''⟧)
define(⟦BQ⟧, ⟦`⟧)
define(⟦BS⟧, ⟦\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦"⟧)
define(⟦EX⟧, ⟦!⟧)
define(⟦GT⟧, ⟦>⟧)
define(⟦LT⟧, ⟦&lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/apost.m4" title="messages/apost.m4
date: 20201226 22:38:15
sha1sum: e7eec73
size: 249 B">apost.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_apost-m4" title="⚓"></a></code></div>
<h4 id="m4-conversion-file-for-csv-m4-re" class="m4-bh"><a href="#m4-conversion-file-for-csv-m4-re" title="⚓"></a><code>⟦⟧</code> Conversion file for CSV, M4 (returns all characters)<a href="#m4--toc" title="Top"></a></h4>
<div id="m4-messages_unchanged-m4" class="m4-src"><pre title="the conversion file puts all special characters back"># A → β
define(⟦AMP⟧, ⟦&amp;⟧)
define(⟦AP⟧, ⟦'⟧)
define(⟦BQ⟧, ⟦`⟧)
define(⟦BS⟧, ⟦\⟧)
define(⟦DO⟧, ⟦$⟧)
define(⟦DQ⟧, ⟦"⟧)
define(⟦EX⟧, ⟦!⟧)
define(⟦GT⟧, ⟦>⟧)
define(⟦LT⟧, ⟦&lt;⟧)</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/unchanged.m4" title="messages/unchanged.m4
date: 20201226 22:38:15
sha1sum: d2fb4b9
size: 246 B">unchanged.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_unchanged-m4" title="⚓"></a></code></div>
<h3 id="m4-cw-output-queue" class="m4-ch"><a href="#m4-cw-output-queue-toc" title="Content"></a><a href="#m4-cw-output-queue" title="⚓">A.5</a><code>⟦⟧</code> C: output queue<a href="#m4--toc" title="Top"></a></h3>
<p>The example uses one <span class="m4-hgl" data-19="15">output queue</span> for characters <code class="m4-hgl" data-19="16" data-20="9">};</code> to close the <span class="m4-hgl" data-20="6-8" data-19="5">array</span> at the end.</p>
<div id="m4-messages_array-c-m4" class="m4-src"><pre># A → β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
	"$2",
divert(-1)
⟧)

divert(0)dnl
/*
 * DONTE()
 */

char *error[] = {
divert(1)dnl
};
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/array.c.m4" title="messages/array.c.m4
date: 20201226 21:52:28
sha1sum: 8c6c428
size: 151 B">array.c.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_array-c-m4" title="⚓"></a></code></div>
<div id="m4-messages_array-c-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/array.c.m4" title="messages/array.c.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 8c6c428
size: 151 B">array.c.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/array.c" title="messages/array.c
date: 20200331 19:30:06
git rev: 9156810
sha1sum: 9651d22
size: 198 B">array.c</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_array-c-command" title="⚓"></a></code></div>
<div id="m4-messages_array-c" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

char *error[] = {
	"!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~",
	"Too complex M4 code failed successfully.",
	"It's not a language fault!",
};</pre><code><span class="m4-sha">9156810</span><a href="../messages/array.c" title="messages/array.c
date: 20200331 19:30:06
sha1sum: 9651d22
size: 198 B">array.c</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_array-c" title="⚓"></a></code></div>
<h3 id="m4-iniw-an-external-command" class="m4-ch"><a href="#m4-iniw-an-external-command-toc" title="Content"></a><a href="#m4-iniw-an-external-command" title="⚓">A.6</a><code>⟦⟧</code> INI: an external command<a href="#m4--toc" title="Top"></a></h3>
<p>The example runs an external <code class="m4-hgl" data-21="D" data-22="3">date</code> command and places its output in square brackets.
The output of an external command are <span class="m4-hgl" data-21="A">two comma-separated items</span>.
The <code class="m4-hgl" data-21="C">SARG1()</code> macro <span class="m4-hgl" data-21="B">selects the first item</span> because the second item contains an unwanted <code>LF</code> (<samp>0x0a</samp>) new line character.</p>
<div id="m4-messages_hello-ini-m4" class="m4-src"><pre># A → β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
⟦$1⟧="$2"
divert(-1)
⟧)

divert(0)dnl
; DONTE()

<span class="m4-c">SARG1</span>(esyscmd(⟦<span class="m4-d">date '+<span class="m4-b">⟦[hello_%Y%m%d]⟧</span><span class="m4-a">,</span>'</span>⟧))
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/hello.ini.m4" title="messages/hello.ini.m4
date: 20201226 21:52:28
sha1sum: a7f4062
size: 168 B">hello.ini.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_hello-ini-m4" title="⚓"></a></code></div>
<div id="m4-messages_hello-ini-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/hello.ini.m4" title="messages/hello.ini.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: a7f4062
size: 168 B">hello.ini.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/hello.ini" title="messages/hello.ini
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: 80902fe
size: 205 B">hello.ini</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_hello-ini-command" title="⚓"></a></code></div>
<div id="m4-messages_hello-ini" class="m4-src"><pre>; DO NOT EDIT! This file is generated automatically!

[hello_20210122]
COMPLEX="!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"
SUCCESS="Too complex M4 code failed successfully."
NO_FAULT="It's not a language fault!"</pre><code><span class="m4-sha">02f55b8</span><a href="../messages/hello.ini" title="messages/hello.ini
date: 20210118 19:23:51
sha1sum: 80902fe
size: 205 B">hello.ini</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_hello-ini" title="⚓"></a></code></div>
<h3 id="m4-hw-hex-counter" class="m4-ch"><a href="#m4-hw-hex-counter-toc" title="Content"></a><a href="#m4-hw-hex-counter" title="⚓">A.7</a><code>⟦⟧</code> .h: hex counter<a href="#m4--toc" title="Top"></a></h3>
<p>The example uses the <code class="m4-hgl" data-23="A,2">COUNTER</code> macro to number the resulting <abbr title="C preprocessor">CPP</abbr> <span class="m4-hgl" data-23="11" data-24="8-10">macros</span> and one output queue.
The queue number <code class="m4-hgl" data-23="23">1</code> contains the preprocessor directive <code class="m4-hgl" data-23="24" data-24="12">#endif</code> to terminate the header file.
The decimal value of the counter is converted to the <span class="m4-hgl" data-23="B">two-digit hex</span> by keyword <code class="m4-hgl" data-23="C">eval()</code>.</p>
<div id="m4-messages_messages-h-m4" class="m4-src"><pre># A → β
define(⟦<span class="m4-a">COUNTER</span>⟧, defn(⟦COUNT_UP⟧))

# init counter
<span class="m4-a">COUNTER(0)</span>

# A → β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
⟦#define $1    0x⟧<span class="m4-c">eval</span>(<span class="m4-a">COUNTER</span>, <span class="m4-b">16, 2</span>)
divert(-1)
⟧)

divert(0)dnl
/*
 * DONTE()
 */

#ifndef __ERROR_H
#define __ERROR_H

divert(1)
#endif /* __ERROR_H */
divert(-1)</pre><code><span class="m4-sha">825d4a3</span><a href="../messages/messages.h.m4" title="messages/messages.h.m4
date: 20210120 19:01:00
sha1sum: d30ec6e
size: 306 B">messages.h.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-h-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-h-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../messages/messages.h.m4" title="messages/messages.h.m4
date: 20210120 19:01:00
git rev: 825d4a3
sha1sum: d30ec6e
size: 306 B">messages.h.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.h" title="messages/messages.h
date: 20210120 19:01:00
git rev: 825d4a3
sha1sum: 30dbdcf
size: 196 B">messages.h</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-h-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-h" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

#ifndef __ERROR_H
#define __ERROR_H

#define COMPLEX    0x00
#define SUCCESS    0x01
#define NO_FAULT    0x02

#endif /* __ERROR_H */</pre><code><span class="m4-sha">825d4a3</span><a href="../messages/messages.h" title="messages/messages.h
date: 20210120 19:01:00
sha1sum: 30dbdcf
size: 196 B">messages.h</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-h" title="⚓"></a></code></div>
<h3 id="m4-cw-small-automaton" class="m4-ch"><a href="#m4-cw-small-automaton-toc" title="Content"></a><a href="#m4-cw-small-automaton" title="⚓">A.8</a><code>⟦⟧</code> C: small automaton<a href="#m4--toc" title="Top"></a></h3>
<p>The example uses <span class="m4-hgl" data-25="1-4">a&nbsp;small automaton</span> <code class="m4-hgl" data-25="7">NEW_LINE</code> to generate a&nbsp;newline <code class="m4-hgl" data-25="A" data-26="A">\n</code> character and one output queue number <code class="m4-hgl" data-25="22">1</code> containing <code class="m4-hgl" data-25="B">"</code> characters to terminate resulting string.
Run the first time <code class="m4-hgl" data-25="C">NEW_LINE</code>, is rewritten to <abbr title="epsilon – empty symbol"><code class="m4-hgl" data-25="D">ε</code></abbr>, in all following ones, it is rewritten to <code class="m4-hgl" data-25="A" data-26="A">\n</code>.</p>
<div id="m4-messages_stringl-c-m4" class="m4-src"><pre>#     NEW_LINE automaton
#      ___      ____
# --->/ <span class="m4-d">ε</span> \--->/ <span class="m4-a">\n</span> \---.
#     \___/    \____/&lt;--'

# A → β
define(⟦NEW_LINE⟧, ⟦define(⟦$0⟧, ⟦<span class="m4-a">\n</span>⟧)⟧)

# A → β
define(⟦ERROR⟧, ⟦

	divert(0)<span class="m4-c">NEW_LINE</span>⟦⟧$2⟦⟧dnl
divert(-1)
⟧)

divert(0)dnl
/*
 * DONTE()
 */

char error[] =
"divert(1)<span class="m4-b">";</span>
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/stringl.c.m4" title="messages/stringl.c.m4
date: 20201226 21:52:28
sha1sum: daf85ec
size: 329 B">stringl.c.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_stringl-c-m4" title="⚓"></a></code></div>
<div id="m4-messages_stringl-c-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/stringl.c.m4" title="messages/stringl.c.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: daf85ec
size: 329 B">stringl.c.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/stringl.c" title="messages/stringl.c
date: 20200331 19:30:06
git rev: 9156810
sha1sum: dc45b92
size: 185 B">stringl.c</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_stringl-c-command" title="⚓"></a></code></div>
<div id="m4-messages_stringl-c" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

char error[] =
"!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~<span class="m4-a">\n</span>Too complex M4 code failed successfully.<span class="m4-a">\n</span>It's not a language fault!";</pre><code><span class="m4-sha">9156810</span><a href="../messages/stringl.c" title="messages/stringl.c
date: 20200331 19:30:06
sha1sum: dc45b92
size: 185 B">stringl.c</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_stringl-c" title="⚓"></a></code></div>
<h3 id="m4-cw-small-automaton-2" class="m4-ch"><a href="#m4-cw-small-automaton-2-toc" title="Content"></a><a href="#m4-cw-small-automaton-2" title="⚓">A.9</a><code>⟦⟧</code> C: small automaton 2<a href="#m4--toc" title="Top"></a></h3>
<p>This example is similar to the previous one, but each string is on a&nbsp;<span class="m4-hgl" data-27="A" data-28="A">new line</span>.</p>
<div id="m4-messages_string-c-m4" class="m4-src"><pre>#      NEW_LINE automaton
#      ___      _________
# --->/ ε \--->/ \n"\xa" \---.
#     \___/    \_________/&lt;--'

# A → β
define(⟦NEW_LINE⟧, ⟦define(⟦$0⟧, ⟦<span class="m4-a">\n"
"</span>⟧)⟧)

# A → β
define(⟦ERROR⟧, ⟦

	divert(0)NEW_LINE⟦⟧$2⟦⟧dnl
divert(-1)
⟧)

divert(0)dnl
/*
 * DONTE()
 */

char error[] =
"divert(1)";
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/string.c.m4" title="messages/string.c.m4
date: 20201226 21:52:28
sha1sum: 4b4d1b8
size: 348 B">string.c.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_string-c-m4" title="⚓"></a></code></div>
<div id="m4-messages_string-c-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/string.c.m4" title="messages/string.c.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 4b4d1b8
size: 348 B">string.c.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/string.c" title="messages/string.c
date: 20200331 19:30:06
git rev: 9156810
sha1sum: 76ca62e
size: 191 B">string.c</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_string-c-command" title="⚓"></a></code></div>
<div id="m4-messages_string-c" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

char error[] =
"!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~<span class="m4-a">\n"
"</span>Too complex M4 code failed successfully.<span class="m4-a">\n"
"</span>It's not a language fault!";</pre><code><span class="m4-sha">9156810</span><a href="../messages/string.c" title="messages/string.c
date: 20200331 19:30:06
sha1sum: 76ca62e
size: 191 B">string.c</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_string-c" title="⚓"></a></code></div>
<h3 id="m4-htmlw-output-queues" class="m4-ch"><a href="#m4-htmlw-output-queues-toc" title="Content"></a><a href="#m4-htmlw-output-queues" title="⚓">A.10</a><code>⟦⟧</code> HTML: output queues<a href="#m4--toc" title="Top"></a></h3>
<p>The example uses <span class="m4-hgl" data-29="9,27,29">two output queues</span>.
The queue number <code class="m4-hgl" data-29="9,27">1</code> contains <span class="m4-hgl" data-29="10" data-30="16-21">paragraphs</span>.
The queue number <code class="m4-hgl" data-29="29">2</code> contains <span class="m4-hgl" data-29="30-31" data-30="22-23">closing HTML tags</span>.
<span class="m4-hgl" data-29="8" data-30="9-14">Navigation links</span> do not have to be stored anywhere, they <span class="m4-hgl" data-29="7">go straight to the output</span>.
The <code class="m4-hgl" data-29="15">QUERY</code> and <code class="m4-hgl" data-29="16">WARNING</code> messages are processed in the same way as the <code class="m4-hgl" data-29="5-12">ERROR</code> messages.</p>
<div id="m4-messages_messages-html-m4" class="m4-src"><pre># vim:ft=m4

# A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
		⟦&lt;li>$0: &lt;a href="#$1">$1&lt;/a>&lt;/li>⟧
divert(1)dnl
	&lt;p id="⟦$1⟧">$2&lt;/p>
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧, defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
&lt;!-- DONTE() -->
&lt;!doctype html>
&lt;html lang="en">
	&lt;meta charset="utf-8">
	&lt;title>__file__&lt;/title>
&lt;body>
	&lt;h1>The power of M4&lt;/h1>
	&lt;ul>
divert(1)dnl
	&lt;/ul>
divert(2)dnl
&lt;/body>
&lt;/html>
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/messages.html.m4" title="messages/messages.html.m4
date: 20201226 21:52:28
sha1sum: 3911284
size: 468 B">messages.html.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-html-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-html-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/messages.html.m4" title="messages/messages.html.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 3911284
size: 468 B">messages.html.m4</a> <a href="../messages/markup.m4" title="messages/markup.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: 98612ec
size: 256 B">markup.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.html" title="messages/messages.html
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 20b155f
size: 866 B">messages.html</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-html-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-html" class="m4-src"><pre>&lt;!-- DO NOT EDIT! This file is generated automatically! -->
&lt;!doctype html>
&lt;html lang="en">
	&lt;meta charset="utf-8">
	&lt;title>messages.html.m4&lt;/title>
&lt;body>
	&lt;h1>The power of M4&lt;/h1>
	&lt;ul>
		&lt;li>ERROR: &lt;a href="#COMPLEX">COMPLEX&lt;/a>&lt;/li>
		&lt;li>QUERY: &lt;a href="#READABLE">READABLE&lt;/a>&lt;/li>
		&lt;li>ERROR: &lt;a href="#SUCCESS">SUCCESS&lt;/a>&lt;/li>
		&lt;li>WARNING: &lt;a href="#ADDICTIVE">ADDICTIVE&lt;/a>&lt;/li>
		&lt;li>ERROR: &lt;a href="#NO_FAULT">NO_FAULT&lt;/a>&lt;/li>
		&lt;li>WARNING: &lt;a href="#NO_ERRORS">NO_ERRORS&lt;/a>&lt;/li>
	&lt;/ul>
	&lt;p id="COMPLEX">!"#$%&amp;amp;'()*+,-./:;&amp;lt;=&amp;gt;?@[\]^_`{|}~&lt;/p>
	&lt;p id="READABLE">Is badly written M4 code readable [N/y]?&lt;/p>
	&lt;p id="SUCCESS">Too complex M4 code failed successfully.&lt;/p>
	&lt;p id="ADDICTIVE">Programming in M4 is addictive!&lt;/p>
	&lt;p id="NO_FAULT">It's not a language fault!&lt;/p>
	&lt;p id="NO_ERRORS">No other errors were found.&lt;/p>
&lt;/body>
&lt;/html></pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.html" title="messages/messages.html
date: 20210103 13:28:44
sha1sum: 20b155f
size: 866 B">messages.html</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-html" title="⚓"></a></code></div>
<h3 id="m4-branching-by-grammar" class="m4-ch"><a href="#m4-branching-by-grammar-toc" title="Content"></a><a href="#m4-branching-by-grammar" title="⚓">A.11</a><code>⟦⟧</code> Branching by grammar<a href="#m4--toc" title="Top"></a></h3>
<p>The example shows <a href="#m4-branching-by-grammar-basic-pr" title="Branching by grammar – basic principle">branching by grammar</a>, macro arguments are ignored.
Input nonterminals are rewritten to terminals <code title="🐛" class="m4-hgl" data-31="6,13" data-32="A">ERROR → 🐛</code>,
<code title="🐜" class="m4-hgl" data-31="6,14" data-32="B">QUERY → 🐜</code>,
<code title="🐝" class="m4-hgl" data-31="6,15" data-32="C">WARNING → 🐝</code>.</p>
<div id="m4-messages_insect-txt-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
$0_INSECT⟦⟧dnl
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧,   defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))
define(⟦ERROR_INSECT⟧,   ⟦🐛⟧)
define(⟦QUERY_INSECT⟧,   ⟦🐜⟧)
define(⟦WARNING_INSECT⟧, ⟦🐝⟧)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/insect.txt.m4" title="messages/insect.txt.m4
date: 20201226 21:52:28
sha1sum: ce656e5
size: 307 B">insect.txt.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_insect-txt-m4" title="⚓"></a></code></div>
<div id="m4-messages_insect-txt-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/insect.txt.m4" title="messages/insect.txt.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: ce656e5
size: 307 B">insect.txt.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/insect.txt" title="messages/insect.txt
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: a08c5e8
size: 24 B">insect.txt</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_insect-txt-command" title="⚓"></a></code></div>
<div id="m4-messages_insect-txt" class="m4-src"><pre><span class="m4-a">🐛</span><span class="m4-b">🐜</span><span class="m4-a">🐛</span><span class="m4-c">🐝</span><span class="m4-a">🐛</span><span class="m4-c">🐝</span></pre><code><span class="m4-sha">b53eafe</span><a href="../messages/insect.txt" title="messages/insect.txt
date: 20200106 16:21:10
sha1sum: a08c5e8
size: 24 B">insect.txt</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_insect-txt" title="⚓"></a></code></div>
<h4 id="m4-branching-by-grammar-basic-pr" class="m4-bh"><a href="#m4-branching-by-grammar-basic-pr" title="⚓"></a>Branching by grammar – basic principle<a href="#m4--toc" title="Top"></a></h4>
<p>The <code class="m4-hgl" data-33="A">$0</code> variable is replaced by <span class="m4-hgl" data-33="B">the name of the macro</span> and <span class="m4-hgl" data-33="C">concatenated with another symbol</span>.
<span class="m4-hgl" data-33="B,C">The newly formed nonterminal</span> is rewritten to the corresponding <span class="m4-hgl" data-33="D">terminal symbol</span> (queue number or name).</p>
<div id="m4-nonterminals-for-branches" title="grammar branching in M4" class="m4-src"><pre><span class="m4-a">$0</span>_QU → <span class="m4-b">ERROR</span><span class="m4-c">_QU</span> → <span class="m4-d">2</span>
<span class="m4-a">$0</span>_END → <span class="m4-b">ERROR</span><span class="m4-c">_END</span> → <span class="m4-d">3</span>
<span class="m4-a">$0</span>_NAME → <span class="m4-b">ERROR</span><span class="m4-c">_NAME</span> → <span class="m4-d">error</span>
<span class="m4-a">$0</span>_QU → <span class="m4-b">QUERY</span><span class="m4-c">_QU</span> → <span class="m4-d">0</span>
<span class="m4-a">$0</span>_END → <span class="m4-b">QUERY</span><span class="m4-c">_END</span> → <span class="m4-d">1</span>
<span class="m4-a">$0</span>_NAME → <span class="m4-b">QUERY</span><span class="m4-c">_NAME</span> → <span class="m4-d">query</span>
…</pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-nonterminals-for-branches" title="⚓"></a></code></div>
<h3 id="m4-jsonw-generating-automaton" class="m4-ch"><a href="#m4-jsonw-generating-automaton-toc" title="Content"></a><a href="#m4-jsonw-generating-automaton" title="⚓">A.12</a><code>⟦⟧</code> JSON: generating automaton<a href="#m4--toc" title="Top"></a></h3>
<p>The example uses <span class="m4-hgl" data-34="14,30">two output queues</span> and one <span class="m4-hgl" data-34="1-3">generating automaton</span>.
The first <code>ERROR(⟦…⟧)</code> error message in the <code class="m4-hgl" data-34="6-17">ERROR</code> state generates <span class="m4-hgl" data-34="12,15" data-35="3,7">a&nbsp;header with brackets</span> and <span class="m4-hgl" data-34="11">outputs</span> <span class="m4-hgl" data-34="13" data-35="4">the first record</span>.
<span class="m4-hgl" data-34="8,9">The automaton goes</span> to the state <code class="m4-hgl" data-34="20-25">NEXT_ITEM</code> which is a&nbsp;<abbr title="the rule is used as the right side of another rewriting rule"><code class="m4-hgl" data-34="19">β</code> rule</abbr>.
The following error messages in the <code class="m4-hgl" data-34="20-25">NEXT_ITEM</code> state only <span class="m4-hgl" data-34="22">output</span> <span class="m4-hgl" data-34="23" data-35="5,6">individual records</span>.
At the end the output queue number <code class="m4-hgl" data-34="14">1</code> and number <code class="m4-hgl" data-34="30">2</code> print the characters <code class="m4-hgl" data-34="15" data-35="7">]</code> and <code class="m4-hgl" data-34="31" data-35="8">}}</code> to close the resulting JSON.</p>
<div id="m4-messages_atm-json-m4" class="m4-src"><pre>#      _______      ___________
# --->/ ERROR \--->/ NEXT_ITEM \---.
#     \_______/    \___________/&lt;--'

# A → β
define(⟦ERROR⟧, ⟦

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))

	divert(0),
	"error": [
		{"⟦$1⟧": "$2"}dnl
divert(1)
	]
divert(-1)
⟧)

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert(0),
		{"⟦$1⟧": "$2"}dnl
divert(-1)
⟧)

divert(0)dnl
{"generating_automaton": {
	"_comment": "DONTE()"dnl
divert(2)dnl
}}
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/atm.json.m4" title="messages/atm.json.m4
date: 20201226 21:52:28
sha1sum: f09f617
size: 474 B">atm.json.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_atm-json-m4" title="⚓"></a></code></div>
<div id="m4-messages_atm-json-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/atm.json.m4" title="messages/atm.json.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: f09f617
size: 474 B">atm.json.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/atm.json" title="messages/atm.json
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 841e816
size: 269 B">atm.json</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_atm-json-command" title="⚓"></a></code></div>
<div id="m4-messages_atm-json" class="m4-src"><pre>{"generating_automaton": {
	"_comment": "DO NOT EDIT! This file is generated automatically!",
	"error": [
		{"COMPLEX": "!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"},
		{"SUCCESS": "Too complex M4 code failed successfully."},
		{"NO_FAULT": "It's not a language fault!"}
	]
}}</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/atm.json" title="messages/atm.json
date: 20210103 13:28:44
sha1sum: 841e816
size: 269 B">atm.json</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_atm-json" title="⚓"></a></code></div>
<h4 id="m4-jsonw-named-queues" class="m4-ch"><a href="#m4-jsonw-named-queues-toc" title="Content"></a><a href="#m4-jsonw-named-queues" title="⚓">A.12.1</a><code>⟦⟧</code> JSON: named queues<a href="#m4--toc" title="Top"></a></h4>
<p>The example processes other types of messages <code>QUERY</code> and <code>WARNING</code>.
It uses three automata and six output queues.
If we generate more complex source code, we will soon encounter the problem of maintaining index consistency for output queues.
To avoid confusion, we use queue names instead of numbers.
To avoid having to define similar rules, we copy the right side of <code>ERROR</code> (it is also a&nbsp;<abbr title="the rule is used as the right side of another rewriting rule"><code class="m4-hgl" data-36="21">β</code> rule</abbr>) to the right side of the <code>QUERY</code> and <code>WARNING</code> rules.</p>
<div id="m4-messages_qnames-json-m4" class="m4-src"><pre># DO NOT WRITE INDEXES MANUALLY, use counter!
define(⟦QUERY_QU⟧,     0)
define(⟦QUERY_END⟧,    1)
define(⟦ERROR_QU⟧,     2)
define(⟦ERROR_END⟧,    3)
define(⟦WARNING_QU⟧,   4)
define(⟦WARNING_END⟧,  5)
define(⟦LAST_QUEUE⟧,   6)

# names of message types
define(⟦WARNING_NAME⟧, ⟦warning⟧)
define(⟦ERROR_NAME⟧,   ⟦error⟧)
define(⟦QUERY_NAME⟧,   ⟦query⟧)

#      _________      ___________
# --->/  ERROR  \--->/ NEXT_ITEM \---.
#     |  QUERY  |    \___________/&lt;--'
#     \_WARNING_/

# A → β
# β
define(⟦ERROR⟧, ⟦

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))

	divert($0_QU),
	"$0_NAME": [
		{"⟦$1⟧": "$2"}dnl
divert($0_END)
	]dnl
divert(-1)
⟧)

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert($0_QU),
		{"⟦$1⟧": "$2"}dnl
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧,        defn(⟦ERROR⟧))
define(⟦WARNING⟧,      defn(⟦ERROR⟧))

divert(0)dnl
{"queue_names": {
	"_comment": "DONTE()"dnl
divert(LAST_QUEUE)
}}
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/qnames.json.m4" title="messages/qnames.json.m4
date: 20201226 21:52:28
sha1sum: 1e3b868
size: 1027 B">qnames.json.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_qnames-json-m4" title="⚓"></a></code></div>
<div id="m4-messages_qnames-json-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/qnames.json.m4" title="messages/qnames.json.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 1e3b868
size: 1027 B">qnames.json.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/qnames.json" title="messages/qnames.json
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 3c39e26
size: 452 B">qnames.json</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_qnames-json-command" title="⚓"></a></code></div>
<div id="m4-messages_qnames-json" class="m4-src"><pre>{"queue_names": {
	"_comment": "DO NOT EDIT! This file is generated automatically!",
	"query": [
		{"READABLE": "Is badly written M4 code readable [N/y]?"}
	],
	"error": [
		{"COMPLEX": "!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"},
		{"SUCCESS": "Too complex M4 code failed successfully."},
		{"NO_FAULT": "It's not a language fault!"}
	],
	"warning": [
		{"ADDICTIVE": "Programming in M4 is addictive!"},
		{"NO_ERRORS": "No other errors were found."}
	]
}}</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/qnames.json" title="messages/qnames.json
date: 20210103 13:28:44
sha1sum: 3c39e26
size: 452 B">qnames.json</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_qnames-json" title="⚓"></a></code></div>
<h4 id="m4-jsonw-generated-queue-indexes" class="m4-ch"><a href="#m4-jsonw-generated-queue-indexes-toc" title="Content"></a><a href="#m4-jsonw-generated-queue-indexes" title="⚓">A.12.2</a><code>⟦⟧</code> JSON: generated queue indexes<a href="#m4--toc" title="Top"></a></h4>
<p>During development, the order and number of output queues often change, which also requires frequent changes of their indexes.
<span class="m4-hgl" data-38="A">It is therefore appropriate to generate indexes</span>.
We can then use a&nbsp;virtually unlimited number of queues.
The following example shows how these indexes are generated.</p>
<div id="m4-messages_queues-m4" class="m4-src"><pre># defines a counter for output queues
# A → β
define(⟦QUEUE_INDEX⟧, defn(⟦COUNT_UP⟧))

# index of the first output queue (0 is stdout)
QUEUE_INDEX(0)

# symbolic names for indices of output queues
# A → β
define(⟦QUERY_QU⟧,     <span class="m4-a">QUEUE_INDEX</span>)
define(⟦QUERY_END⟧,    <span class="m4-a">QUEUE_INDEX</span>)
define(⟦ERROR_QU⟧,     <span class="m4-a">QUEUE_INDEX</span>)
define(⟦ERROR_END⟧,    <span class="m4-a">QUEUE_INDEX</span>)
define(⟦WARNING_QU⟧,   <span class="m4-a">QUEUE_INDEX</span>)
define(⟦WARNING_END⟧,  <span class="m4-a">QUEUE_INDEX</span>)
# Keep it last!
define(⟦LAST_QUEUE⟧,   <span class="m4-a">QUEUE_INDEX</span>)

# names of message types
# A → β
define(⟦WARNING_NAME⟧, ⟦warning⟧)
define(⟦ERROR_NAME⟧,   ⟦error⟧)
define(⟦QUERY_NAME⟧,   ⟦query⟧)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
sha1sum: 79f498c
size: 674 B">queues.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_queues-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-json-m4" class="m4-src"><pre>#      _________      ___________
# --->/  ERROR  \--->/ NEXT_ITEM \---.
#     |  QUERY  |    \___________/&lt;--'
#     \_WARNING_/

# A → β
# β
define(⟦ERROR⟧, ⟦

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))

	divert($0_QU),
	"$0_NAME": [
		{"⟦$1⟧": "$2"}dnl
divert($0_END)
	]dnl
divert(-1)
⟧)

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert($0_QU),
		{"⟦$1⟧": "$2"}dnl
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧,   defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
{"messages": {
	"_comment": "DONTE()"dnl
divert(LAST_QUEUE)
}}
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/messages.json.m4" title="messages/messages.json.m4
date: 20201226 21:52:28
sha1sum: f74c194
size: 609 B">messages.json.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-json-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-json-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 79f498c
size: 674 B">queues.m4</a> <a href="../messages/messages.json.m4" title="messages/messages.json.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: f74c194
size: 609 B">messages.json.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.json" title="messages/messages.json
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: cc6ff19
size: 449 B">messages.json</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-json-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-json" class="m4-src"><pre>{"messages": {
	"_comment": "DO NOT EDIT! This file is generated automatically!",
	"query": [
		{"READABLE": "Is badly written M4 code readable [N/y]?"}
	],
	"error": [
		{"COMPLEX": "!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"},
		{"SUCCESS": "Too complex M4 code failed successfully."},
		{"NO_FAULT": "It's not a language fault!"}
	],
	"warning": [
		{"ADDICTIVE": "Programming in M4 is addictive!"},
		{"NO_ERRORS": "No other errors were found."}
	]
}}</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.json" title="messages/messages.json
date: 20210103 13:28:44
sha1sum: cc6ff19
size: 449 B">messages.json</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-json" title="⚓"></a></code></div>
<h3 id="m4-iniw-discontinuous-queue-inde" class="m4-ch"><a href="#m4-iniw-discontinuous-queue-inde-toc" title="Content"></a><a href="#m4-iniw-discontinuous-queue-inde" title="⚓">A.13</a><code>⟦⟧</code> INI: discontinuous queue index<a href="#m4--toc" title="Top"></a></h3>
<p>The example uses <span class="m4-hgl" data-41="1-4">three automata</span> and two output queues number <code class="m4-hgl" data-41="10,26">2</code> and <code class="m4-hgl" data-41="10,26">4</code> defined in a&nbsp;separate file.
<span class="m4-hgl" data-41="11" data-42="3,6,11">INI section names</span> are generated by <span class="m4-hgl" data-41="A,R">symbol chaining</span> (see <a href="#m4-branching-by-grammar-basic-pr" title="Branching by grammar – basic principle">branching</a>).
The example uses the same file for output queues as the <a href="#m4-jsonw-generated-queue-indexes" title="⟦⟧ JSON: generated queue indexes">example</a> to generate JSON.</p>
<div id="m4-messages_messages-ini-m4" class="m4-src"><pre>#      _________      ___________
# --->/  ERROR  \--->/ NEXT_ITEM \---.
#     |  QUERY  |    \___________/&lt;--'
#     \_WARNING_/

# A → β
# β
define(⟦ERROR⟧, ⟦

	divert($0_QU)
[<span class="m4-r">$0</span><span class="m4-a">_NAME</span>]
⟦$1⟧="$2"
divert(-1)

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))
⟧)

# A → β
define(⟦QUERY⟧,   defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert($0_QU)dnl
⟦$1⟧="$2"
divert(-1)
⟧)

divert(0)dnl
; DONTE()
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/messages.ini.m4" title="messages/messages.ini.m4
date: 20201226 21:52:28
sha1sum: fb8782f
size: 512 B">messages.ini.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-ini-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-ini-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/messages.ini.m4" title="messages/messages.ini.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: fb8782f
size: 512 B">messages.ini.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 79f498c
size: 674 B">queues.m4</a> <a href="../messages/code.m4" title="messages/code.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: d709e07
size: 248 B">code.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.ini" title="messages/messages.ini
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: cf65110
size: 352 B">messages.ini</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-ini-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-ini" class="m4-src"><pre>; DO NOT EDIT! This file is generated automatically!

[query]
READABLE="Is badly written M4 code readable [N/y]?"

[error]
COMPLEX="!\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_`{|}~"
SUCCESS="Too complex M4 code failed successfully."
NO_FAULT="It's not a language fault!"

[warning]
ADDICTIVE="Programming in M4 is addictive!"
NO_ERRORS="No other errors were found."</pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.ini" title="messages/messages.ini
date: 20210103 13:28:44
sha1sum: cf65110
size: 352 B">messages.ini</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-ini" title="⚓"></a></code></div>
<h3 id="m4-xmlw-mixed-messages" class="m4-ch"><a href="#m4-xmlw-mixed-messages-toc" title="Content"></a><a href="#m4-xmlw-mixed-messages" title="⚓">A.14</a><code>⟦⟧</code> XML: mixed messages<a href="#m4--toc" title="Top"></a></h3>
<p>The example uses one output queue number <code class="m4-hgl" data-43="21">1</code> for the <code class="m4-hgl" data-43="22" data-44="28">&lt;/messages&gt;</code> closing tag.</p>
<div id="m4-messages_mixed-xml-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
	&lt;$0_NAME>
		&lt;name>⟦$1⟧&lt;/name>
		&lt;value>$2&lt;/value>
	&lt;/$0_NAME>
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧, defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
&lt;!-- DONTE() -->
&lt;?xml version="1.0" encoding="utf-8"?>
&lt;messages>
divert(1)dnl
&lt;/messages>
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/mixed.xml.m4" title="messages/mixed.xml.m4
date: 20201226 21:52:28
sha1sum: d43ef91
size: 347 B">mixed.xml.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_mixed-xml-m4" title="⚓"></a></code></div>
<div id="m4-messages_mixed-xml-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 79f498c
size: 674 B">queues.m4</a> <a href="../messages/mixed.xml.m4" title="messages/mixed.xml.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: d43ef91
size: 347 B">mixed.xml.m4</a> <a href="../messages/markup.m4" title="messages/markup.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: 98612ec
size: 256 B">markup.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/mixed.xml" title="messages/mixed.xml
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: b907138
size: 702 B">mixed.xml</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_mixed-xml-command" title="⚓"></a></code></div>
<div id="m4-messages_mixed-xml" class="m4-src"><pre>&lt;!-- DO NOT EDIT! This file is generated automatically! -->
&lt;?xml version="1.0" encoding="utf-8"?>
&lt;messages>
	&lt;error>
		&lt;name>COMPLEX&lt;/name>
		&lt;value>!"#$%&amp;amp;'()*+,-./:;&amp;lt;=&amp;gt;?@[\]^_`{|}~&lt;/value>
	&lt;/error>
	&lt;query>
		&lt;name>READABLE&lt;/name>
		&lt;value>Is badly written M4 code readable [N/y]?&lt;/value>
	&lt;/query>
	&lt;error>
		&lt;name>SUCCESS&lt;/name>
		&lt;value>Too complex M4 code failed successfully.&lt;/value>
	&lt;/error>
	&lt;warning>
		&lt;name>ADDICTIVE&lt;/name>
		&lt;value>Programming in M4 is addictive!&lt;/value>
	&lt;/warning>
	&lt;error>
		&lt;name>NO_FAULT&lt;/name>
		&lt;value>It's not a language fault!&lt;/value>
	&lt;/error>
	&lt;warning>
		&lt;name>NO_ERRORS&lt;/name>
		&lt;value>No other errors were found.&lt;/value>
	&lt;/warning>
&lt;/messages></pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/mixed.xml" title="messages/mixed.xml
date: 20210103 13:28:44
sha1sum: b907138
size: 702 B">mixed.xml</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_mixed-xml" title="⚓"></a></code></div>
<h3 id="m4-xmlw-separated-messages" class="m4-ch"><a href="#m4-xmlw-separated-messages-toc" title="Content"></a><a href="#m4-xmlw-separated-messages" title="⚓">A.15</a><code>⟦⟧</code> XML: separated messages<a href="#m4--toc" title="Top"></a></h3>
<p>The example groups messages by their type using output queues.</p>
<div id="m4-messages_messages-xml-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	# transition to the next node
	define(⟦$0⟧, defn(⟦NEXT_ITEM⟧))

	divert($0_QU)dnl
	&lt;$0_NAME>
		&lt;item>
			&lt;name>⟦$1⟧&lt;/name>
			&lt;value>$2&lt;/value>
		&lt;/item>
divert($0_END)dnl
	&lt;/$0_NAME>
divert(-1)
⟧)

# β
define(⟦NEXT_ITEM⟧, ⟦

	divert($0_QU)dnl
		&lt;item>
			&lt;name>⟦$1⟧&lt;/name>
			&lt;value>$2&lt;/value>
		&lt;/item>
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧,        defn(⟦ERROR⟧))
define(⟦WARNING⟧,      defn(⟦ERROR⟧))

divert(0)dnl
&lt;!-- DONTE() -->
&lt;?xml version="1.0" encoding="utf-8"?>
&lt;messages>
divert(LAST_QUEUE)dnl
&lt;/messages>
divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/messages.xml.m4" title="messages/messages.xml.m4
date: 20201226 21:52:28
sha1sum: bea84ce
size: 618 B">messages.xml.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-xml-m4" title="⚓"></a></code></div>
<div id="m4-messages_messages-xml-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/queues.m4" title="messages/queues.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 79f498c
size: 674 B">queues.m4</a> <a href="../messages/messages.xml.m4" title="messages/messages.xml.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: bea84ce
size: 618 B">messages.xml.m4</a> <a href="../messages/markup.m4" title="messages/markup.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: 98612ec
size: 256 B">markup.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/messages.xml" title="messages/messages.xml
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: 038f4ab
size: 767 B">messages.xml</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-xml-command" title="⚓"></a></code></div>
<div id="m4-messages_messages-xml" class="m4-src"><pre>&lt;!-- DO NOT EDIT! This file is generated automatically! -->
&lt;?xml version="1.0" encoding="utf-8"?>
&lt;messages>
	&lt;query>
		&lt;item>
			&lt;name>READABLE&lt;/name>
			&lt;value>Is badly written M4 code readable [N/y]?&lt;/value>
		&lt;/item>
	&lt;/query>
	&lt;error>
		&lt;item>
			&lt;name>COMPLEX&lt;/name>
			&lt;value>!"#$%&amp;amp;'()*+,-./:;&amp;lt;=&amp;gt;?@[\]^_`{|}~&lt;/value>
		&lt;/item>
		&lt;item>
			&lt;name>SUCCESS&lt;/name>
			&lt;value>Too complex M4 code failed successfully.&lt;/value>
		&lt;/item>
		&lt;item>
			&lt;name>NO_FAULT&lt;/name>
			&lt;value>It's not a language fault!&lt;/value>
		&lt;/item>
	&lt;/error>
	&lt;warning>
		&lt;item>
			&lt;name>ADDICTIVE&lt;/name>
			&lt;value>Programming in M4 is addictive!&lt;/value>
		&lt;/item>
		&lt;item>
			&lt;name>NO_ERRORS&lt;/name>
			&lt;value>No other errors were found.&lt;/value>
		&lt;/item>
	&lt;/warning>
&lt;/messages></pre><code><span class="m4-sha">55ac1ea</span><a href="../messages/messages.xml" title="messages/messages.xml
date: 20210103 13:28:44
sha1sum: 038f4ab
size: 767 B">messages.xml</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_messages-xml" title="⚓"></a></code></div>
<h3 id="m4-bash-echo-dstringd" class="m4-ch"><a href="#m4-bash-echo-dstringd-toc" title="Content"></a><a href="#m4-bash-echo-dstringd" title="⚓">A.16</a><code>⟦⟧</code> Bash <code>$ echo &quot;string&quot;</code><a href="#m4--toc" title="Top"></a></h3>
<div id="m4-messages_doubleq-sh-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
echo "$2"
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧, defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
#!/bin/bash
#
⟦#⟧ DONTE()

divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/doubleq.sh.m4" title="messages/doubleq.sh.m4
date: 20201226 21:52:28
sha1sum: 8de61d2
size: 229 B">doubleq.sh.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_doubleq-sh-m4" title="⚓"></a></code></div>
<div id="m4-messages_doubleq-sh-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/doubleq.sh.m4" title="messages/doubleq.sh.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 8de61d2
size: 229 B">doubleq.sh.m4</a> <a href="../messages/doubleq.m4" title="messages/doubleq.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: c94b763
size: 252 B">doubleq.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/doubleq.sh" title="messages/doubleq.sh
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: 747c4db
size: 324 B">doubleq.sh</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_doubleq-sh-command" title="⚓"></a></code></div>
<div id="m4-messages_doubleq-sh" class="m4-src"><pre>#!/bin/bash
#
# DO NOT EDIT! This file is generated automatically!

echo ""\!"\"#$%&amp;'()*+,-./:;&lt;=>?@[\\]^_\`{|}~"
echo "Is badly written M4 code readable [N/y]?"
echo "Too complex M4 code failed successfully."
echo "Programming in M4 is addictive"\!""
echo "It's not a language fault"\!""
echo "No other errors were found."</pre><code><span class="m4-sha">d2707ad</span><a href="../messages/doubleq.sh" title="messages/doubleq.sh
date: 20201226 22:38:15
sha1sum: 747c4db
size: 324 B">doubleq.sh</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_doubleq-sh" title="⚓"></a></code></div>
<h3 id="m4-bash-echo-astringa" class="m4-ch"><a href="#m4-bash-echo-astringa-toc" title="Content"></a><a href="#m4-bash-echo-astringa" title="⚓">A.17</a><code>⟦⟧</code> Bash <code>$ echo 'string'</code><a href="#m4--toc" title="Top"></a></h3>
<div id="m4-messages_apost-sh-m4" class="m4-src"><pre># A → β
# β
define(⟦ERROR⟧, ⟦

	divert(0)dnl
echo '$2'
divert(-1)
⟧)

# A → β
define(⟦QUERY⟧, defn(⟦ERROR⟧))
define(⟦WARNING⟧, defn(⟦ERROR⟧))

divert(0)dnl
#!/bin/bash
#
⟦#⟧ DONTE()

divert(-1)</pre><code><span class="m4-sha">24fd4f3</span><a href="../messages/apost.sh.m4" title="messages/apost.sh.m4
date: 20201226 21:52:28
sha1sum: 6c78a02
size: 229 B">apost.sh.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_apost-sh-m4" title="⚓"></a></code></div>
<div id="m4-messages_apost-sh-command" class="m4-cmd m4-usc"><pre title="command">m4 <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../messages/apost.sh.m4" title="messages/apost.sh.m4
date: 20201226 21:52:28
git rev: 24fd4f3
sha1sum: 6c78a02
size: 229 B">apost.sh.m4</a> <a href="../messages/apost.m4" title="messages/apost.m4
date: 20201226 22:38:15
git rev: d2707ad
sha1sum: e7eec73
size: 249 B">apost.m4</a> <a href="../messages/messages.mc" title="messages/messages.mc
date: 20210103 13:28:44
git rev: 55ac1ea
sha1sum: c6496e4
size: 535 B">messages.mc</a> > <a href="../messages/apost.sh" title="messages/apost.sh
date: 20201225 10:46:17
git rev: 5964776
sha1sum: 854fc6e
size: 318 B">apost.sh</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-messages_apost-sh-command" title="⚓"></a></code></div>
<div id="m4-messages_apost-sh" class="m4-src"><pre>#!/bin/bash
#
# DO NOT EDIT! This file is generated automatically!

echo '!"#$%&amp;'\''()*+,-./:;&lt;=>?@[\]^_`{|}~'
echo 'Is badly written M4 code readable [N/y]?'
echo 'Too complex M4 code failed successfully.'
echo 'Programming in M4 is addictive!'
echo 'It'\''s not a language fault!'
echo 'No other errors were found.'</pre><code><span class="m4-sha">5964776</span><a href="../messages/apost.sh" title="messages/apost.sh
date: 20201225 10:46:17
sha1sum: 854fc6e
size: 318 B">apost.sh</a><span class="m4-cb" title="select the text"></span><a href="#m4-messages_apost-sh" title="⚓"></a></code></div>
<h2 id="m4-preprocessor-examples" class="m4-ch"><a href="#m4-preprocessor-examples-toc" title="Content"></a><a href="#m4-preprocessor-examples" title="⚓">B</a>Preprocessor examples<a href="#m4--toc" title="Top"></a></h2>
<div title="for information" class="rs-tip-major m4-info">Chars. {<code title="quotation marks" class="m4-xp">`'</code>, <code title="square brackets" class="m4-xp">[]</code>, <code title="nonprintable characters" class="m4-xp">␂␆</code>, <code title="UTF-8 characters" class="m4-xp">⟦⟧</code>} in the name controls the <a href="../generating-code-in-m4-introduction/preview.html#m4-nonterminal-expansion-control" title="Nonterminal expansion control">expansion of nonterminals</a>.</div>
<p id="m4-ba-c-preprocessor-and-m4-toc" class="m4-l2"><a href="#m4-ba-c-preprocessor-and-m4"><b>B.1</b><code>`'</code> C&nbsp;preprocessor and M4</a></p>
<p id="m4-ba-cssw-file-inclusion-commen-toc" class="m4-l2"><a href="#m4-ba-cssw-file-inclusion-commen"><b>B.2</b><code>`'</code> CSS: file inclusion, comment</a></p>
<p id="m4-bashw-nonprintable-characters-toc" class="m4-l2"><a href="#m4-bashw-nonprintable-characters"><b>B.3</b><b><code>␂␆</code></b> Bash: nonprintable characters</a></p>
<h3 id="m4-ba-c-preprocessor-and-m4" class="m4-ch"><a href="#m4-ba-c-preprocessor-and-m4-toc" title="Content"></a><a href="#m4-ba-c-preprocessor-and-m4" title="⚓">B.1</a><code>`'</code> C&nbsp;preprocessor and M4<a href="#m4--toc" title="Top"></a></h3>
<p>The <a href="https://en.wikipedia.org/wiki/C_preprocessor" title="C preprocessor">CPP</a> directives are a&nbsp;one-line comment for M4 preventing unwanted expansion of the same named macros.
If we define a&nbsp;safer <code class="m4-hgl" data-51="5" data-52="12">SAF()</code> macro, the similar <code class="m4-hgl" data-52="8,11">SAF ()</code> macro will not be overwritten.
Thus, the <abbr title="C preprocessor">CPP</abbr> namespace <b>can be</b> completely separated from the M4 namespace.
The problematic (backquote) character <code>`</code> is hidden in the <code class="m4-hgl" data-52="24">LL()</code> macro.
The apostrophe <code class="m4-hgl" data-52="A" data-53="A">'</code> does not matter in the source code.
Apostrophe inside <code class="m4-hgl" data-51="4" data-52="B">ORD<s style="color:red"><span style="color:rgba(0,0,0,.75)">()</span></s></code> macro is hidden in <code class="m4-hgl" data-51="A">RR()</code> macro.
Note the <code class="m4-hgl" data-52="17,27" data-53="17,27">define ()</code> or <code class="m4-hgl" data-52="18,28" data-53="18,28">ifelse ()</code> function names and where the <code class="m4-hgl" data-52="C" data-53="C" data-51="C">SYMBOL</code> is expanded.</p>
<div id="m4-preproc_file-c-m4" class="m4-src"><pre># ORDinary and SAFe macros have different expansion:

# A → β
define(`ORD', `$0_M4 <span class="m4-a">RR()</span><span class="m4-c">SYMBOL</span>`'<span class="m4-a">RR()</span>')
define(`SAF', `ifelse(`$#', `0', ``$0'', `($1) * ($1)	/* $0_M4 <span class="m4-c">SYMBOL</span> */')')

divert(0)dnl</pre><code><span class="m4-sha">cf9fdc8</span><a href="../preproc/file.c.m4" title="preproc/file.c.m4
date: 20210110 15:33:50
sha1sum: 7e01510
size: 196 B">file.c.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_file-c-m4" title="⚓"></a></code></div>
<div id="m4-preproc_file-c" class="m4-src"><pre>/*
 * DONTE()
 */

#include &lt;stdio.h>	/* CPP <span class="m4-c">SYMBOL</span> */

#define <span class="m4-c">SYMBOL</span>		/* CPP <span class="m4-c">SYMBOL</span> */
#define SAF(x)		((x) * ((x) - 1))	/* CPP <span class="m4-c">SYMBOL</span> */
#define ORD(x)		CPP <span class="m4-c">SYMBOL</span> x

int a = SAF (1 + 1);	/* CPP */
int b = SAF(2 + 2);	/* M4 */
char chr = <span class="m4-a">'</span>x<span class="m4-a">'</span>;
char foo[] = "Let<span class="m4-a">'</span>s say: <span class="m4-a">'</span><span class="m4-c">SYMBOL</span><span class="m4-a">'</span>";
char bar[] = "<span class="m4-b">ORD</span> (args, are, ignored)";

static void define (char *s) { puts(s);}
static void ifelse (char *s) { puts(s);}

int main(void)
{

#ifdef <span class="m4-c">SYMBOL</span>			/* <span class="m4-c">SYMBOL</span> */
	puts("LL()<span class="m4-c">SYMBOL</span><span class="m4-a">'</span>");	/* note: `LL()<span class="m4-c">SYMBOL</span><span class="m4-a">'</span> */
#endif

	define (foo);		/* <span class="m4-c">SYMBOL</span> */
	ifelse (bar);		/* <span class="m4-c">SYMBOL</span>() */

	return 0;
}</pre><code><span class="m4-sha">cf9fdc8</span><a href="../preproc/file.c" title="preproc/file.c
date: 20210110 15:33:50
sha1sum: 1fe5bfc
size: 583 B">file.c</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_file-c" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-c-command" class="m4-cmd m4-usc"><pre title="command">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0q.m4" title="gfiles/root0q.m4
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: 87286b9
size: 1158 B">root0q.m4</a> <a href="../preproc/file.c.m4" title="preproc/file.c.m4
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: 7e01510
size: 196 B">file.c.m4</a> <a href="../preproc/file.c" title="preproc/file.c
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: 1fe5bfc
size: 583 B">file.c</a> > <a href="../preproc/preproc.file.c" title="preproc/preproc.file.c
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: 041f49a
size: 700 B">preproc.file.c</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_preproc-file-c-command" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-c" class="m4-src"><pre>/*
 * DO NOT EDIT! This file is generated automatically!
 */

#include &lt;stdio.h>	/* CPP <span class="m4-c">SYMBOL</span> */

#define <span class="m4-c">SYMBOL</span>		/* CPP <span class="m4-c">SYMBOL</span> */
#define SAF(x)		((x) * ((x) - 1))	/* CPP <span class="m4-c">SYMBOL</span> */
#define ORD(x)		CPP <span class="m4-c">SYMBOL</span> x

int a = SAF (1 + 1);	/* CPP */
int b = (2 + 2) * (2 + 2)	/* SAF_M4 Hello, world! */;	/* M4 */
char chr = <span class="m4-a">'</span>x<span class="m4-a">'</span>;
char foo[] = "Let<span class="m4-a">'</span>s say: <span class="m4-a">'</span>Hello, world!<span class="m4-a">'</span>";
char bar[] = "ORD_M4 <span class="m4-a">'</span>Hello, world!<span class="m4-a">'</span> (args, are, ignored)";

static void define (char *s) { puts(s);}
static void ifelse (char *s) { puts(s);}

int main(void)
{

#ifdef <span class="m4-c">SYMBOL</span>			/* <span class="m4-c">SYMBOL</span> */
	puts("`Hello, world!<span class="m4-a">'</span>");	/* note: LL()<span class="m4-c">SYMBOL</span> */
#endif

	define (foo);		/* Hello, world! */
	ifelse (bar);		/* Hello, world! */

	return 0;
}</pre><code><span class="m4-sha">cf9fdc8</span><a href="../preproc/preproc.file.c" title="preproc/preproc.file.c
date: 20210110 15:33:50
sha1sum: 041f49a
size: 700 B">preproc.file.c</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_preproc-file-c" title="⚓"></a></code></div>
<h3 id="m4-ba-cssw-file-inclusion-commen" class="m4-ch"><a href="#m4-ba-cssw-file-inclusion-commen-toc" title="Content"></a><a href="#m4-ba-cssw-file-inclusion-commen" title="⚓">B.2</a><code>`'</code> CSS: file inclusion, comment<a href="#m4--toc" title="Top"></a></h3>
<p>CSS uses the <code class="m4-hgl" data-55="A" data-57="A">#</code> character for color codes, which is also the beginning of a&nbsp;one-line M4 comment.
The <code class="m4-hgl" data-56="A">changecom(/*,*/)</code> keyword sets a&nbsp;multiline <code class="m4-hgl" data-57="B" data-56="C">/* … */</code> comment and rewrites itself into <abbr title="epsilon – empty symbol"><code>ε</code></abbr>.
The comments can be turned off with the same <code class="m4-hgl" data-56="B">changecom</code> keyword without parameters.</p>
<div id="m4-preproc_foo-css" class="m4-src"><pre title="file embedded by the macro processor">.foo {
	border: WIDTH 2px 1px;
}</pre><code><span class="m4-sha">9e13656</span><a href="../preproc/foo.css" title="preproc/foo.css
date: 20200211 02:32:35
sha1sum: 70f2196
size: 33 B">foo.css</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_foo-css" title="⚓"></a></code></div>
<div id="m4-preproc_file-css-m4" class="m4-src"><pre># CSS preprocessor

define(`WIDTH', `3px')
define(`TOP', `<span class="m4-a">#</span>f00')
define(`SIDES', `<span class="m4-a">#</span>0f0')
define(`BOTTOM', `<span class="m4-a">#</span>00f')
define(`SITE', `www.root.cz')
define(`IMAGE', `m4tux.png')
define(`PATH', `https://SITE/IMAGE')

divert(0)dnl</pre><code><span class="m4-sha">9e13656</span><a href="../preproc/file.css.m4" title="preproc/file.css.m4
date: 20200211 02:32:35
sha1sum: df580d7
size: 224 B">file.css.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_file-css-m4" title="⚓"></a></code></div>
<div id="m4-preproc_file-css" class="m4-src"><pre>/* DONTE() */<span class="m4-a">changecom(/*,*/)</span>
<span class="m4-c">/* DONTE() */</span>

include(`foo.css')dnl

.bar {
	border-width: WIDTH;
	border-color: TOP SIDES BOTTOM;
	background-image: url('PATH');
}

<span class="m4-c">/* DONTE() */</span>
<span class="m4-b">changecom</span>/* DONTE() */<span class="m4-a">changecom(/*,*/)</span></pre><code><span class="m4-sha">3ed8f6a</span><a href="../preproc/file.css" title="preproc/file.css
date: 20200505 00:05:58
sha1sum: 380eb22
size: 218 B">file.css</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_file-css" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-css-command" class="m4-cmd m4-usc"><pre title="command">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0q.m4" title="gfiles/root0q.m4
date: 20210110 15:33:50
git rev: cf9fdc8
sha1sum: 87286b9
size: 1158 B">root0q.m4</a> <a href="../preproc/file.css.m4" title="preproc/file.css.m4
date: 20200211 02:32:35
git rev: 9e13656
sha1sum: df580d7
size: 224 B">file.css.m4</a> <a href="../preproc/file.css" title="preproc/file.css
date: 20200505 00:05:58
git rev: 3ed8f6a
sha1sum: 380eb22
size: 218 B">file.css</a> > <a href="../preproc/preproc.file.css" title="preproc/preproc.file.css
date: 20200509 00:48:05
git rev: 41542d1
sha1sum: 65fa35b
size: 293 B">preproc.file.css</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_preproc-file-css-command" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-css" class="m4-src"><pre>/* DO NOT EDIT! This file is generated automatically! */
<span class="m4-b">/* DONTE() */</span>

.foo {
	border: 3px 2px 1px;
}

.bar {
	border-width: 3px;
	border-color: <span class="m4-a">#</span>f00 <span class="m4-a">#</span>0f0 <span class="m4-a">#</span>00f;
	background-image: url('https://www.root.cz/m4tux.png');
}

<span class="m4-b">/* DONTE() */</span>
/* DO NOT EDIT! This file is generated automatically! */</pre><code><span class="m4-sha">41542d1</span><a href="../preproc/preproc.file.css" title="preproc/preproc.file.css
date: 20200509 00:48:05
sha1sum: 65fa35b
size: 293 B">preproc.file.css</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_preproc-file-css" title="⚓"></a></code></div>
<h3 id="m4-bashw-nonprintable-characters" class="m4-ch"><a href="#m4-bashw-nonprintable-characters-toc" title="Content"></a><a href="#m4-bashw-nonprintable-characters" title="⚓">B.3</a><b><code>␂␆</code></b> Bash: nonprintable characters<a href="#m4--toc" title="Top"></a></h3>
<p>Bash uses both <code>`</code> and <code>[</code> characters.
If we do not want to hide them in an <code>LL()</code> macro, we can use <span title="displayed as UTF-8 characters" class="m4-hgl" data-58="A" data-59="A">nonprintable characters</span> for <a href="#m4-nonterminal-expansion-control" title="Nonterminal expansion control">expansion control</a>, see the example:</p>
<div id="m4-preproc_file-sh-m4" class="m4-src"><pre># vim:mps+=<span class="m4-a">␂</span>\:<span class="m4-a">␆</span>

# A → β
define(<span class="m4-a">␂</span>LEFT<span class="m4-a">␆</span>, <span class="m4-a">␂</span>$<span class="m4-a">␂</span>#<span class="m4-a">␆</span><span class="m4-a">␆</span>)
define(<span class="m4-a">␂</span>OP<span class="m4-a">␆</span>, <span class="m4-a">␂</span>-eq<span class="m4-a">␆</span>)
define(<span class="m4-a">␂</span>RIGHT<span class="m4-a">␆</span>, <span class="m4-a">␂</span>0<span class="m4-a">␆</span>)

divert(0)dnl</pre><code><span class="m4-sha">b53eafe</span><a href="../preproc/file.sh.m4" title="preproc/file.sh.m4
date: 20200106 16:21:10
sha1sum: f1c81b2
size: 106 B">file.sh.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_file-sh-m4" title="⚓"></a></code></div>
<div id="m4-preproc_file-sh" class="m4-src"><pre>#!/bin/bash
#
<span class="m4-a">␂</span>#<span class="m4-a">␆</span> DONTE()

HELLO=`echo 'SYMBOL'`

if [[ LEFT OP RIGHT ]]
then
	echo $HELLO
fi</pre><code><span class="m4-sha">b53eafe</span><a href="../preproc/file.sh" title="preproc/file.sh
date: 20200106 16:21:10
sha1sum: fe8d3e3
size: 94 B">file.sh</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_file-sh" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-sh-command" class="m4-cmd m4-usc"><pre title="command">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0n.m4" title="gfiles/root0n.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: 566dd35
size: 1172 B">root0n.m4</a> <a href="../preproc/file.sh.m4" title="preproc/file.sh.m4
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: f1c81b2
size: 106 B">file.sh.m4</a> <a href="../preproc/file.sh" title="preproc/file.sh
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: fe8d3e3
size: 94 B">file.sh</a> > <a href="../preproc/preproc.file.sh" title="preproc/preproc.file.sh
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: 504d5cd
size: 137 B">preproc.file.sh</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_preproc-file-sh-command" title="⚓"></a></code></div>
<div id="m4-preproc_preproc-file-sh" class="m4-src"><pre>#!/bin/bash
#
# DO NOT EDIT! This file is generated automatically!

HELLO=`echo 'Hello, world!'`

if [[ $# -eq 0 ]]
then
	echo $HELLO
fi</pre><code><span class="m4-sha">b53eafe</span><a href="../preproc/preproc.file.sh" title="preproc/preproc.file.sh
date: 20200106 16:21:10
sha1sum: 504d5cd
size: 137 B">preproc.file.sh</a><span class="m4-cb" title="select the text"></span><a href="#m4-preproc_preproc-file-sh" title="⚓"></a></code></div>
<h2 id="m4-m4w-examples" class="m4-ch"><a href="#m4-m4w-examples-toc" title="Content"></a><a href="#m4-m4w-examples" title="⚓">C</a>M4: examples<a href="#m4--toc" title="Top"></a></h2>
<div title="for information" class="rs-tip-major m4-info">Chars. {<code title="quotation marks" class="m4-xp">`'</code>, <code title="square brackets" class="m4-xp">[]</code>, <code title="nonprintable characters" class="m4-xp">␂␆</code>, <code title="UTF-8 characters" class="m4-xp">⟦⟧</code>} in the name controls the <a href="../generating-code-in-m4-introduction/preview.html#m4-nonterminal-expansion-control" title="Nonterminal expansion control">expansion of nonterminals</a>.</div>
<p id="m4-lr-jsonw-left-bracket-l-toc" class="m4-l2"><a href="#m4-lr-jsonw-left-bracket-l"><b>C.1</b><code>[]</code> JSON: left bracket <code>[</code></a></p>
<p id="m4-lr-bashw-counters-toc" class="m4-l2"><a href="#m4-lr-bashw-counters"><b>C.2</b><code>[]</code> Bash: counters</a></p>
<p id="m4-lr-hw-brackets-lr-l-r-lhr-ldn-toc" class="m4-l2"><a href="#m4-lr-hw-brackets-lr-l-r-lhr-ldn"><b>C.3</b><code>[]</code> .h: brackets <code>[]</code>, <code>[,]</code>, <code>[#]</code>, <code>[dnl]</code></a></p>
<p id="m4-lr-awkw-examples-of-safer-mac-toc" class="m4-l2"><a href="#m4-lr-awkw-examples-of-safer-mac"><b>C.4</b><code>[]</code> AWK: examples of safer macros</a></p>
<h3 id="m4-lr-jsonw-left-bracket-l" class="m4-ch"><a href="#m4-lr-jsonw-left-bracket-l-toc" title="Content"></a><a href="#m4-lr-jsonw-left-bracket-l" title="⚓">C.1</a><code>[]</code> JSON: left bracket <code>[</code><a href="#m4--toc" title="Top"></a></h3>
<p>The <code>[… nonterminals are not expanded …]</code> inside square brackets.
Therefore, the left square bracket <code>[</code> is replaced by the <code class="m4-hgl" data-61="6" data-62="3">LL()</code> macro defined in the root file.</p>
<div id="m4-hello_world_json-m4" class="m4-src"><pre># JSON

divert(0)dnl
{"foo": {
	"_comment": "DONTE()",
	"bar": LL()
		{"baz": "SYMBOL"}
	]
}}</pre><code><span class="m4-sha">39013f2</span><a href="../hello_world/json.m4" title="hello_world/json.m4
date: 20210103 13:26:54
sha1sum: 7e2f54b
size: 94 B">json.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_json-m4" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-json-command" class="m4-cmd m4-usc"><pre title="command">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0b.m4" title="gfiles/root0b.m4
date: 20210118 19:16:44
git rev: f77d0bc
sha1sum: 8b124d5
size: 1091 B">root0b.m4</a> <a href="../hello_world/json.m4" title="hello_world/json.m4
date: 20210103 13:26:54
git rev: 39013f2
sha1sum: 7e2f54b
size: 94 B">json.m4</a> > <a href="../hello_world/hello_world.json" title="hello_world/hello_world.json
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: 94f820a
size: 120 B">hello_world.json</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_hello_world-json-command" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-json" class="m4-src"><pre>{"foo": {
	"_comment": "DO NOT EDIT! This file is generated automatically!",
	"bar": [
		{"baz": "Hello, world!"}
	]
}}</pre><code><span class="m4-sha">b53eafe</span><a href="../hello_world/hello_world.json" title="hello_world/hello_world.json
date: 20200106 16:21:10
sha1sum: 94f820a
size: 120 B">hello_world.json</a><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_hello_world-json" title="⚓"></a></code></div>
<h3 id="m4-lr-bashw-counters" class="m4-ch"><a href="#m4-lr-bashw-counters-toc" title="Content"></a><a href="#m4-lr-bashw-counters" title="⚓">C.2</a><code>[]</code> Bash: counters<a href="#m4--toc" title="Top"></a></h3>
<p>The <code class="m4-hgl" data-63="A">COUNT_UP</code> and <code class="m4-hgl" data-63="B">COUNT_DOWN</code> counters are defined in the file <code>countu.m4</code>.
The <span class="m4-hgl" data-63="C">nonterminals</span> <code class="m4-hgl" data-63="20" data-64="5">[… inside brackets …]</code> will not be expanded, only the outer brackets will be removed.
The <code class="m4-hgl" data-63="30" data-64="15">LL()</code> macro defined in the root file must be used.</p>
<div id="m4-hello_world_sh-m4" class="m4-src"><pre># A → β
define([<span class="m4-c">LEFT</span>], [$[#]])
define([<span class="m4-c">OP</span>], [-eq])
define([<span class="m4-c">RIGHT</span>], [0])

# define two counters
# A → β
define([__COUNTUP__], defn([<span class="m4-a">COUNT_UP</span>]))
define([__COUNTDN__], defn([<span class="m4-b">COUNT_DOWN</span>]))

# init counters
__COUNTUP__(10)
__COUNTDN__(10)

divert(0)dnl
#!/bin/bash
#
[#] DONTE()

if [ LEFT OP RIGHT ]
then
	echo '__COUNTUP__] SYMBOL LL()__COUNTDN__'
fi

if test LEFT OP RIGHT
then
	echo '__COUNTUP__] SYMBOL LL()__COUNTDN__'
fi

if LL()LL() LEFT OP RIGHT ]]
then
	echo '__COUNTUP__] SYMBOL LL()__COUNTDN__'
fi</pre><code><span class="m4-sha">39013f2</span><a href="../hello_world/sh.m4" title="hello_world/sh.m4
date: 20210103 13:26:54
sha1sum: f9b14e5
size: 511 B">sh.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_sh-m4" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-sh-command" class="m4-cmd m4-usc"><pre title="command">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0u.m4" title="gfiles/root0u.m4
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: eb93f2e
size: 1324 B">root0u.m4</a> <a href="../gfiles/countu.m4" title="gfiles/countu.m4
date: 20200429 07:34:47
git rev: 17cb82f
sha1sum: 83b97d7
size: 947 B">countu.m4</a> <a href="../hello_world/sh.m4" title="hello_world/sh.m4
date: 20210103 13:26:54
git rev: 39013f2
sha1sum: f9b14e5
size: 511 B">sh.m4</a> > <a href="../hello_world/hello_world.sh" title="hello_world/hello_world.sh
date: 20200106 16:21:10
git rev: b53eafe
sha1sum: 6d2cc4c
size: 236 B">hello_world.sh</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_hello_world-sh-command" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-sh" class="m4-src"><pre>#!/bin/bash
#
# DO NOT EDIT! This file is generated automatically!

if  LEFT OP RIGHT 
then
	echo '10] Hello, world! [10'
fi

if test $# -eq 0
then
	echo '11] Hello, world! [9'
fi

if [[ $# -eq 0 ]]
then
	echo '12] Hello, world! [8'
fi</pre><code><span class="m4-sha">b53eafe</span><a href="../hello_world/hello_world.sh" title="hello_world/hello_world.sh
date: 20200106 16:21:10
sha1sum: 6d2cc4c
size: 236 B">hello_world.sh</a><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_hello_world-sh" title="⚓"></a></code></div>
<h3 id="m4-lr-hw-brackets-lr-l-r-lhr-ldn" class="m4-ch"><a href="#m4-lr-hw-brackets-lr-l-r-lhr-ldn-toc" title="Content"></a><a href="#m4-lr-hw-brackets-lr-l-r-lhr-ldn" title="⚓">C.3</a><code>[]</code> .h: brackets <code>[]</code>, <code>[,]</code>, <code>[#]</code>, <code>[dnl]</code><a href="#m4--toc" title="Top"></a></h3>
<p>The empty pair <code class="m4-hgl" data-65="A">[]</code> (or the empty symbol in brackets <code class="m4-hgl" data-65="A">[ε]</code>) serves as a&nbsp;symbol separator.
Brackets around the comment character <code class="m4-hgl" data-65="B" data-66="B">[#]</code> turn off its original meaning as well as the meaning of the <i>more powerful</i> M4 comment
<code class="m4-hgl" data-65="C" data-66="C">[dnl]</code>.
They also turn off the original meaning of the comma <code>[,]</code> as a&nbsp;macro argument delimiter.
These symbols become ordinary terminal symbols without any side effect.</p>
<div id="m4-hello_world_h-m4" class="m4-src"><pre># A → β
define([HELLO], [HELLO_WORLD])

divert(0)dnl
/*
 * <span class="m4-c">[dnl]</span> DONTE()
 */

<span class="m4-b">[#]</span>ifndef __<span class="m4-a">[]</span>HELLO<span class="m4-a">[]</span>_H
<span class="m4-b">[#]</span>define __<span class="m4-a">[]</span>HELLO<span class="m4-a">[]</span>_H

<span class="m4-b">[#]</span>define HELLO	SYMBOL

<span class="m4-b">[#]</span>endif /* __<span class="m4-a">[]</span>HELLO<span class="m4-a">[]</span>_H */</pre><code><span class="m4-sha">ce5cd99</span><a href="../hello_world/h.m4" title="hello_world/h.m4
date: 20200213 14:50:23
sha1sum: 267465d
size: 183 B">h.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_h-m4" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-h-command" class="m4-cmd m4-usc"><pre title="command">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root0b.m4" title="gfiles/root0b.m4
date: 20210118 19:16:44
git rev: f77d0bc
sha1sum: 8b124d5
size: 1091 B">root0b.m4</a> <a href="../hello_world/h.m4" title="hello_world/h.m4
date: 20200213 14:50:23
git rev: ce5cd99
sha1sum: 267465d
size: 183 B">h.m4</a> > <a href="../hello_world/hello_world.h" title="hello_world/hello_world.h
date: 20200213 14:51:13
git rev: 6b10c6c
sha1sum: 306af96
size: 179 B">hello_world.h</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_hello_world-h-command" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-h" class="m4-src"><pre>/*
 * <span class="m4-c">dnl</span> DO NOT EDIT! This file is generated automatically!
 */

<span class="m4-b">#</span>ifndef __HELLO_WORLD_H
<span class="m4-b">#</span>define __HELLO_WORLD_H

<span class="m4-b">#</span>define HELLO_WORLD	Hello, world!

<span class="m4-b">#</span>endif /* __HELLO_WORLD_H */</pre><code><span class="m4-sha">6b10c6c</span><a href="../hello_world/hello_world.h" title="hello_world/hello_world.h
date: 20200213 14:51:13
sha1sum: 306af96
size: 179 B">hello_world.h</a><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_hello_world-h" title="⚓"></a></code></div>
<h3 id="m4-lr-awkw-examples-of-safer-mac" class="m4-ch"><a href="#m4-lr-awkw-examples-of-safer-mac-toc" title="Content"></a><a href="#m4-lr-awkw-examples-of-safer-mac" title="⚓">C.4</a><code>[]</code> AWK: examples of safer macros<a href="#m4--toc" title="Top"></a></h3>
<p>The universal alert <code class="m4-hgl" data-67="A" data-68="A">DONTE</code> is ignored without parentheses, such as for example <code class="m4-hgl" data-67="B" data-68="B">LL</code> or <code>RR</code>.
Such macros are explicitly created by a&nbsp;script developer, see the root file <code>root1b.m4</code>.</p>
<div id="m4-hello_world_awk-m4" class="m4-src"><pre># AWK

divert(0)dnl
#!/bin/awk -f
#
[# DONTE()] ---> "DONTE()"

BEGIN { print "<span class="m4-a">DONTE</span>[]() <span class="m4-b">LL</span> () LL() SYMBOL ]" }</pre><code><span class="m4-sha">39013f2</span><a href="../hello_world/awk.m4" title="hello_world/awk.m4
date: 20210103 13:26:54
sha1sum: 83243af
size: 112 B">awk.m4</a><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_awk-m4" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-awk-command" class="m4-cmd m4-usc"><pre title="command">m4 -DSYMBOL='Hello, world!' <a href="../gfiles/root1b.m4" title="gfiles/root1b.m4
date: 20210118 23:26:59
git rev: 44c7674
sha1sum: 10e4b61
size: 1603 B">root1b.m4</a> <a href="../hello_world/awk.m4" title="hello_world/awk.m4
date: 20210103 13:26:54
git rev: 39013f2
sha1sum: 83243af
size: 112 B">awk.m4</a> > <a href="../hello_world/hello_world.awk" title="hello_world/hello_world.awk
date: 20210118 19:23:51
git rev: 02f55b8
sha1sum: a92eb9d
size: 135 B">hello_world.awk</a></pre><code><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_hello_world-awk-command" title="⚓"></a></code></div>
<div id="m4-hello_world_hello_world-awk" class="m4-src"><pre>#!/bin/awk -f
#
# DONTE() ---> "DO NOT EDIT! This file is generated automatically!"

BEGIN { print "<span class="m4-a">DONTE</span>() <span class="m4-b">LL</span> () [ Hello, world! ]" }</pre><code><span class="m4-sha">02f55b8</span><a href="../hello_world/hello_world.awk" title="hello_world/hello_world.awk
date: 20210118 19:23:51
sha1sum: a92eb9d
size: 135 B">hello_world.awk</a><span class="m4-cb" title="select the text"></span><a href="#m4-hello_world_hello_world-awk" title="⚓"></a></code></div>
<h2 id="m4-why-to-use-m4-and-why-notq" class="m4-ch"><a href="#m4-why-to-use-m4-and-why-notq-toc" title="Content"></a><a href="#m4-why-to-use-m4-and-why-notq" title="⚓">D</a>Why to use M4 and why not?<a href="#m4--toc" title="Top"></a></h2>
<p id="m4-why-to-generate-code-in-m4-toc" class="m4-l2"><a href="#m4-why-to-generate-code-in-m4"><b>D.1</b><code>👍</code> Why to generate code in M4</a></p>
<p id="m4-why-to-avoid-m4-toc" class="m4-l2"><a href="#m4-why-to-avoid-m4"><b>D.2</b><code>👎</code> Why to avoid M4</a></p>
<h3 id="m4-why-to-generate-code-in-m4" class="m4-ch"><a href="#m4-why-to-generate-code-in-m4-toc" title="Content"></a><a href="#m4-why-to-generate-code-in-m4" title="⚓">D.1</a><code>👍</code> Why to generate code in M4<a href="#m4--toc" title="Top"></a></h3>
<ul>
<li id="m4-direct-use-of-cfg">direct use of <a href="#m4-context-free-grammar" title="Context-free grammar">context-free grammar</a> (recursion for free)
<ul><li>minimum M4 code is required for data transformation</li></ul></li>
<li id="m4-direct-use-of-atm">direct use of automata
<ul><li>possibility to model necessary algorithms (M4 does not need versions)</li></ul></li>
<li id="m4-direct-use-of-stacks">direct use of stacks
<ul><li>stacks connected to automata extend capabilities of code generator</li></ul></li>
<li id="m4-direct-use-of-queues">direct use of output queues to temporarily store resulting pieces of code
<ul><li>individual queues are finally dumped to output in ascending order</li></ul></li>
<li id="m4-significantly-faster-code-gener">significantly faster code generation (compared to XSLT)
<ul><li>low demands on computing resources</li></ul></li>
</ul>
<h3 id="m4-why-to-avoid-m4" class="m4-ch"><a href="#m4-why-to-avoid-m4-toc" title="Content"></a><a href="#m4-why-to-avoid-m4" title="⚓">D.2</a><code>👎</code> Why to avoid M4<a href="#m4--toc" title="Top"></a></h3>
<ul>
<li id="m4-low-level-language">low-level universal language (similar to C language)
<ul><li>which in return it provides tremendous flexibility as UNIX</li></ul></li>
<li id="m4-nearly-forgotten-language">almost nonexistent developer community (as of Autumn 2019)
<ul><li>M4 is nearly forgotten language with small number of existing projects</li></ul></li>
<li id="m4-unusual-language">unusual programming paradigm requiring <a href="#m4-prerequisites-for-mastering-m" title="Prerequisites for mastering M4">several prerequisites</a>
<ul><li><b>that is why</b> the M4 can be considered a challenging language</li></ul></li>
<li id="m4-experience-dependent">productivity greatly depends on experience (problem with short-term deadlines)
<ul><li>writing M4 scripts requires <b>basic</b> knowledge of automata and grammars</li></ul></li>
<li id="m4-maintenance-could-be-hard">maintaining badly written M4 code is not easy
<ul><li>existing M4 code is easily thrown into confusion (supervision required!)</li></ul></li>
</ul>
<script>var m4root={init:function(b,c,a,v,G,f,h){var d,e,g,k,l,m,o,p=[],q=[],i,s,t,u,x,y,z,B,C,D,E;for(D of a)D.lastChild.firstChild.onclick=this.b;for(D of c){y=D.y=D.firstElementChild,t=y.innerHTML.split('\n').length,C=y.nextElementSibling;E=document.createElement("pre");E.className=G;if(C&&C.tagName=="CODE"){if(C.childNodes.length==2){C.firstChild.onclick=this.b}else{C.firstChild.onclick=this.a;C.childNodes[2].onclick=this.b}}for(i=0;i<t;i++){e=document.createElement("div");if(i&1)e.className=f;E.appendChild(e)}D.insertBefore(E,y)}for(l of b){B=Object.keys(l.dataset);for(i of B){D=c[i];if(!D.n)D.n=[];D.n.push({w:l,H:l.dataset[i]})}l.onmouseover=function(){var k;if(this.o)for(k of this.o)k.w.classList.add(k.H);if(this.q)for(k of this.q)k.w.classList.add(...k.H)};l.onmouseout=function(){var k;if(this.o)for(k of this.o)k.w.classList.remove(k.H);if(this.q)for(k of this.q)k.w.classList.remove(...k.H)}}for(D of c){if(!D.n)continue;g=1;if(D.style.counterReset)g+=parseInt(D.style.counterReset.split(' ')[1]);E=D.firstElementChild;for(k of D.n){k.H=k.H.replace(/[A-Z]+|[_a-z]\w*|\d+-\d+/g,'"$&"').replace(/^:/,'"":');k.H=/:/.test(k.H)?"{"+k.H+"}":'{"":['+k.H+']}';x=JSON.parse(k.H,function(r,H){if(/^[A-Z]+$/.test(H)){q.push(v+H);return undefined}if(/^\d+-\d+$/.test(H)){m=H.split('-');s=parseInt(m[1]);for(i=m[0];i<=s;i++){H=i-g;if(H>=0)p.push(H)}return undefined}if(Number.isInteger(H)){H-=g;return H>=0?H:undefined}if(Array.isArray(H)){H=H.filter(function(){return true}).concat(p);p=[];return H.length?H:undefined}if(typeof H==='object')return H;return undefined});if(q.length){if(!k.w.q)k.w.q=[];k.w.q.push({w:D.y,H:q});q=[]}o=Object.keys(x);if(o.length){if(!k.w.o)k.w.o=[];for(d of o){u=x[d];z=d?v+d:h;for(i of u)k.w.o.push({w:E.children[i],H:z})}}}}},a:function(){var a=this.parentNode,b,c,d,e;if(this.b){if(this.b.isConnected)a.removeChild(this.b);else a.appendChild(this.b);return}b=document.createElement("div");e=this.nextSibling.title.split('\n');for(d of e){c=document.createElement("div");c.appendChild(document.createTextNode(d));b.appendChild(c)}a.appendChild(this.b=b)},b:function(){var a=this.parentNode.previousSibling,b,c;if(window.getSelection){b=window.getSelection();c=document.createRange();c.selectNodeContents(a);b.removeAllRanges();b.addRange(c)}else{c=document.body.createTextRange();c.moveToElementText(a);c.select()}}}</script>
<script>m4root.init(document.getElementsByClassName("m4-hgl"),document.getElementsByClassName("m4-src"),document.getElementsByClassName("m4-cmd"),"m4-","m4-re","m4-ev","m4-dh")</script>
</div>
</div>
</div>
<div class="element-margin-top  section ">
<div class="section__header">
<h2 class="section__heading">Author of the article</h2>
</div>
<div class="design-box__content">
<div class="author">
<div class="author__pic avatar-round">
<a class="avatar__wrap" href="#" title="Author's profile">
<img class="avatar__img" src="../img/pepa.png" width="70" height="70" alt="Josef Kubín">
</a>
</div>
<div class="author__info">
<div class="author__details">
<h3 class="author__name">
<a href="https://www.root.cz/autori/">Josef Kubín</a>
</h3>
</div>
<div class="author__bio urs">
<p>zabýval se teoretickou informatikou a&nbsp;programováním hardware.
Pracuje ve společnosti Red&nbsp;Hat v&nbsp;<abbr title="Global Support Services">GSS</abbr>.
</p>
</div>
</div>
</div>
</div>
<div class="design-impressum__item-wrapper--rubrics design-impressum__item-wrapper">
<h3 class="element-heading-reset">
<a class="design-label--empty design-label" href="https://www.root.cz/n/">Stickers:</a>
</h3>
<ul class="design-list--labels design-list--inline design-list list-reset">
<li>
<a class="design-label--default design-label" href="https://www.root.cz/n/unix/">UNIX</a>
</li>
<li>
<a class="design-label--default design-label" href="https://www.root.cz/n/vim/">Vim</a>
</li>
</ul>
</div>
</div>
</div> 
</div> 
</div> 
</div>
</div>
</body>
</html>
