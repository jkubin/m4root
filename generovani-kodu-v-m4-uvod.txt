Generov√°n√≠ k√≥du v M4: √∫vod

Makro procesor M4 se pou≈æ√≠v√° ke generov√°n√≠ libovolnƒõ slo≈æit√©ho k√≥du z jednoduch√©ho zdrojov√©ho k√≥du.
√övodn√≠ d√≠l seri√°lu obsahuje jeho historii, z√°kladn√≠ principy jazyka, p≈ô√≠klady pou≈æit√≠ a nutn√© p≈ôedpoklady pro jeho zvl√°dnut√≠.

Obsah (English)	mc spl txt dev pre c  aktualizov√°no 10. ledna 2021
1 √övod
	1.1 P≈ô√≠klady pro ƒçten√°≈ôe
2 Historie makro jazyk≈Ø
3 Z√°klady jazyka M4
	3.1 Bezkontextov√° gramatika
	3.2 Automaty
	3.3 V√Ωstupn√≠ fronty
4 Hlavn√≠ pou≈æit√≠ M4
	4.1 Generov√°n√≠ k√≥du
	4.2 Preprocesor
5 P≈ôedpoklady pro zvl√°dnut√≠ M4
	5.1 Z√°klady gramatik
	5.2 Z√°klady automat≈Ø
	5.3 (GNU) make
	5.4 Vim
	5.5 Talent a ƒças
6 Odkazy
---
A P≈ô√≠klady generov√°n√≠ k√≥du
B P≈ô√≠klady preprocesoru
C M4: p≈ô√≠klady
D Proƒç pou≈æ√≠vat M4 a proƒç ne?

1 √övod
ƒåten√°≈ôi tohoto seri√°lu se nauƒç√≠ ps√°t skripty pro strojov√© generov√°n√≠ k√≥du.
Strojovƒõ generovan√Ω k√≥d m≈Ø≈æe b√Ωt libovolnƒõ slo≈æit√Ω a m≈Ø≈æe obsahovat dal≈°√≠ vnit≈ôn√≠ z√°vislosti.
Vz√°jemnƒõ z√°visl√© soubory se slo≈æit√Ωm k√≥dem jsou pro ƒçlovƒõka jen tƒõ≈æce udr≈æiteln√© v konzistentn√≠m stavu.
Je u≈æ nutn√© pou≈æ√≠t nƒõjak√Ω mechanismus pro generov√°n√≠ k√≥du.
Generov√°n√≠ k√≥du prov√°d√≠ n√°stroj urƒçen√Ω pro transformaci textu ‚Äì makro procesor.

Seri√°l je zamƒõ≈ôen na praktick√© pou≈æit√≠ univerz√°ln√≠ho makro procesoru M4 (d√°le jen M4) pomoc√≠ mal√Ωch p≈ô√≠klad≈Ø.
Popisuje tak√© teoretick√Ω z√°klad v≈°ech implementac√≠.
C√≠lem seri√°lu je sezn√°mit ƒçten√°≈ôe s t√≠mto n√°strojem a tak√© programovac√≠m jazykem.
Na co se pou≈æ√≠v√°, jak se v nƒõm programuje a jak√© jsou jeho v√Ωhody a nev√Ωhody.

üñπ V√≠cejazyƒçn√Ω seri√°l ‚ÄûGenerov√°n√≠ k√≥du v M4‚Äú je generov√°n M4 skripty[1],
kter√© (mo≈æn√°) usnadn√≠ psan√≠ ƒçl√°nk≈Ø a seri√°l≈Ø pro www.root.cz tak√© jin√Ωm autor≈Øm.
V√Ωsledkem seri√°lu je tak√© sada uk√°zkov√Ωch skript≈Ø pro generov√°n√≠ k√≥du.

√övodn√≠ d√≠l popisuje z√°kladn√≠ principy jazyka na jednoduch√Ωch p≈ô√≠kladech.
V≈°echny p≈ô√≠klady pou≈æ√≠vaj√≠ p≈ôepisovac√≠ pravidla bezkontextov√© gramatiky.
Pozdƒõji se nauƒç√≠me pou≈æ√≠vat v√Ωstupn√≠ fronty,
automaty, asociativn√≠ pamƒõti, z√°sobn√≠ky a z√°sobn√≠kov√© automaty.
Nauƒç√≠me se tak√© ps√°t testovac√≠ automaty pro testov√°n√≠ vstupn√≠ch dat.

1.1 P≈ô√≠klady pro ƒçten√°≈ôe
P≈ô√≠klady pro ƒçten√°≈ôe tvo≈ô√≠ komplement√°rn√≠ ƒç√°st seri√°lu a budou do jist√© m√≠ry vytv√°≈ôeny na z√°kladƒõ podnƒõt≈Ø v diskuzi pod ƒçl√°nkem.
Na zaƒç√°tku ka≈æd√©ho d√≠lu je pops√°na nƒõjak√° ƒç√°st jazyka M4 doplnƒõn√° sadou p≈ô√≠klad≈Ø na konci.
Ka≈æd√Ω d√≠l je mo≈æn√© ƒç√≠st v libovoln√©m po≈ôad√≠.

‚Ä¢ P≈ô√≠klady generov√°n√≠ k√≥du
‚Ä¢ P≈ô√≠klady preprocesoru
‚Ä¢ M4: p≈ô√≠klady
‚Ä¢ Proƒç pou≈æ√≠vat M4 a proƒç ne?
‚Ä¢ http://github.com/jkubin/m4root ‚Äì projekt generuj√≠c√≠ tento seri√°l

2 Historie makro jazyk≈Ø
Makro jazyky byly vynalezeny v dobƒõ, kdy dominoval jazyk symbolick√Ωch adres ‚Äì JSA.
Zdrojov√Ω k√≥d JSA velmi ƒçasto obsahuje shodn√© sekvence instrukc√≠ odli≈°uj√≠c√≠ se pouze hodnotami operand≈Ø.
Shodn√© sekvence instrukc√≠ je mo≈æn√© seskupit do jednoho slova, nebo-li makro instrukce.
Jm√©no obvykle popisuje √∫ƒçel skryt√© sekvence instrukc√≠.
Makro instrukce se p≈ôelo≈æ√≠ makro procesorem na p≈Øvodn√≠ sekvenci instrukc√≠, kter√° se posl√©ze p≈ôelo≈æ√≠ do spustiteln√©ho strojov√©ho k√≥du.
Programov√°n√≠ v JSA pomoc√≠ makro instrukc√≠ je jednodu≈°≈°√≠, rychlej≈°√≠ a m√©nƒõ n√°chyln√© k lidsk√Ωm chyb√°m.

Pozdƒõji byly makro jazyky pou≈æity k roz≈°√≠≈ôen√≠ kompilovan√Ωch programovac√≠ch jazyk≈Ø, proto≈æe umo≈ænily ps√°t zdrojov√Ω k√≥d na vy≈°≈°√≠ √∫rovni abstrakce ne≈æ jakou poskytuje samotn√Ω programovac√≠ jazyk.
Rychlost, v√Ωkonnost a efektivita slo≈æit√©ho programovac√≠ho jazyka ni≈æ≈°√≠ √∫rovnƒõ je zachov√°na d√≠ky makro jazyk≈Øm.
Av≈°ak je d≈Øle≈æit√© dob≈ôe rozumƒõt v≈°em vrstv√°m k√≥du.

GPM (General Purpose Macro-generator)
Z√°kladn√≠ my≈°lenku p≈ôepisov√°n√≠ textov√Ωch ≈ôetƒõzc≈Ø s argumenty, kter√© se p≈ôep√≠≈°√≠ do dal≈°√≠ch rekurzivnƒõ p≈ôepisovateln√Ωch ≈ôetƒõzc≈Ø, p≈ôedstavil
Christopher Strachey ve sv√©m
GPM[2] v roce 1965.
Dal≈°√≠ generace makro procesor≈Ø M3 a M4 p≈Øvodn√≠ GPM v podstatƒõ u≈æ jen roz≈°i≈ôovaly.
Z√°kladn√≠ my≈°lenka p≈Øvodn√≠ho n√°vrhu ale z≈Østala stejn√°.

M3
Dennis Ritchie p≈ôevzal z√°kladn√≠ my≈°lenku GPM a napsal vylep≈°en√Ω makro procesor pro generov√°n√≠ zdrojov√©ho k√≥du programovac√≠ho jazyka C (1972), kter√Ω s√°m navrhl.
Nov√Ω makro procesor napsal pro minipoƒç√≠taƒç AP-3, odtud jm√©no M3.
Tento p≈ô√≠m√Ω p≈ôedch≈Ødce souƒçasn√©ho M4 dok√°zal v√Ωraznƒõ u≈°et≈ôit tƒõ≈ækou a ƒçasovƒõ n√°roƒçnou pr√°ci, ƒç√≠m≈æ zaujal v√Ωvoj√°≈ôe programuj√≠c√≠ v jin√Ωch jazyc√≠ch (FORTRAN, COBOL, PL/I, ‚Ä¶).
V√Ωvoj√°≈ôi upravovali M3 pro tyto jazyky ƒç√≠m≈æ ho promƒõnili na univerz√°lnƒõ pou≈æiteln√Ω makro procesor M4.

Dennis Ritchie byl tak√© spolutv≈Ørcem operaƒçn√≠ho syst√©mu UNIX a proto:

‚Ä¢ M4 je minimalistick√Ω a rychl√Ω, dƒõl√° jednu vƒõc a tu dƒõl√° dob≈ôe
‚Ä¢ v√Ωhradnƒõ spol√©h√° na neinteraktivn√≠ rozhran√≠ p≈ô√≠kazov√© ≈ô√°dky
‚Ä¢ parametry a z√°vislosti M4 skript≈Ø popisuje Makefile
‚Ä¢ znakem # zaƒç√≠n√° jedno≈ô√°dkov√Ω koment√°≈ô jako v UNIX-ov√©m shell-u
‚Ä¢ promƒõnn√© $@, $*, $#, $0, $1, $2, $3, ‚Ä¶ maj√≠ podobn√Ω v√Ωznam jako v shell-u
‚Ä¢ oddƒõlovaƒç argument≈Ø je ƒç√°rka

Makro procesor M3 roz≈°√≠≈ôil tak√© Jim E. Weythman, autor programov√© konstrukce, kter√° se pou≈æ√≠v√° t√©mƒõ≈ô v ka≈æd√©m M4 skriptu:

divert(-1)
‚Ä¶
define(‚Ä¶)
‚Ä¶
divert(0)‚Ä¶

üñπ Kl√≠ƒçov√© slovo divert(‚Ñ§) p≈ôep√≠n√° v√Ωstupn√≠ fronty.
Argument -1 zcela vypne jak√Ωkoliv textov√Ω v√Ωstup.
Argument 0 p≈ôepne v√Ωstup na stdout (standardn√≠ v√Ωstup).

M4
Brian Kernighan makro procesor M3 roz≈°√≠≈ôil na preprocesor jazyka FORTRAN 66,
aby mohl vytvo≈ôit hybridn√≠ jazykovou nadstavbu pojmenovanou RATFOR[3].
Z√°kladn√≠ programov√© konstrukce t√©to nadstavby (podm√≠nky, cykly) jsou stejn√© jako v jazyce C.
Programov√°n√≠ v RATFOR-u se tak podob√° programov√°n√≠ v ‚Äûc√©ƒçku‚Äú.
Makro procesor zdrojov√Ω k√≥d p≈ôekl√°d√° zp√°tky do FORTRAN-u, pot√© kompil√°tor provede p≈ôeklad do strojov√©ho k√≥du.

V≈°imnƒõte si t√©mƒõ≈ô dokonal√© symbi√≥zy s jazykem C

‚Ä¢ direktivy CPP #define, #include, #ifdef, ‚Ä¶ jsou pro M4 koment√°≈ôe
‚Ä¢ kl√≠ƒçov√° slova oddƒõlen√° od z√°vorek mezerou, ztr√°c√≠ sv≈Øj p≈Øvodn√≠ v√Ωznam
	‚Ä¢ M4 nap≈ô√≠klad ignoruje funkci void define (char c, int i) {‚Ä¶}
‚Ä¢ argumenty maker oddƒõluj√≠ ƒç√°rky stejnƒõ jako argumenty funkc√≠ jazyka C
	‚Ä¢ je-li definov√°no makro FUNC(char c, int i), jeho promƒõnn√© jsou:
$# ‚Üí 2, $0 ‚Üí FUNC, $1 ‚Üí char c, $2 ‚Üí int i
‚Ä¢ lev√Ω ≈ô√≠d√≠c√≠ znak ` nen√≠ souƒç√°st√≠ syntaxe rodiny jazyk≈Ø C
‚Ä¢ prav√Ω ≈ô√≠d√≠c√≠ znak ' nevad√≠, nen√≠-li souƒç√°st√≠ makra
	‚Ä¢ oba ≈ô√≠d√≠c√≠ znaky lze skr√Ωt do u≈æivatelsk√Ωch maker LL(), RR()
‚Ä¢ makra se p√≠≈°√≠ VELKYMI_PISMENY, stejnƒõ jako netermin√°ln√≠ symboly
	‚Ä¢ t√≠m je vymezen jejich jmenn√Ω prostor

U≈æivatelsk√Ω manu√°l[4] zmi≈àuje je≈°tƒõ dal≈°√≠, zde neuveden√© spoluautory.
Bylo by tedy znaƒçnƒõ nespravedliv√© napsat, ≈æe autory makro procesoru M4 (1977) jsou pouze dva lid√©.

Obr√°zek 1: Christopher Strachey[5],
Dennis Ritchie[6],
Brian Kernighan[7]

GNU M4
Dnes existuje nƒõkolik implementac√≠ li≈°√≠c√≠ se od p≈Øvodn√≠ implementace sp√≠≈°e drobnostmi.
Nejroz≈°√≠≈ôenƒõj≈°√≠ implementace M4 je GNU M4 pou≈æ√≠van√° pro Autotools
a pro p≈ôeklad jednoduch√©ho konfiguraƒçn√≠ho souboru sendmail.mc na slo≈æit√Ω sendmail.cf.
Autorem t√©to implementace z roku 1990 je Ren√© Seindal.
N√°sleduj√≠c√≠ p≈ô√≠kaz nainstaluje m4:

# dnf -y install make m4 pinfo

Podrobn√Ω popis kl√≠ƒçov√Ωch slov se nach√°z√≠ v dokumentaci[8]:

$ pinfo m4
$ man m4
$ m4 --help

3 Z√°klady jazyka M4
Z√°kladem jazyka M4 je bezkontextov√° gramatika, automaty, z√°sobn√≠ky a v√Ωstupn√≠ fronty.
Pro pochopen√≠ jazyka M4 je proto velmi d≈Øle≈æit√© rozumƒõt z√°kladn√≠m pojm≈Øm teorie form√°ln√≠ch jazyk≈Ø ‚Äì
co jsou termin√°ln√≠ symboly (struƒçnƒõ termin√°ly) a netermin√°ln√≠ symboly (struƒçnƒõ netermin√°ly).
Zm√≠nƒõn√© pojmy si podrobnƒõji vysvƒõtl√≠me nƒõkdy pozdƒõji.
C√≠lem tohoto √∫vodn√≠ho d√≠lu je hlavnƒõ uk√°zat praktick√© pou≈æit√≠ M4 na p≈ô√≠kladech.

3.1 Bezkontextov√° gramatika
Bezkontextov√° gramatika (kr√°tce CFG) je form√°ln√≠ gramatika, ve kter√© maj√≠ v≈°echna p≈ôepisovac√≠ pravidla tvar A ‚Üí Œ≤.
Netermin√°l A se p≈ôep√≠≈°e na libovolnƒõ dlouh√Ω ≈ôetƒõzec Œ≤ slo≈æen√Ω z netermin√°l≈Ø N nebo termin√°l≈Ø Œ£.
Kleeneho hvƒõzda znamen√°, ≈æe se netermin√°l A m≈Ø≈æe p≈ôepsat na Œµ (p≈ôepisovac√≠ pravidlo A ‚Üí Œµ).

P: A ‚Üí Œ≤
   A ‚àà N
   Œ≤ ‚àà (N ‚à™ Œ£)*

P≈ôepisovac√≠ pravidla M4
P≈ôepisovac√≠ pravidla M4 jsou stejn√° jako p≈ôepisovac√≠ pravidla bezkontextov√© gramatiky.

# A ‚Üí Œ≤
define(`A', `Œ≤')

# A ‚Üí Œµ
define(`A')
define(`A', `')

V≈°echna kl√≠ƒçov√° slova M4 jsou netermin√°ly (makra), provedou nƒõjakou akci a p≈ôep√≠≈°√≠ se na Œµ nebo jin√Ω symbol.
V≈°echna kl√≠ƒçov√° slova lze p≈ôejmenovat nebo √∫plnƒõ vypnout.
Tato vlastnost je velmi d≈Øle≈æit√° pro re≈æim preprocesoru.

divert(‚Ñ§) ‚Üí Œµ
define(`A', `Œ≤') ‚Üí Œµ
ifelse(`', `', `yes', `no') ‚Üí yes
ifelse(`', `', `ifdef(`‚Ä¶

≈ò√≠zen√≠ expanze netermin√°l≈Ø
V√Ωchoz√≠ dvojice znak≈Ø `' v M4 ≈ô√≠d√≠ expanzi netermin√°l≈Ø.
Kl√≠ƒçov√© slovo changequote() je m≈Ø≈æe zmƒõnit na jin√© znaky, nap≈ô√≠klad {[], ‚êÇ‚êÜ, ‚ü¶‚üß}.
Netermin√°ly, kter√© nechceme (ihned) expandovat, jsou obklopeny touto dvojic√≠ znak≈Ø.
P≈ôi pr≈Øchodu makro procesorem jsou v≈°echny symboly mezi touto dvojic√≠ znak≈Ø termin√°ln√≠mi symboly a vnƒõj≈°√≠ dvojice znak≈Ø je odstranƒõna.
Dal≈°√≠ pr≈Øchod ji≈æ zp≈Øsob√≠ expanzi p≈Øvodnƒõ chr√°nƒõn√Ωch netermin√°l≈Ø.
Dvojice ≈ô√≠d√≠c√≠ch znak≈Ø se nastavuje na zaƒç√°tku ko≈ôenov√©ho souboru.

3.2 Automaty
Automaty slou≈æ√≠ jako ‚Äûp≈ôep√≠naƒçe‚Äú pravidel gramatiky.
Pou≈æ√≠vaj√≠ p≈ôepisovac√≠ pravidla gramatiky jako uzly a mƒõn√≠ sv√© stavy podle vstupn√≠ch symbol≈Ø.
Aktu√°lnƒõ pou≈æ√≠van√© p≈ôepisovac√≠ pravidlo produkuje do v√Ωstupn√≠ fronty (nebo do nƒõkolika v√Ωstupn√≠ch front)
specifick√Ω k√≥d, dokud automat nep≈ôejde do jin√©ho uzlu s jin√Ωm p≈ôepisovac√≠m pravidlem.
P≈ô√≠klady generuj√≠c√≠ch automat≈Ø jsou uk√°z√°ny v p≈ô√≠loze.

3.3 V√Ωstupn√≠ fronty
V√Ωstupn√≠ fronty jsou doƒçasn√© √∫lo≈æi≈°tƒõ pro ƒç√°sti v√Ωsledn√©ho k√≥du.
Tyto ƒç√°sti v√Ωsledn√©ho k√≥du jsou produkov√°ny p≈ôepisovac√≠mi pravidly gramatiky, kter√© p≈ôepisuj√≠ vstupn√≠ symboly.
Kl√≠ƒçov√© slovo divert(‚Ñ§) nastavuje aktu√°ln√≠ v√Ωstupn√≠ frontu.
Na z√°vƒõr jsou v≈°echny nepr√°zdn√© fronty vyps√°ny ve vzestupn√©m po≈ôad√≠ na standardn√≠ v√Ωstup a slo≈æ√≠ v√Ωsledn√Ω k√≥d z ƒç√°st√≠ k√≥du.
V√Ωstupn√≠ fronty jsou uk√°z√°ny v p≈ô√≠loze.

üõà Z√°sobn√≠ky si uk√°≈æeme pozdƒõji.

4 Hlavn√≠ pou≈æit√≠ M4
M4 se pou≈æ√≠v√° ke generov√°n√≠ zdrojov√©ho k√≥du libovoln√©ho programovac√≠ho jazyka nebo jako preprocesor jak√©hokoliv zdrojov√©ho k√≥du.

4.1 Generov√°n√≠ k√≥du
M4 transformuje vstupn√≠ data ze soubor≈Ø .mc na v√Ωsledn√° data n√°sleduj√≠c√≠m p≈ô√≠kazem:

$ m4 root.m4 stem.m4 branch.m4 leaf.m4 input1.mc input2.mc > output.file

Bƒõhem naƒç√≠t√°n√≠ soubor≈Ø jsou prov√°dƒõny dvƒõ z√°kladn√≠ operace:

‚Ä¢ ƒçten√≠ transformaƒçn√≠ch pravidel ze soubor≈Ø s p≈ô√≠ponou .m4
‚Ä¢ expanze maker uvnit≈ô soubor≈Ø s p≈ô√≠ponou .mc
Soubory input1.mc a input2.mc obsahuj√≠ vstupn√≠ data ve specifick√©m form√°tu, kter√Ω umo≈æ≈àuje jejich transformaci na v√Ωstupn√≠ data podle pravidel v p≈ôedchoz√≠ch .m4 souborech.
Datov√© soubory .mc obvykle neobsahuj√≠ ≈æ√°dn√° transformaƒçn√≠ pravidla.

Vstupn√≠ data mohou tak√© p≈ôich√°zet z kolony:

$ cat input.mc | m4 root.m4 stem.m4 branch.m4 leaf.m4 - > output.file

$ cat input.mc | m4 root.m4 stem.m4 branch.m4 leaf.m4 - | gcc -x c -o progr -

Vyzkou≈°ejte: P≈ô√≠klady generov√°n√≠ k√≥du

4.2 Preprocesor
M4 m≈Ø≈æe pracovat v re≈æimu preprocesoru a m≈Ø≈æe b√Ωt tak√© souƒç√°st√≠ kolony.
Vstupn√≠ zdrojov√Ω k√≥d j√≠m proch√°z√≠ beze zmƒõny s v√Ωjimkou netermin√°ln√≠ch symbol≈Ø.
Nalezen√© netermin√°ly jsou expandov√°ny na termin√°ly a odch√°z√≠ spolu se zdrojov√Ωm k√≥dem na v√Ωstup.
M4 m≈Ø≈æe roz≈°√≠≈ôit jak√Ωkoliv jin√Ω jazyk, kde je preprocesor nedostateƒçn√Ω (bez rekurze) nebo ≈æ√°dn√Ω.
D≈Øle≈æit√© je zvolit vhodn√Ω lev√Ω znak pro ≈ô√≠zen√≠ expanze netermin√°l≈Ø, kter√Ω nesm√≠ kolidovat se znakem vstupn√≠ho zdrojov√©ho k√≥du.
Kolize znaku je ale snadno ≈ôe≈°iteln√° regul√°rn√≠m v√Ωrazem.

$ m4 root.m4 stem.m4 branch.m4 leaf.m4 file.c > preproc.file.c

$ m4 root.m4 stem.m4 branch.m4 leaf.m4 file.c | gcc -x c -o progr -

`' V√Ωchoz√≠ znaky
Konfliktn√≠ znak ` ze vstupn√≠ho zdrojov√©ho k√≥du je skryt do makra `'LL().
Pr√°zdn√Ω p√°r ≈ô√≠d√≠c√≠ch znak≈Ø `' p≈ôed makrem LL() slou≈æ√≠ jako oddƒõlovaƒç symbol≈Ø.
P≈ôi pr≈Øchodu zdrojov√©ho k√≥du makro procesorem se makro `'LL() p≈ôep√≠≈°e zp√°tky na p≈Øvodn√≠ znak ` a pr√°zdn√Ω p√°r `' je odstranƒõn.

$ sed 's/`/`'\''LL()/g' any.src | m4 rootq.m4 leaf.m4 -

Vyskytuj√≠-li se ve vstupn√≠m k√≥du koment√°≈ôe # nebo dnl, je nutn√© je skr√Ωt.
Znaky `' vypnou p≈Øvodn√≠ v√Ωznam koment√°≈ô≈Ø a budou odebr√°ny p≈ôi pr≈Øchodu makro procesorem.

Koment√°≈ôe M4 # a dnl jsou skryty mezi v√Ωchoz√≠ znaky: `#' `dnl'

$ sed 's/`/`'\''LL()/g;s/#\|\<dnl\>/`&'\''/g' any.src | m4 rootq.m4 leaf.m4 -

$ sed 's/`/`'\''LL()/g;s/#/`#'\''/g;s/\<dnl\>/`dnl'\''/g' any.src | m4 ‚Ä¶

[] Hranat√© z√°vorky
Pou≈æijeme-li pro ≈ô√≠zen√≠ expanze netermin√°l≈Ø hranat√© z√°vorky, stejn√Ωm zp≈Øsobem je skryta lev√° [ hranat√° z√°vorka.
V≈°e ostatn√≠ plat√≠ jako pro v√Ωchoz√≠ znaky `'.

$ sed 's/\[/[]LL()/g' any.src | m4 rootb.m4 leaf.m4 - | ‚Ä¶

Koment√°≈ôe M4 # a dnl jsou skryt√© mezi z√°vorkami: [#] [dnl]

$ sed 's/\[/[]LL()/g;s/#\|\<dnl\>/[&]/g' any.src | m4 rootb.m4 leaf.m4 - | ‚Ä¶

$ sed 's/\[/[]LL()/g;s/#/[#]/g;s/\<dnl\>/[dnl]/g' any.src | m4 rootb.m4 ‚Ä¶

‚êÇ‚êÜ Netisknuteln√© znaky
Pro ≈ô√≠zen√≠ expanze netermin√°l≈Ø lze pou≈æ√≠t netisknuteln√© znaky ‚êÇ (0x02) a ‚êÜ (0x06).
Tyto znaky nemohou kolidovat s tisknuteln√Ωmi znaky zdrojov√©ho k√≥du.

$ m4 rootn.m4 leaf.m4 any.src | gcc ‚Ä¶

Koment√°≈ôe M4 # a dnl jsou skryty mezi netisknuteln√© znaky: ‚êÇ#‚êÜ ‚êÇdnl‚êÜ

$ sed 's/#\|\<dnl\>/‚êÇ&‚êÜ/g' any.src | m4 rootn.m4 leaf.m4 - | gcc ‚Ä¶

$ sed 's/#/‚êÇ#‚êÜ/g;s/\<dnl\>/‚êÇdnl‚êÜ/g' any.src | m4 rootn.m4 leaf.m4 - | gcc ‚Ä¶

‚ü¶‚üß UTF-8 znaky
Expanzi netermin√°l≈Ø m≈Ø≈æe tak√© ≈ô√≠dit vhodnƒõ zvolen√Ω p√°r UTF-8 znak≈Ø.
Bƒõ≈æn√Ω zdrojov√Ω k√≥d takov√© znaky neobsahuje, proto nemus√≠me ≈ôe≈°it kolizi lev√©ho ≈ô√≠d√≠c√≠ho ‚ü¶ znaku.
UTF-8 znaky nab√≠z√≠ podobn√© v√Ωhody jako netisknuteln√© znaky.

$ m4 rootu.m4 leaf.m4 any.src | gcc ‚Ä¶

Koment√°≈ôe M4 # a dnl jsou skryty mezi UTF-8 znaky: ‚ü¶#‚üß ‚ü¶dnl‚üß

$ sed 's/#\|\<dnl\>/‚ü¶‚ü¶&‚üß‚üß/g' any.src | m4 rootu.m4 leaf.m4 - | gcc ‚Ä¶

$ sed 's/#/‚ü¶#‚üß/g;s/\<dnl\>/‚ü¶dnl‚üß/g' any.src | m4 rootu.m4 leaf.m4 - | gcc ‚Ä¶

Vyzkou≈°ejte: P≈ô√≠klady preprocesoru

Sm√≠≈°en√Ω re≈æim
Sm√≠≈°en√Ω re≈æim je kombinac√≠ p≈ôedchoz√≠ch re≈æim≈Ø a je pou≈æ√≠v√°n hlavnƒõ na pokusy.
Data nejsou oddƒõlena od transformaƒçn√≠ch pravidel.
Listov√Ω soubor leaf.m4 obsahuje definice tƒõchto pravidel spolu se vstupn√≠mi daty.

$ m4 root.m4 leaf.m4

Vyzkou≈°ejte: M4: p≈ô√≠klady

5 P≈ôedpoklady pro zvl√°dnut√≠ M4
Pro √∫spƒõ≈°n√© zvl√°dnut√≠ tohoto makro jazyka je d≈Øle≈æit√© splnit nƒõkolik p≈ôedpoklad≈Ø.
M4 nen√≠ jednoduch√Ω jazyk, proto≈æe nen√≠ mo≈æn√© v nƒõm myslet a programovat jako v bƒõ≈æn√©m programovac√≠m jazyce.
Nejd≈Øle≈æitƒõj≈°√≠ je uvƒõdomit si, ≈æe se v nƒõm programuj√≠ p≈ôepisovac√≠ pravidla gramatiky.
Ka≈æd√Ω ≈ôetƒõzec je buƒè termin√°ln√≠ nebo netermin√°ln√≠ symbol vƒçetnƒõ v≈°ech kl√≠ƒçov√Ωch slov jazyka (symboly # a , jsou speci√°ln√≠ p≈ô√≠pady netermin√°l≈Ø).

M4 z√°mƒõrnƒõ nem√° kl√≠ƒçov√° slova pro cykly (for/while), proto≈æe jeho z√°klad je zcela jin√Ω, ne≈æ jak√Ω maj√≠ procedur√°ln√≠ nebo funkcion√°ln√≠ jazyky.

‚Ä¢ cykly jsou pouze levorekurzivn√≠ nebo pravorekurzivn√≠
‚Ä¢ vƒõtv√≠ se ≈ôetƒõzen√≠m symbol≈Ø nebo kl√≠ƒçov√Ωmi slovy ifelse(), ifdef()

5.1 Z√°klady gramatik
Z√°kladem v≈°ech gramatik jsou p≈ôepisovac√≠ pravidla, jejich≈æ podobu obecnƒõ popisuje:

Form√°ln√≠ gramatika (Chomsk√©ho typu)
G = (N, Œ£, P, S)
N: koneƒçn√° mno≈æina netermin√°ln√≠ch symbol≈Ø
Œ£: koneƒçn√° mno≈æina termin√°ln√≠ch symbol≈Ø
   N ‚à© Œ£ = √∏
P: koneƒçn√° mno≈æina p≈ôepisovac√≠ch pravidel
   (N ‚à™ Œ£)* N (N ‚à™ Œ£)* ‚Üí (N ‚à™ Œ£)*
S: je poƒç√°teƒçn√≠ (startovac√≠) symbol
   S ‚àà N

Form√°ln√≠ gramatika popisuje podmno≈æiny
p≈ôepisovac√≠ch pravidel form√°ln√≠ho jazyka.
Jedna z podmno≈æin se jmenuje bezkontextov√° gramatika,
kr√°tce CFG.
Jak ji≈æ bylo d≈ô√≠ve zm√≠nƒõno, p≈ôepisovac√≠ pravidla CFG pracuj√≠ stejnƒõ jako p≈ôepisovac√≠ pravidla jazyka M4.
Nƒõkter√Ω z n√°sleduj√≠c√≠ch d√≠l≈Ø seri√°lu se podrobnƒõji zamƒõ≈ô√≠ na form√°ln√≠ gramatiky.

5.2 Z√°klady automat≈Ø
Schopnost pou≈æ√≠vat p≈ôev√°≈ænƒõ dvoustavov√© automaty je z√°sadn√≠ vƒõc pro psan√≠ jednoduch√Ωch M4 skript≈Ø, proto≈æe p≈ôev√°≈æn√° vƒõt≈°ina skript≈Ø pou≈æ√≠v√° mal√© automaty.

Testovac√≠ automat
Po≈ôad√≠ vstupn√≠ch symbol≈Ø nebo jejich kontext lze otestovat automatem.
Spl≈àuj√≠-li vstupn√≠ symboly po≈æadovan√© vlastnosti, automat skonƒç√≠ v uzlu s dvojit√Ωm krou≈ækem, kter√Ωm se oznaƒçuje akceptuj√≠c√≠ stav.

Obr√°zek 2: P≈ô√≠klad automatu[9] akceptuj√≠c√≠ sud√Ω poƒçet (≈æ√°dn√Ω je tak√© sud√Ω) symbol≈Ø 0, ignoruj√≠c√≠ symboly 1.
Automat je shodn√Ω s regul√°rn√≠m v√Ωrazem (1*01*01*)*1*.

P≈ôedchoz√≠ automat lze zapsat jako ASCII art doprov√°zej√≠c√≠ M4 skript:

#          ____1
#         |   /
#      ___V__/   0    ____
# --->// S1 \\------>/ S2 \---.1
#     \\____//<------\____/<--'
#                0

Generuj√≠c√≠ automat
Vstupn√≠ symboly mƒõn√≠ uzly automatu, ƒç√≠m≈æ z√°rove≈à mƒõn√≠ p≈ôepisovac√≠ pravidla pro generov√°n√≠ k√≥du.
P≈ô√≠klad generuj√≠c√≠ho automatu naleznete v p≈ô√≠loze:

#      _______      ___________
# --->/ ERROR \--->/ NEXT_ITEM \---.
#     \_______/    \___________/<--'

5.3 (GNU) make
Dob≈ôe navr≈æen√Ω gener√°tor k√≥du se obvykle skl√°d√° z nƒõkolika men≈°√≠ch soubor≈Ø, jejich≈æ po≈ôad√≠, z√°vislosti a parametry se zapisuj√≠ do souboru Makefile.
Dobr√° znalost tvorby Makefile je proto z√°kladn√≠m p≈ôedpokladem pro zvl√°dnut√≠ M4.
ƒåten√≠ a √∫dr≈æba zdrojov√©ho k√≥du celkovƒõ zabere v≈ædy v√≠ce ƒçasu ne≈æ jeho tvorba.
Dob≈ôe strukturovan√Ω Makefile proto z√°sadn√≠m zp≈Øsobem p≈ôisp√≠v√° k celkov√© p≈ôehlednosti v√Ωsledn√©ho gener√°toru k√≥du.

üñπ Spou≈°tƒõn√≠ make[10] z editoru k√≥du pomoc√≠ vhodn√© kl√°vesov√© zkratky z√°sadnƒõ urychluje v√Ωvoj M4 k√≥du.
Soubor ~/.vimrc obsahuje nnoremap <c-j> :make<cr>.

5.4 Vim
Zvl√°dnut√≠ editoru Vim[11] je d≈Øle≈æit√Ωm p≈ôedpokladem pro pohodl√≠ a rychlost psan√≠ k√≥du M4.
Vim zkratky, definovan√© kl√≠ƒçov√Ωm slovem iabbrev, u≈°et≈ô√≠ velk√© mno≈æstv√≠ zbyteƒçnƒõ napsan√©ho textu.
Tyto zkratky tak√© v√Ωznamnƒõ sni≈æuj√≠ v√Ωskyt t√©mƒõ≈ô neviditeln√Ωch chyb zp≈Øsoben√Ωch nep√°rovou z√°vorkou, ƒç√≠m≈æ ≈°et≈ô√≠ ztracen√Ω ƒças vynalo≈æen√Ω na ladƒõn√≠ k√≥du.

5.5 Talent a ƒças
M4 obvykle nejde zcela zvl√°dnout p≈ôes v√≠kend, zvl√°≈°tƒõ chyb√≠-li z√°klady[12]
teorie automat≈Ø a form√°ln√≠ch gramatik.
Ke zvl√°dnut√≠ jazyka M4 je nutn√© v nƒõm programovat del≈°√≠ obdob√≠ a napsat mno≈æstv√≠ ≈°patn√©ho (slo≈æit√©ho) M4 k√≥du, kter√Ω z vlastn√≠ v≈Øle p≈ôep√≠≈°ete kv≈Øli lep≈°√≠mu n√°padu.
T√≠mto zp≈Øsobem je mo≈æn√© postupnƒõ z√≠skat praxi.

6 Odkazy
1. Generov√°n√≠ k√≥du v M4, ≈°ablona s p≈ô√≠klady pro www.root.cz
http://github.com/jkubin/m4root

2. A General Purpose Macro-generator, Computer Journal 8, 3 (1965), 225‚Äì41
http://dx.doi.org/10.1093/comjnl/8.3.225

3. RATFOR ‚Äî A Preprocessor for a Rational Fortran, Brian W. Kernighan
https://wolfram.schneider.org/bsd/7thEdManVol2/ratfor/ratfor.pdf

4. The M4 Macro Processor, Bell Laboratories (1977)
https://wolfram.schneider.org/bsd/7thEdManVol2/m4/m4.pdf

5. Christopher Strachey, Computer Hope ‚Äì Free computer help since 1998
https://www.computerhope.com/people/christopher_strachey.htm

6. Dennis Ritchie, Zomrel tvorca Unixu a jazyka C
https://pc.zoznam.sk/novinka/zomrel-tvorca-unixu-jazyka-c

7. Brian Kernighan, An Interview with Brian Kernighan
https://www.cs.cmu.edu/~mihaib/kernighan-interview/

8. GNU M4 - GNU macro processor, Free Software Foundation
https://www.gnu.org/software/m4/manual/

9. Teorie automat≈Ø, From Wikipedia, the free encyclopedia
https://cs.wikipedia.org/wiki/Teorie_automat%C5%AF

10. GNU Make Manual, Free Software Foundation
https://www.gnu.org/software/make/manual/make.html

11. Vim ‚Äì v≈°udyp≈ô√≠tomn√Ω textov√Ω editor, kter√Ω edituje text rychlost√≠ my≈°lenky
https://www.vim.org/

12. Automaty a form√°ln√≠ jazyky I, Uƒçebn√≠ text FI MU
https://is.muni.cz/elportal/estud/fi/js06/ib005/Formalni_jazyky_a_automaty_I.pdf

13. Automaty a gramatiky, Michal Chytil, 1. vyd√°n√≠, Praha, 331 s. 1984.
https://is.muni.cz/publication/173173

A P≈ô√≠klady generov√°n√≠ k√≥du
üõà Znaky {`', [], ‚êÇ‚êÜ, ‚ü¶‚üß} v n√°zvu p≈ô√≠kladu ≈ô√≠d√≠ expanzi netermin√°l≈Ø.

	A.1 ‚ü¶‚üß Vstupn√≠ zdrojov√Ω k√≥d
	A.2 ‚ü¶‚üß CSV: nejjednodu≈°≈°√≠ p≈ô√≠klad
	A.3 ‚ü¶‚üß CSV: poƒç√≠tadlo
	A.4 üí° √öpravy speci√°ln√≠ch znak≈Ø
	A.5 ‚ü¶‚üß C: v√Ωstupn√≠ fronta
	A.6 ‚ü¶‚üß INI: extern√≠ p≈ô√≠kaz
	A.7 ‚ü¶‚üß .h: hex poƒç√≠tadlo
	A.8 ‚ü¶‚üß C: mal√Ω automat
	A.9 ‚ü¶‚üß C: mal√Ω automat 2
	A.10 ‚ü¶‚üß HTML: v√Ωstupn√≠ fronty
	A.11 ‚ü¶‚üß Vƒõtven√≠ gramatikou
	A.12 ‚ü¶‚üß JSON: generuj√≠c√≠ automat
		A.12.1 ‚ü¶‚üß JSON: pojmenovan√© fronty
		A.12.2 ‚ü¶‚üß JSON: generovan√© indexy front
	A.13 ‚ü¶‚üß INI: nespojit√Ω index front
	A.14 ‚ü¶‚üß XML: sm√≠≈°en√© zpr√°vy
	A.15 ‚ü¶‚üß XML: oddƒõlen√© zpr√°vy
	A.16 ‚ü¶‚üß Bash $ echo "≈ôetƒõzec"
	A.17 ‚ü¶‚üß Bash $ echo '≈ôetƒõzec'

üñπ P≈ô√≠klady v t√©to p≈ô√≠loze jsou slo≈æitƒõj≈°√≠ a jejich c√≠lem je uk√°zat praktick√© pou≈æit√≠ jazyka M4.
Podrobnƒõji budou vysvƒõtleny pozdƒõji.

A.1 ‚ü¶‚üß Vstupn√≠ zdrojov√Ω k√≥d
Vstupn√≠ zdrojov√Ω k√≥d je podobn√Ω CSV, kter√Ω se p≈ôevede na libovolnƒõ slo≈æit√Ω c√≠lov√Ω k√≥d jin√©ho jazyka pomoc√≠ CFG, automat≈Ø a v√Ωstupn√≠ch front.
Z√°sobn√≠ky v p≈ô√≠kladech nejsou pou≈æity.
Vstupn√≠ zdrojov√Ω k√≥d obsahuje speci√°ln√≠ znaky, kter√© je nutn√© skr√Ωt:

55ac1ea messages/messages_raw.mc
  1 # 2018/05/15 Josef Kubin
  2 
  3 ERROR(‚ü¶COMPLEX‚üß,     ‚ü¶!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~‚üß)
  4 QUERY(‚ü¶READABLE‚üß,    ‚ü¶Is badly written M4 code readable [N/y]?‚üß)
  5 ERROR(‚ü¶SUCCESS‚üß,     ‚ü¶Too complex M4 code failed successfully.‚üß)
  6 WARNING(‚ü¶ADDICTIVE‚üß, ‚ü¶Programming in M4 is addictive!‚üß)
  7 ERROR(‚ü¶NO_FAULT‚üß,    ‚ü¶It's not a language fault!‚üß)
  8 WARNING(‚ü¶NO_ERRORS‚üß, ‚ü¶No other errors were found.‚üß)

üñπ Vstupn√≠ soubor m≈Ø≈æe tak√© obsahovat pozn√°mky, kter√© nemus√≠ b√Ωt skryt√© v koment√°≈ô√≠ch #, dnl, ifelse([‚Ä¶]) nebo [‚Ä¶ nƒõkde uvnit≈ô z√°vorek ‚Ä¶].

A.2 ‚ü¶‚üß CSV: nejjednodu≈°≈°√≠ p≈ô√≠klad
Tento p≈ô√≠klad nepou≈æ√≠v√° v√Ωstupn√≠ fronty, pouze vypisuje CSV oddƒõlen√© znakem TAB na standardn√≠ v√Ωstup.

24fd4f3 messages/hello.csv.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶ERROR‚üß, ‚ü¶
  3 
  4 	divert(0)dnl
  5 ‚ü¶$1	$2‚üß
  6 divert(-1)
  7 ‚üß)

$ m4 root0u.m4 hello.csv.m4 messages_raw.mc > hello.csv

55ac1ea messages/hello.csv
  1 COMPLEX	!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~
  2 SUCCESS	Too complex M4 code failed successfully.
  3 NO_FAULT	It's not a language fault!

A.3 ‚ü¶‚üß CSV: poƒç√≠tadlo
P≈ô√≠klad pou≈æ√≠v√° makro COUNT_UP ze souboru countb.m4, jeho≈æ Œ≤ se zkop√≠ruje do prav√© strany makra COUNTER.
Bƒõhem prvn√≠ expanze COUNTER probƒõhne inicializace jeho startovac√≠ hodnoty.
Dal≈°√≠ expanze vr√°t√≠ ƒç√≠seln√Ω termin√°ln√≠ symbol a probƒõhne zv√Ω≈°en√≠ vnit≈ôn√≠ho pomocn√©ho (glob√°ln√≠ho) symbolu o jedniƒçku.
COUNTER je mal√Ω automat.

24fd4f3 messages/counter.csv.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶COUNTER‚üß, defn(‚ü¶COUNT_UP‚üß))
  3 
  4 # init counter
  5 COUNTER(1)
  6 
  7 # A ‚Üí Œ≤
  8 define(‚ü¶ERROR‚üß, ‚ü¶
  9 
 10 	divert(0)dnl
 11 ERR_‚ü¶‚üßCOUNTER	‚ü¶$1	$2‚üß
 12 divert(-1)
 13 ‚üß)

$ m4 root0u.m4 countb.m4 counter.csv.m4 messages_raw.mc > counter.csv

55ac1ea messages/counter.csv
  1 ERR_1	COMPLEX	!"#$%&'()*+,-./:;<=>?@[\]^_`{|}~
  2 ERR_2	SUCCESS	Too complex M4 code failed successfully.
  3 ERR_3	NO_FAULT	It's not a language fault!

A.4 üí° √öpravy speci√°ln√≠ch znak≈Ø
Ka≈æd√Ω typ v√Ωstupn√≠ho k√≥du vy≈æaduje √∫pravu speci√°ln√≠ch znak≈Ø.
Kl√≠ƒçov√© slovo jazyka M4 patsubst() je nevhodn√© pro tento √∫kol.
V≈°echny speci√°ln√≠ znaky vstupn√≠ho souboru proto nap≈ôed skryjeme do vhodnƒõ pojmenovan√Ωch maker pomoc√≠ regul√°rn√≠ch v√Ωraz≈Ø.

Upraven√Ω vstupn√≠ k√≥d
55ac1ea messages/messages.mc
  1 # 2018/05/15 Josef Kubin
  2 
  3 ERROR(‚ü¶COMPLEX‚üß,     ‚ü¶‚ü¶‚üßEX()‚ü¶‚üßDQ()‚ü¶#‚üß‚ü¶‚üßDO()%‚ü¶‚üßAMP()‚ü¶‚üßAP()()*+,-./:;‚ü¶‚üßLT()=‚ü¶‚üßGT()?@[‚ü¶‚üßBS()]^_‚ü¶‚üßBQ(){|}~‚üß)
  4 QUERY(‚ü¶READABLE‚üß,    ‚ü¶Is badly written M4 code readable [N/y]?‚üß)
  5 ERROR(‚ü¶SUCCESS‚üß,     ‚ü¶Too complex M4 code failed successfully.‚üß)
  6 WARNING(‚ü¶ADDICTIVE‚üß, ‚ü¶Programming in M4 is addictive‚ü¶‚üßEX()‚üß)
  7 ERROR(‚ü¶NO_FAULT‚üß,    ‚ü¶It‚ü¶‚üßAP()s not a language fault‚ü¶‚üßEX()‚üß)
  8 WARNING(‚ü¶NO_ERRORS‚üß, ‚ü¶No other errors were found.‚üß)

‚ü¶‚üß P≈ôevodn√≠ soubor pro XML, XSLT, HTML
d2707ad messages/markup.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶AMP‚üß, ‚ü¶&amp;‚üß)
  3 define(‚ü¶AP‚üß, ‚ü¶'‚üß)
  4 define(‚ü¶BQ‚üß, ‚ü¶`‚üß)
  5 define(‚ü¶BS‚üß, ‚ü¶\‚üß)
  6 define(‚ü¶DO‚üß, ‚ü¶$‚üß)
  7 define(‚ü¶DQ‚üß, ‚ü¶"‚üß)
  8 define(‚ü¶EX‚üß, ‚ü¶!‚üß)
  9 define(‚ü¶GT‚üß, ‚ü¶&gt;‚üß)
 10 define(‚ü¶LT‚üß, ‚ü¶&lt;‚üß)

‚ü¶‚üß P≈ôevodn√≠ soubor pro C, JSON, INI: "≈ôetƒõzec"
d2707ad messages/code.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶AMP‚üß, ‚ü¶&‚üß)
  3 define(‚ü¶AP‚üß, ‚ü¶'‚üß)
  4 define(‚ü¶BQ‚üß, ‚ü¶`‚üß)
  5 define(‚ü¶BS‚üß, ‚ü¶\\‚üß)
  6 define(‚ü¶DO‚üß, ‚ü¶$‚üß)
  7 define(‚ü¶DQ‚üß, ‚ü¶\"‚üß)
  8 define(‚ü¶EX‚üß, ‚ü¶!‚üß)
  9 define(‚ü¶GT‚üß, ‚ü¶>‚üß)
 10 define(‚ü¶LT‚üß, ‚ü¶<‚üß)

‚ü¶‚üß P≈ôevodn√≠ soubor pro Bash: "≈ôetƒõzec"
d2707ad messages/doubleq.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶AMP‚üß, ‚ü¶&‚üß)
  3 define(‚ü¶AP‚üß, ‚ü¶'‚üß)
  4 define(‚ü¶BQ‚üß, ‚ü¶\`‚üß)
  5 define(‚ü¶BS‚üß, ‚ü¶\\‚üß)
  6 define(‚ü¶DO‚üß, ‚ü¶$‚üß)
  7 define(‚ü¶DQ‚üß, ‚ü¶\"‚üß)
  8 define(‚ü¶EX‚üß, ‚ü¶"\!"‚üß)
  9 define(‚ü¶GT‚üß, ‚ü¶>‚üß)
 10 define(‚ü¶LT‚üß, ‚ü¶<‚üß)

‚ü¶‚üß P≈ôevodn√≠ soubor pro Bash: '≈ôetƒõzec'
d2707ad messages/apost.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶AMP‚üß, ‚ü¶&‚üß)
  3 define(‚ü¶AP‚üß, ‚ü¶'\''‚üß)
  4 define(‚ü¶BQ‚üß, ‚ü¶`‚üß)
  5 define(‚ü¶BS‚üß, ‚ü¶\‚üß)
  6 define(‚ü¶DO‚üß, ‚ü¶$‚üß)
  7 define(‚ü¶DQ‚üß, ‚ü¶"‚üß)
  8 define(‚ü¶EX‚üß, ‚ü¶!‚üß)
  9 define(‚ü¶GT‚üß, ‚ü¶>‚üß)
 10 define(‚ü¶LT‚üß, ‚ü¶<‚üß)

‚ü¶‚üß P≈ôevodn√≠ soubor pro CSV, M4 (vr√°t√≠ v≈°echny znaky zp√°tky)
d2707ad messages/unchanged.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶AMP‚üß, ‚ü¶&‚üß)
  3 define(‚ü¶AP‚üß, ‚ü¶'‚üß)
  4 define(‚ü¶BQ‚üß, ‚ü¶`‚üß)
  5 define(‚ü¶BS‚üß, ‚ü¶\‚üß)
  6 define(‚ü¶DO‚üß, ‚ü¶$‚üß)
  7 define(‚ü¶DQ‚üß, ‚ü¶"‚üß)
  8 define(‚ü¶EX‚üß, ‚ü¶!‚üß)
  9 define(‚ü¶GT‚üß, ‚ü¶>‚üß)
 10 define(‚ü¶LT‚üß, ‚ü¶<‚üß)

A.5 ‚ü¶‚üß C: v√Ωstupn√≠ fronta
P≈ô√≠klad pou≈æ√≠v√° jednu v√Ωstupn√≠ frontu na znaky }; pro uzav≈ôen√≠ pole na konci skriptu.

24fd4f3 messages/array.c.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶ERROR‚üß, ‚ü¶
  3 
  4 	divert(0)dnl
  5 	"$2",
  6 divert(-1)
  7 ‚üß)
  8 
  9 divert(0)dnl
 10 /*
 11  * DONTE()
 12  */
 13 
 14 char *error[] = {
 15 divert(1)dnl
 16 };
 17 divert(-1)

$ m4 root0u.m4 array.c.m4 code.m4 messages.mc > array.c

9156810 messages/array.c
  1 /*
  2  * DO NOT EDIT! This file is generated automatically!
  3  */
  4 
  5 char *error[] = {
  6 	"!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~",
  7 	"Too complex M4 code failed successfully.",
  8 	"It's not a language fault!",
  9 };

A.6 ‚ü¶‚üß INI: extern√≠ p≈ô√≠kaz
P≈ô√≠klad spust√≠ extern√≠ p≈ô√≠kaz date a jeho v√Ωstup um√≠st√≠ do hranat√Ωch z√°vorek.
V√Ωstupem extern√≠ho p≈ô√≠kazu jsou dvƒõ polo≈æky oddƒõlen√© ƒç√°rkou.
Makro SARG1() vybere prvn√≠ polo≈æku, proto≈æe druh√° polo≈æka obsahuje ne≈æ√°douc√≠ znak nov√©ho ≈ô√°dku LF (0x0a).

24fd4f3 messages/hello.ini.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶ERROR‚üß, ‚ü¶
  3 
  4 	divert(0)dnl
  5 ‚ü¶$1‚üß="$2"
  6 divert(-1)
  7 ‚üß)
  8 
  9 divert(0)dnl
 10 ; DONTE()
 11 
 12 SARG1(esyscmd(‚ü¶date '+‚ü¶[hello_%Y%m%d]‚üß,'‚üß))
 13 divert(-1)

$ m4 root0u.m4 hello.ini.m4 code.m4 messages.mc > hello.ini

55ac1ea messages/hello.ini
  1 ; DO NOT EDIT! This file is generated automatically!
  2 
  3 [hello_20201230]
  4 COMPLEX="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~"
  5 SUCCESS="Too complex M4 code failed successfully."
  6 NO_FAULT="It's not a language fault!"

A.7 ‚ü¶‚üß .h: hex poƒç√≠tadlo
P≈ô√≠klad pou≈æ√≠v√° makro COUNTER pro ƒç√≠slov√°n√≠ v√Ωsledn√Ωch CPP maker a jednu v√Ωstupn√≠ frontu.
Fronta ƒç√≠slo 1 obsahuje direktivu preprocesoru #endif pro zakonƒçen√≠ hlaviƒçkov√©ho souboru.
P≈ôevod dekadick√© hodnoty poƒç√≠tadla na dvoum√≠stn√© hex-a ƒç√≠slo prov√°d√≠ kl√≠ƒçov√© slovo eval().

24fd4f3 messages/messages.h.m4
  1 # A ‚Üí Œ≤
  2 define(‚ü¶COUNTER‚üß, defn(‚ü¶COUNT_UP‚üß))
  3 
  4 # init counter
  5 COUNTER(0)
  6 
  7 # A ‚Üí Œ≤
  8 define(‚ü¶ERROR‚üß, ‚ü¶
  9 
 10 	divert(0)dnl
 11 ‚ü¶#define $1		0x‚üßeval(COUNTER, 16, 2)
 12 divert(-1)
 13 ‚üß)
 14 
 15 divert(0)dnl
 16 /*
 17  * DONTE()
 18  */
 19 
 20 #ifndef __ERROR_H
 21 #define __ERROR_H
 22 
 23 divert(1)
 24 #endif /* __ERROR_H */
 25 divert(-1)

$ m4 root0u.m4 countb.m4 messages.h.m4 messages.mc > messages.h

55ac1ea messages/messages.h
  1 /*
  2  * DO NOT EDIT! This file is generated automatically!
  3  */
  4 
  5 #ifndef __ERROR_H
  6 #define __ERROR_H
  7 
  8 #define COMPLEX		0x00
  9 #define SUCCESS		0x01
 10 #define NO_FAULT		0x02
 11 
 12 #endif /* __ERROR_H */

A.8 ‚ü¶‚üß C: mal√Ω automat
P≈ô√≠klad pou≈æ√≠v√° mal√Ω automat NEW_LINE pro generov√°n√≠ znaku nov√©ho ≈ô√°dku \n a jednu v√Ωstupn√≠ frontu ƒç√≠slo 1 do kter√© se vlo≈æ√≠ znaky "; pro uzav≈ôen√≠ v√Ωsledn√©ho ≈ôetƒõzce.
Poprv√© se NEW_LINE p≈ôep√≠≈°e na Œµ, podruh√© a d√°le se p≈ôep√≠≈°e na \n.

24fd4f3 messages/stringl.c.m4
  1 #     NEW_LINE automaton
  2 #      ___      ____
  3 # --->/ Œµ \--->/ \n \---.
  4 #     \___/    \____/<--'
  5 
  6 # A ‚Üí Œ≤
  7 define(‚ü¶NEW_LINE‚üß, ‚ü¶define(‚ü¶$0‚üß, ‚ü¶\n‚üß)‚üß)
  8 
  9 # A ‚Üí Œ≤
 10 define(‚ü¶ERROR‚üß, ‚ü¶
 11 
 12 	divert(0)NEW_LINE‚ü¶‚üß$2‚ü¶‚üßdnl
 13 divert(-1)
 14 ‚üß)
 15 
 16 divert(0)dnl
 17 /*
 18  * DONTE()
 19  */
 20 
 21 char error[] =
 22 "divert(1)";
 23 divert(-1)

$ m4 root0u.m4 stringl.c.m4 code.m4 messages.mc > stringl.c

9156810 messages/stringl.c
  1 /*
  2  * DO NOT EDIT! This file is generated automatically!
  3  */
  4 
  5 char error[] =
  6 "!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~\nToo complex M4 code failed successfully.\nIt's not a language fault!";

A.9 ‚ü¶‚üß C: mal√Ω automat 2
Tento p≈ô√≠klad je podobn√Ω p≈ôedchoz√≠mu, av≈°ak ka≈æd√Ω ≈ôetƒõzec je na nov√©m ≈ô√°dku.

24fd4f3 messages/string.c.m4
  1 #      NEW_LINE automaton
  2 #      ___      _________
  3 # --->/ Œµ \--->/ \n"\xa" \---.
  4 #     \___/    \_________/<--'
  5 
  6 # A ‚Üí Œ≤
  7 define(‚ü¶NEW_LINE‚üß, ‚ü¶define(‚ü¶$0‚üß, ‚ü¶\n"
  8 "‚üß)‚üß)
  9 
 10 # A ‚Üí Œ≤
 11 define(‚ü¶ERROR‚üß, ‚ü¶
 12 
 13 	divert(0)NEW_LINE‚ü¶‚üß$2‚ü¶‚üßdnl
 14 divert(-1)
 15 ‚üß)
 16 
 17 divert(0)dnl
 18 /*
 19  * DONTE()
 20  */
 21 
 22 char error[] =
 23 "divert(1)";
 24 divert(-1)

$ m4 root0u.m4 string.c.m4 code.m4 messages.mc > string.c

9156810 messages/string.c
  1 /*
  2  * DO NOT EDIT! This file is generated automatically!
  3  */
  4 
  5 char error[] =
  6 "!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~\n"
  7 "Too complex M4 code failed successfully.\n"
  8 "It's not a language fault!";

A.10 ‚ü¶‚üß HTML: v√Ωstupn√≠ fronty
P≈ô√≠klad pou≈æ√≠v√° dvƒõ v√Ωstupn√≠ fronty.
Fronta ƒç√≠slo 1 obsahuje odstavce,
fronta ƒç√≠slo 2 uzav√≠rac√≠ znaƒçky HTML str√°nky.
Navigaƒçn√≠ odkazy nemus√≠ b√Ωt nikde ulo≈æeny, jdou p≈ô√≠mo na v√Ωstup.
Zpr√°vy typu QUERY a WARNING jsou zpracov√°ny stejnƒõ jako zpr√°vy typu ERROR.

24fd4f3 messages/messages.html.m4
  1 # vim:ft=m4
  2 
  3 # A ‚Üí Œ≤
  4 # Œ≤
  5 define(‚ü¶ERROR‚üß, ‚ü¶
  6 
  7 	divert(0)dnl
  8 		‚ü¶<li>$0: <a href="#$1">$1</a></li>‚üß
  9 divert(1)dnl
 10 	<p id="‚ü¶$1‚üß">$2</p>
 11 divert(-1)
 12 ‚üß)
 13 
 14 # A ‚Üí Œ≤
 15 define(‚ü¶QUERY‚üß, defn(‚ü¶ERROR‚üß))
 16 define(‚ü¶WARNING‚üß, defn(‚ü¶ERROR‚üß))
 17 
 18 divert(0)dnl
 19 <!-- DONTE() -->
 20 <!doctype html>
 21 <html lang="en">
 22 	<meta charset="utf-8">
 23 	<title>__file__</title>
 24 <body>
 25 	<h1>The power of M4</h1>
 26 	<ul>
 27 divert(1)dnl
 28 	</ul>
 29 divert(2)dnl
 30 </body>
 31 </html>
 32 divert(-1)

$ m4 root0u.m4 messages.html.m4 markup.m4 messages.mc > messages.html

55ac1ea messages/messages.html
  1 <!-- DO NOT EDIT! This file is generated automatically! -->
  2 <!doctype html>
  3 <html lang="en">
  4 	<meta charset="utf-8">
  5 	<title>messages.html.m4</title>
  6 <body>
  7 	<h1>The power of M4</h1>
  8 	<ul>
  9 		<li>ERROR: <a href="#COMPLEX">COMPLEX</a></li>
 10 		<li>QUERY: <a href="#READABLE">READABLE</a></li>
 11 		<li>ERROR: <a href="#SUCCESS">SUCCESS</a></li>
 12 		<li>WARNING: <a href="#ADDICTIVE">ADDICTIVE</a></li>
 13 		<li>ERROR: <a href="#NO_FAULT">NO_FAULT</a></li>
 14 		<li>WARNING: <a href="#NO_ERRORS">NO_ERRORS</a></li>
 15 	</ul>
 16 	<p id="COMPLEX">!"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\]^_`{|}~</p>
 17 	<p id="READABLE">Is badly written M4 code readable [N/y]?</p>
 18 	<p id="SUCCESS">Too complex M4 code failed successfully.</p>
 19 	<p id="ADDICTIVE">Programming in M4 is addictive!</p>
 20 	<p id="NO_FAULT">It's not a language fault!</p>
 21 	<p id="NO_ERRORS">No other errors were found.</p>
 22 </body>
 23 </html>

A.11 ‚ü¶‚üß Vƒõtven√≠ gramatikou
P≈ô√≠klad ukazuje vƒõtven√≠ gramatikou, argumenty maker se ignoruj√≠.
Vstupn√≠ netermin√°ly se p≈ôepisuj√≠ na termin√°ly ERROR ‚Üí üêõ,
QUERY ‚Üí üêú,
WARNING ‚Üí üêù.

24fd4f3 messages/insect.txt.m4
  1 # A ‚Üí Œ≤
  2 # Œ≤
  3 define(‚ü¶ERROR‚üß, ‚ü¶
  4 
  5 	divert(0)dnl
  6 $0_INSECT‚ü¶‚üßdnl
  7 divert(-1)
  8 ‚üß)
  9 
 10 # A ‚Üí Œ≤
 11 define(‚ü¶QUERY‚üß,   defn(‚ü¶ERROR‚üß))
 12 define(‚ü¶WARNING‚üß, defn(‚ü¶ERROR‚üß))
 13 define(‚ü¶ERROR_INSECT‚üß,   ‚ü¶üêõ‚üß)
 14 define(‚ü¶QUERY_INSECT‚üß,   ‚ü¶üêú‚üß)
 15 define(‚ü¶WARNING_INSECT‚üß, ‚ü¶üêù‚üß)

$ m4 root0u.m4 insect.txt.m4 messages.mc > insect.txt

b53eafe messages/insect.txt
  1 üêõüêúüêõüêùüêõüêù

Vƒõtven√≠ gramatikou ‚Äì z√°kladn√≠ princip
Promƒõnn√° $0 se nahrad√≠ za jm√©no makra a z≈ôetƒõz√≠ se s dal≈°√≠m symbolem.
Novƒõ vznikl√Ω netermin√°l se p≈ôep√≠≈°e na odpov√≠daj√≠c√≠ termin√°ln√≠ symbol (ƒç√≠slo fronty nebo jm√©no).

$0_QU ‚Üí ERROR_QU ‚Üí 2
$0_END ‚Üí ERROR_END ‚Üí 3
$0_NAME ‚Üí ERROR_NAME ‚Üí error
$0_QU ‚Üí QUERY_QU ‚Üí 0
$0_END ‚Üí QUERY_END ‚Üí 1
$0_NAME ‚Üí QUERY_NAME ‚Üí query
‚Ä¶

A.12 ‚ü¶‚üß JSON: generuj√≠c√≠ automat
P≈ô√≠klad pou≈æ√≠v√° dvƒõ v√Ωstupn√≠ fronty a jeden generuj√≠c√≠ automat.
Prvn√≠ chybov√° zpr√°va ERROR(‚ü¶‚Ä¶‚üß) ve stavu ERROR vygeneruje z√°hlav√≠ se z√°vorkami a vyp√≠≈°e na v√Ωstup prvn√≠ z√°znam.
Automat p≈ôejde do stavu NEXT_ITEM co≈æ je Œ≤ pravidlo.
N√°sleduj√≠c√≠ chybov√© zpr√°vy ve stavu NEXT_ITEM pouze vypisuj√≠ na v√Ωstup jednotliv√© z√°znamy.
Na z√°vƒõr v√Ωstupn√≠ fronty ƒç√≠slo 1 a 2 vyp√≠≈°ou znaky ] a }} ƒç√≠m≈æ zakonƒç√≠ v√Ωsledn√Ω JSON.

24fd4f3 messages/atm.json.m4
  1 #      _______      ___________
  2 # --->/ ERROR \--->/ NEXT_ITEM \---.
  3 #     \_______/    \___________/<--'
  4 
  5 # A ‚Üí Œ≤
  6 define(‚ü¶ERROR‚üß, ‚ü¶
  7 
  8 	# transition to the next node
  9 	define(‚ü¶$0‚üß, defn(‚ü¶NEXT_ITEM‚üß))
 10 
 11 	divert(0),
 12 	"error": [
 13 		{"‚ü¶$1‚üß": "$2"}dnl
 14 divert(1)
 15 	]
 16 divert(-1)
 17 ‚üß)
 18 
 19 # Œ≤
 20 define(‚ü¶NEXT_ITEM‚üß, ‚ü¶
 21 
 22 	divert(0),
 23 		{"‚ü¶$1‚üß": "$2"}dnl
 24 divert(-1)
 25 ‚üß)
 26 
 27 divert(0)dnl
 28 {"generating_automaton": {
 29 	"_comment": "DONTE()"dnl
 30 divert(2)dnl
 31 }}
 32 divert(-1)

$ m4 root0u.m4 atm.json.m4 code.m4 messages.mc > atm.json

55ac1ea messages/atm.json
  1 {"generating_automaton": {
  2 	"_comment": "DO NOT EDIT! This file is generated automatically!",
  3 	"error": [
  4 		{"COMPLEX": "!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~"},
  5 		{"SUCCESS": "Too complex M4 code failed successfully."},
  6 		{"NO_FAULT": "It's not a language fault!"}
  7 	]
  8 }}

A.12.1 ‚ü¶‚üß JSON: pojmenovan√© fronty
P≈ô√≠klad zpracov√°v√° dal≈°√≠ zpr√°vy typu QUERY a WARNING.
Pou≈æ√≠v√° t≈ôi automaty a ≈°est v√Ωstupn√≠ch front.
Generujeme-li slo≈æitƒõj≈°√≠ zdrojov√Ω k√≥d, brzy naraz√≠me na probl√©m udr≈æen√≠ konzistence index≈Ø pro v√Ωstupn√≠ fronty.
Abychom se vyhnuli zmatku, pojmenujeme si fronty a m√≠sto ƒç√≠sel pou≈æ√≠v√°me jm√©na.
Abychom nemuseli definovat podobn√° pravidla, zkop√≠rujeme si pravou stranu ERROR (je to tak√© Œ≤ pravidlo) do prav√© strany pravidel QUERY a WARNING.

24fd4f3 messages/qnames.json.m4
  1 # DO NOT WRITE INDEXES MANUALLY, use counter!
  2 define(‚ü¶QUERY_QU‚üß,     0)
  3 define(‚ü¶QUERY_END‚üß,    1)
  4 define(‚ü¶ERROR_QU‚üß,     2)
  5 define(‚ü¶ERROR_END‚üß,    3)
  6 define(‚ü¶WARNING_QU‚üß,   4)
  7 define(‚ü¶WARNING_END‚üß,  5)
  8 define(‚ü¶LAST_QUEUE‚üß,   6)
  9 
 10 # names of message types
 11 define(‚ü¶WARNING_NAME‚üß, ‚ü¶warning‚üß)
 12 define(‚ü¶ERROR_NAME‚üß,   ‚ü¶error‚üß)
 13 define(‚ü¶QUERY_NAME‚üß,   ‚ü¶query‚üß)
 14 
 15 #      _________      ___________
 16 # --->/  ERROR  \--->/ NEXT_ITEM \---.
 17 #     |  QUERY  |    \___________/<--'
 18 #     \_WARNING_/
 19 
 20 # A ‚Üí Œ≤
 21 # Œ≤
 22 define(‚ü¶ERROR‚üß, ‚ü¶
 23 
 24 	# transition to the next node
 25 	define(‚ü¶$0‚üß, defn(‚ü¶NEXT_ITEM‚üß))
 26 
 27 	divert($0_QU),
 28 	"$0_NAME": [
 29 		{"‚ü¶$1‚üß": "$2"}dnl
 30 divert($0_END)
 31 	]dnl
 32 divert(-1)
 33 ‚üß)
 34 
 35 # Œ≤
 36 define(‚ü¶NEXT_ITEM‚üß, ‚ü¶
 37 
 38 	divert($0_QU),
 39 		{"‚ü¶$1‚üß": "$2"}dnl
 40 divert(-1)
 41 ‚üß)
 42 
 43 # A ‚Üí Œ≤
 44 define(‚ü¶QUERY‚üß,        defn(‚ü¶ERROR‚üß))
 45 define(‚ü¶WARNING‚üß,      defn(‚ü¶ERROR‚üß))
 46 
 47 divert(0)dnl
 48 {"queue_names": {
 49 	"_comment": "DONTE()"dnl
 50 divert(LAST_QUEUE)
 51 }}
 52 divert(-1)

$ m4 root0u.m4 qnames.json.m4 code.m4 messages.mc > qnames.json

55ac1ea messages/qnames.json
  1 {"queue_names": {
  2 	"_comment": "DO NOT EDIT! This file is generated automatically!",
  3 	"query": [
  4 		{"READABLE": "Is badly written M4 code readable [N/y]?"}
  5 	],
  6 	"error": [
  7 		{"COMPLEX": "!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~"},
  8 		{"SUCCESS": "Too complex M4 code failed successfully."},
  9 		{"NO_FAULT": "It's not a language fault!"}
 10 	],
 11 	"warning": [
 12 		{"ADDICTIVE": "Programming in M4 is addictive!"},
 13 		{"NO_ERRORS": "No other errors were found."}
 14 	]
 15 }}

A.12.2 ‚ü¶‚üß JSON: generovan√© indexy front
Bƒõhem v√Ωvoje se ƒçasto mƒõn√≠ po≈ôad√≠ a poƒçet v√Ωstupn√≠ch front, co≈æ tak√© vy≈æaduje ƒçastou zmƒõnu jejich index≈Ø.
Indexy je proto vhodn√© generovat.
M≈Ø≈æeme pak pou≈æ√≠vat prakticky neomezen√Ω poƒçet front.
N√°sleduj√≠c√≠ p≈ô√≠klad ukazuje, jak se tyto indexy generuj√≠.

24fd4f3 messages/queues.m4
  1 # defines a counter for output queues
  2 # A ‚Üí Œ≤
  3 define(‚ü¶QUEUE_INDEX‚üß, defn(‚ü¶COUNT_UP‚üß))
  4 
  5 # index of the first output queue (0 is stdout)
  6 QUEUE_INDEX(0)
  7 
  8 # symbolic names for indices of output queues
  9 # A ‚Üí Œ≤
 10 define(‚ü¶QUERY_QU‚üß,     QUEUE_INDEX)
 11 define(‚ü¶QUERY_END‚üß,    QUEUE_INDEX)
 12 define(‚ü¶ERROR_QU‚üß,     QUEUE_INDEX)
 13 define(‚ü¶ERROR_END‚üß,    QUEUE_INDEX)
 14 define(‚ü¶WARNING_QU‚üß,   QUEUE_INDEX)
 15 define(‚ü¶WARNING_END‚üß,  QUEUE_INDEX)
 16 # Keep it last!
 17 define(‚ü¶LAST_QUEUE‚üß,   QUEUE_INDEX)
 18 
 19 # names of message types
 20 # A ‚Üí Œ≤
 21 define(‚ü¶WARNING_NAME‚üß, ‚ü¶warning‚üß)
 22 define(‚ü¶ERROR_NAME‚üß,   ‚ü¶error‚üß)
 23 define(‚ü¶QUERY_NAME‚üß,   ‚ü¶query‚üß)

24fd4f3 messages/messages.json.m4
  1 #      _________      ___________
  2 # --->/  ERROR  \--->/ NEXT_ITEM \---.
  3 #     |  QUERY  |    \___________/<--'
  4 #     \_WARNING_/
  5 
  6 # A ‚Üí Œ≤
  7 # Œ≤
  8 define(‚ü¶ERROR‚üß, ‚ü¶
  9 
 10 	# transition to the next node
 11 	define(‚ü¶$0‚üß, defn(‚ü¶NEXT_ITEM‚üß))
 12 
 13 	divert($0_QU),
 14 	"$0_NAME": [
 15 		{"‚ü¶$1‚üß": "$2"}dnl
 16 divert($0_END)
 17 	]dnl
 18 divert(-1)
 19 ‚üß)
 20 
 21 # Œ≤
 22 define(‚ü¶NEXT_ITEM‚üß, ‚ü¶
 23 
 24 	divert($0_QU),
 25 		{"‚ü¶$1‚üß": "$2"}dnl
 26 divert(-1)
 27 ‚üß)
 28 
 29 # A ‚Üí Œ≤
 30 define(‚ü¶QUERY‚üß,   defn(‚ü¶ERROR‚üß))
 31 define(‚ü¶WARNING‚üß, defn(‚ü¶ERROR‚üß))
 32 
 33 divert(0)dnl
 34 {"messages": {
 35 	"_comment": "DONTE()"dnl
 36 divert(LAST_QUEUE)
 37 }}
 38 divert(-1)

$ m4 root0u.m4 countb.m4 queues.m4 messages.json.m4 code.m4 messages.mc > messages.json

55ac1ea messages/messages.json
  1 {"messages": {
  2 	"_comment": "DO NOT EDIT! This file is generated automatically!",
  3 	"query": [
  4 		{"READABLE": "Is badly written M4 code readable [N/y]?"}
  5 	],
  6 	"error": [
  7 		{"COMPLEX": "!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~"},
  8 		{"SUCCESS": "Too complex M4 code failed successfully."},
  9 		{"NO_FAULT": "It's not a language fault!"}
 10 	],
 11 	"warning": [
 12 		{"ADDICTIVE": "Programming in M4 is addictive!"},
 13 		{"NO_ERRORS": "No other errors were found."}
 14 	]
 15 }}

A.13 ‚ü¶‚üß INI: nespojit√Ω index front
P≈ô√≠klad pou≈æ√≠v√° t≈ôi automaty a dvƒõ v√Ωstupn√≠ fronty ƒç√≠slo 2 a 4 definovan√© v oddƒõlen√©m souboru.
N√°zvy INI sekc√≠ jsou generov√°ny ≈ôetƒõzen√≠m symbol≈Ø (viz. vƒõtven√≠).
P≈ô√≠klad pou≈æ√≠v√° stejn√Ω soubor pro v√Ωstupn√≠ fronty jako p≈ô√≠klad pro generov√°n√≠ JSON.

24fd4f3 messages/messages.ini.m4
  1 #      _________      ___________
  2 # --->/  ERROR  \--->/ NEXT_ITEM \---.
  3 #     |  QUERY  |    \___________/<--'
  4 #     \_WARNING_/
  5 
  6 # A ‚Üí Œ≤
  7 # Œ≤
  8 define(‚ü¶ERROR‚üß, ‚ü¶
  9 
 10 	divert($0_QU)
 11 [$0_NAME]
 12 ‚ü¶$1‚üß="$2"
 13 divert(-1)
 14 
 15 	# transition to the next node
 16 	define(‚ü¶$0‚üß, defn(‚ü¶NEXT_ITEM‚üß))
 17 ‚üß)
 18 
 19 # A ‚Üí Œ≤
 20 define(‚ü¶QUERY‚üß,   defn(‚ü¶ERROR‚üß))
 21 define(‚ü¶WARNING‚üß, defn(‚ü¶ERROR‚üß))
 22 
 23 # Œ≤
 24 define(‚ü¶NEXT_ITEM‚üß, ‚ü¶
 25 
 26 	divert($0_QU)dnl
 27 ‚ü¶$1‚üß="$2"
 28 divert(-1)
 29 ‚üß)
 30 
 31 divert(0)dnl
 32 ; DONTE()
 33 divert(-1)

$ m4 root0u.m4 messages.ini.m4 countb.m4 queues.m4 code.m4 messages.mc > messages.ini

55ac1ea messages/messages.ini
  1 ; DO NOT EDIT! This file is generated automatically!
  2 
  3 [query]
  4 READABLE="Is badly written M4 code readable [N/y]?"
  5 
  6 [error]
  7 COMPLEX="!\"#$%&'()*+,-./:;<=>?@[\\]^_`{|}~"
  8 SUCCESS="Too complex M4 code failed successfully."
  9 NO_FAULT="It's not a language fault!"
 10 
 11 [warning]
 12 ADDICTIVE="Programming in M4 is addictive!"
 13 NO_ERRORS="No other errors were found."

A.14 ‚ü¶‚üß XML: sm√≠≈°en√© zpr√°vy
P≈ô√≠klad pou≈æ√≠v√° jednu v√Ωstupn√≠ frontu ƒç√≠slo 1 pro uzav√≠rac√≠ znaƒçku </messages>.

24fd4f3 messages/mixed.xml.m4
  1 # A ‚Üí Œ≤
  2 # Œ≤
  3 define(‚ü¶ERROR‚üß, ‚ü¶
  4 
  5 	divert(0)dnl
  6 	<$0_NAME>
  7 		<name>‚ü¶$1‚üß</name>
  8 		<value>$2</value>
  9 	</$0_NAME>
 10 divert(-1)
 11 ‚üß)
 12 
 13 # A ‚Üí Œ≤
 14 define(‚ü¶QUERY‚üß, defn(‚ü¶ERROR‚üß))
 15 define(‚ü¶WARNING‚üß, defn(‚ü¶ERROR‚üß))
 16 
 17 divert(0)dnl
 18 <!-- DONTE() -->
 19 <?xml version="1.0" encoding="utf-8"?>
 20 <messages>
 21 divert(1)dnl
 22 </messages>
 23 divert(-1)

$ m4 root0u.m4 queues.m4 mixed.xml.m4 markup.m4 messages.mc > mixed.xml

55ac1ea messages/mixed.xml
  1 <!-- DO NOT EDIT! This file is generated automatically! -->
  2 <?xml version="1.0" encoding="utf-8"?>
  3 <messages>
  4 	<error>
  5 		<name>COMPLEX</name>
  6 		<value>!"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\]^_`{|}~</value>
  7 	</error>
  8 	<query>
  9 		<name>READABLE</name>
 10 		<value>Is badly written M4 code readable [N/y]?</value>
 11 	</query>
 12 	<error>
 13 		<name>SUCCESS</name>
 14 		<value>Too complex M4 code failed successfully.</value>
 15 	</error>
 16 	<warning>
 17 		<name>ADDICTIVE</name>
 18 		<value>Programming in M4 is addictive!</value>
 19 	</warning>
 20 	<error>
 21 		<name>NO_FAULT</name>
 22 		<value>It's not a language fault!</value>
 23 	</error>
 24 	<warning>
 25 		<name>NO_ERRORS</name>
 26 		<value>No other errors were found.</value>
 27 	</warning>
 28 </messages>

A.15 ‚ü¶‚üß XML: oddƒõlen√© zpr√°vy
P≈ô√≠klad seskupuje zpr√°vy podle jejich typu pomoc√≠ v√Ωstupn√≠ch front.

24fd4f3 messages/messages.xml.m4
  1 # A ‚Üí Œ≤
  2 # Œ≤
  3 define(‚ü¶ERROR‚üß, ‚ü¶
  4 
  5 	# transition to the next node
  6 	define(‚ü¶$0‚üß, defn(‚ü¶NEXT_ITEM‚üß))
  7 
  8 	divert($0_QU)dnl
  9 	<$0_NAME>
 10 		<item>
 11 			<name>‚ü¶$1‚üß</name>
 12 			<value>$2</value>
 13 		</item>
 14 divert($0_END)dnl
 15 	</$0_NAME>
 16 divert(-1)
 17 ‚üß)
 18 
 19 # Œ≤
 20 define(‚ü¶NEXT_ITEM‚üß, ‚ü¶
 21 
 22 	divert($0_QU)dnl
 23 		<item>
 24 			<name>‚ü¶$1‚üß</name>
 25 			<value>$2</value>
 26 		</item>
 27 divert(-1)
 28 ‚üß)
 29 
 30 # A ‚Üí Œ≤
 31 define(‚ü¶QUERY‚üß,        defn(‚ü¶ERROR‚üß))
 32 define(‚ü¶WARNING‚üß,      defn(‚ü¶ERROR‚üß))
 33 
 34 divert(0)dnl
 35 <!-- DONTE() -->
 36 <?xml version="1.0" encoding="utf-8"?>
 37 <messages>
 38 divert(LAST_QUEUE)dnl
 39 </messages>
 40 divert(-1)

$ m4 root0u.m4 queues.m4 messages.xml.m4 markup.m4 messages.mc > messages.xml

55ac1ea messages/messages.xml
  1 <!-- DO NOT EDIT! This file is generated automatically! -->
  2 <?xml version="1.0" encoding="utf-8"?>
  3 <messages>
  4 	<query>
  5 		<item>
  6 			<name>READABLE</name>
  7 			<value>Is badly written M4 code readable [N/y]?</value>
  8 		</item>
  9 	</query>
 10 	<error>
 11 		<item>
 12 			<name>COMPLEX</name>
 13 			<value>!"#$%&amp;'()*+,-./:;&lt;=&gt;?@[\]^_`{|}~</value>
 14 		</item>
 15 		<item>
 16 			<name>SUCCESS</name>
 17 			<value>Too complex M4 code failed successfully.</value>
 18 		</item>
 19 		<item>
 20 			<name>NO_FAULT</name>
 21 			<value>It's not a language fault!</value>
 22 		</item>
 23 	</error>
 24 	<warning>
 25 		<item>
 26 			<name>ADDICTIVE</name>
 27 			<value>Programming in M4 is addictive!</value>
 28 		</item>
 29 		<item>
 30 			<name>NO_ERRORS</name>
 31 			<value>No other errors were found.</value>
 32 		</item>
 33 	</warning>
 34 </messages>

A.16 ‚ü¶‚üß Bash $ echo "≈ôetƒõzec"
24fd4f3 messages/doubleq.sh.m4
  1 # A ‚Üí Œ≤
  2 # Œ≤
  3 define(‚ü¶ERROR‚üß, ‚ü¶
  4 
  5 	divert(0)dnl
  6 echo "$2"
  7 divert(-1)
  8 ‚üß)
  9 
 10 # A ‚Üí Œ≤
 11 define(‚ü¶QUERY‚üß, defn(‚ü¶ERROR‚üß))
 12 define(‚ü¶WARNING‚üß, defn(‚ü¶ERROR‚üß))
 13 
 14 divert(0)dnl
 15 #!/bin/bash
 16 #
 17 ‚ü¶#‚üß DONTE()
 18 
 19 divert(-1)

$ m4 root0u.m4 doubleq.sh.m4 doubleq.m4 messages.mc > doubleq.sh

d2707ad messages/doubleq.sh
  1 #!/bin/bash
  2 #
  3 # DO NOT EDIT! This file is generated automatically!
  4 
  5 echo ""\!"\"#$%&'()*+,-./:;<=>?@[\\]^_\`{|}~"
  6 echo "Is badly written M4 code readable [N/y]?"
  7 echo "Too complex M4 code failed successfully."
  8 echo "Programming in M4 is addictive"\!""
  9 echo "It's not a language fault"\!""
 10 echo "No other errors were found."

A.17 ‚ü¶‚üß Bash $ echo '≈ôetƒõzec'
24fd4f3 messages/apost.sh.m4
  1 # A ‚Üí Œ≤
  2 # Œ≤
  3 define(‚ü¶ERROR‚üß, ‚ü¶
  4 
  5 	divert(0)dnl
  6 echo '$2'
  7 divert(-1)
  8 ‚üß)
  9 
 10 # A ‚Üí Œ≤
 11 define(‚ü¶QUERY‚üß, defn(‚ü¶ERROR‚üß))
 12 define(‚ü¶WARNING‚üß, defn(‚ü¶ERROR‚üß))
 13 
 14 divert(0)dnl
 15 #!/bin/bash
 16 #
 17 ‚ü¶#‚üß DONTE()
 18 
 19 divert(-1)

$ m4 root0u.m4 apost.sh.m4 apost.m4 messages.mc > apost.sh

5964776 messages/apost.sh
  1 #!/bin/bash
  2 #
  3 # DO NOT EDIT! This file is generated automatically!
  4 
  5 echo '!"#$%&'\''()*+,-./:;<=>?@[\]^_`{|}~'
  6 echo 'Is badly written M4 code readable [N/y]?'
  7 echo 'Too complex M4 code failed successfully.'
  8 echo 'Programming in M4 is addictive!'
  9 echo 'It'\''s not a language fault!'
 10 echo 'No other errors were found.'

B P≈ô√≠klady preprocesoru
üõà Znaky {`', [], ‚êÇ‚êÜ, ‚ü¶‚üß} v n√°zvu p≈ô√≠kladu ≈ô√≠d√≠ expanzi netermin√°l≈Ø.

	B.1 `' Preprocesor jazyka C a M4
	B.2 `' CSS: vlo≈æen√≠ souboru, koment√°≈ô
	B.3 ‚êÇ‚êÜ Bash: netisknuteln√© znaky

B.1 `' Preprocesor jazyka C a M4
Direktivy CPP jsou pro M4 jedno≈ô√°dkov√Ω koment√°≈ô, co≈æ br√°n√≠ ne≈æ√°douc√≠ expanzi stejnƒõ pojmenovan√Ωch maker.
Definujeme-li bezpeƒçnƒõj≈°√≠ makro SAF(), stejnƒõ pojmenovan√© makro SAF () nebude p≈ôeps√°no.
Jmenn√Ω prostor CPP tak m≈Ø≈æe b√Ωt zcela oddƒõlen od jmenn√©ho prostoru M4.
Problematick√Ω znak ` je skryt do makra LL().
Apostrof ' ve zdrojov√©m k√≥du niƒçemu nevad√≠.
Apostrof uvnit≈ô makra ORD() je skryt do makra RR().
V≈°imnƒõte si jmen funkc√≠ define () nebo ifelse () a kde je expandov√°n SYMBOL.

b53eafe preproc/file.c.m4
  1 # ORDinary and SAFe macros have different expansion:
  2 
  3 # A ‚Üí Œ≤
  4 define(`ORD', `$0_M4 RR()SYMBOL`'RR()')
  5 define(`SAF', `ifelse(`$#', `0', ``$0'', `($1) * ($1)	/* $0_M4 SYMBOL */')')
  6 
  7 divert(0)dnl

b53eafe preproc/file.c
  1 /*
  2  * DONTE()
  3  */
  4 
  5 #include <stdio.h>	/* CPP SYMBOL */
  6 
  7 #define SYMBOL		/* CPP SYMBOL */
  8 #define SAF(x)		((x) * ((x) - 1))	/* CPP SYMBOL */
  9 #define ORD(x)		CPP SYMBOL x
 10 
 11 int a = SAF (1 + 1);	/* CPP */
 12 int b = SAF(2 + 2);	/* M4 */
 13 char chr = 'x';
 14 char foo[] = "Let's say: 'SYMBOL'";
 15 char bar[] = "ORD (args, are, ignored)";
 16 
 17 static void define (char *s) { puts(s);}
 18 static void ifelse (char *s) { puts(s);}
 19 
 20 int main(void)
 21 {
 22 
 23 #ifdef SYMBOL			/* SYMBOL */
 24 	puts("LL()SYMBOL'");	/* note: `LL()SYMBOL' */
 25 #endif
 26 
 27 	define (foo);		/* SYMBOL */
 28 	ifelse (bar);		/* SYMBOL() */
 29 
 30 	return 0;
 31 }

$ m4 -DSYMBOL='Hello, world!' root0q.m4 file.c.m4 file.c > preproc.file.c

b53eafe preproc/preproc.file.c
  1 /*
  2  * DO NOT EDIT! This file is generated automatically!
  3  */
  4 
  5 #include <stdio.h>	/* CPP SYMBOL */
  6 
  7 #define SYMBOL		/* CPP SYMBOL */
  8 #define SAF(x)		((x) * ((x) - 1))	/* CPP SYMBOL */
  9 #define ORD(x)		CPP SYMBOL x
 10 
 11 int a = SAF (1 + 1);	/* CPP */
 12 int b = (2 + 2) * (2 + 2)	/* SAF_M4 Hello, world! */;	/* M4 */
 13 char chr = 'x';
 14 char foo[] = "Let's say: 'Hello, world!'";
 15 char bar[] = "ORD_M4 'Hello, world!' (args, are, ignored)";
 16 
 17 static void define (char *s) { puts(s);}
 18 static void ifelse (char *s) { puts(s);}
 19 
 20 int main(void)
 21 {
 22 
 23 #ifdef SYMBOL			/* SYMBOL */
 24 	puts("`Hello, world!'");	/* note: LL()SYMBOL */
 25 #endif
 26 
 27 	define (foo);		/* Hello, world! */
 28 	ifelse (bar);		/* Hello, world! */
 29 
 30 	return 0;
 31 }

B.2 `' CSS: vlo≈æen√≠ souboru, koment√°≈ô
CSS pou≈æ√≠v√° znak # pro k√≥dy barev, co≈æ je tak√© zaƒç√°tek jedno≈ô√°dkov√©ho M4 koment√°≈ôe.
Kl√≠ƒçov√© slovo changecom(/*,*/) nastav√≠ v√≠ce≈ô√°dkov√Ω koment√°≈ô /* ‚Ä¶ */ a p≈ôep√≠≈°e se na Œµ.
Koment√°≈ôe se vyp√≠naj√≠ stejn√Ωm kl√≠ƒçov√Ωm slovem changecom bez parametr≈Ø.

9e13656 preproc/foo.css
  1 .foo {
  2 	border: WIDTH 2px 1px;
  3 }

9e13656 preproc/file.css.m4
  1 # CSS preprocessor
  2 
  3 define(`WIDTH', `3px')
  4 define(`TOP', `#f00')
  5 define(`SIDES', `#0f0')
  6 define(`BOTTOM', `#00f')
  7 define(`SITE', `www.root.cz')
  8 define(`IMAGE', `m4tux.png')
  9 define(`PATH', `https://SITE/IMAGE')
 10 
 11 divert(0)dnl

3ed8f6a preproc/file.css
  1 /* DONTE() */changecom(/*,*/)
  2 /* DONTE() */
  3 
  4 include(`foo.css')dnl
  5 
  6 .bar {
  7 	border-width: WIDTH;
  8 	border-color: TOP SIDES BOTTOM;
  9 	background-image: url('PATH');
 10 }
 11 
 12 /* DONTE() */
 13 changecom/* DONTE() */changecom(/*,*/)

$ m4 -DSYMBOL='Hello, world!' root0q.m4 file.css.m4 file.css > preproc.file.css

41542d1 preproc/preproc.file.css
  1 /* DO NOT EDIT! This file is generated automatically! */
  2 /* DONTE() */
  3 
  4 .foo {
  5 	border: 3px 2px 1px;
  6 }
  7 
  8 .bar {
  9 	border-width: 3px;
 10 	border-color: #f00 #0f0 #00f;
 11 	background-image: url('https://www.root.cz/m4tux.png');
 12 }
 13 
 14 /* DONTE() */
 15 /* DO NOT EDIT! This file is generated automatically! */

B.3 ‚êÇ‚êÜ Bash: netisknuteln√© znaky
Bash pou≈æ√≠v√° oba znaky, ` a [.
Nechceme-li je skr√Ωvat do makra LL(), m≈Ø≈æeme pou≈æ√≠t pro ≈ô√≠zen√≠ expanze netermin√°l≈Ø netisknuteln√© znaky, viz. p≈ô√≠klad:

b53eafe preproc/file.sh.m4
  1 # vim:mps+=‚êÇ\:‚êÜ
  2 
  3 # A ‚Üí Œ≤
  4 define(‚êÇLEFT‚êÜ, ‚êÇ$‚êÇ#‚êÜ‚êÜ)
  5 define(‚êÇOP‚êÜ, ‚êÇ-eq‚êÜ)
  6 define(‚êÇRIGHT‚êÜ, ‚êÇ0‚êÜ)
  7 
  8 divert(0)dnl

b53eafe preproc/file.sh
  1 #!/bin/bash
  2 #
  3 ‚êÇ#‚êÜ DONTE()
  4 
  5 HELLO=`echo 'SYMBOL'`
  6 
  7 if [[ LEFT OP RIGHT ]]
  8 then
  9 	echo $HELLO
 10 fi

$ m4 -DSYMBOL='Hello, world!' root0n.m4 file.sh.m4 file.sh > preproc.file.sh

b53eafe preproc/preproc.file.sh
  1 #!/bin/bash
  2 #
  3 # DO NOT EDIT! This file is generated automatically!
  4 
  5 HELLO=`echo 'Hello, world!'`
  6 
  7 if [[ $# -eq 0 ]]
  8 then
  9 	echo $HELLO
 10 fi

C M4: p≈ô√≠klady
üõà Znaky {`', [], ‚êÇ‚êÜ, ‚ü¶‚üß} v n√°zvu p≈ô√≠kladu ≈ô√≠d√≠ expanzi netermin√°l≈Ø.

	C.1 [] JSON: lev√° z√°vorka [
	C.2 [] Bash: poƒç√≠tadla
	C.3 [] .h: z√°vorky [], [,], [#], [dnl]
	C.4 [] AWK: p≈ô√≠klady bezpeƒçnƒõj≈°√≠ch maker

C.1 [] JSON: lev√° z√°vorka [
Uvnit≈ô hranat√Ωch z√°vorek [‚Ä¶ se netermin√°ly neexpanduj√≠ ‚Ä¶].
Proto je lev√° hranat√° z√°vorka [ nahrazena makrem LL() z ko≈ôenov√©ho souboru.

39013f2 hello_world/json.m4
  1 # JSON
  2 
  3 divert(0)dnl
  4 {"foo": {
  5 	"_comment": "DONTE()",
  6 	"bar": LL()
  7 		{"baz": "SYMBOL"}
  8 	]
  9 }}

$ m4 -DSYMBOL='Hello, world!' root0b.m4 json.m4 > hello_world.json

b53eafe hello_world/hello_world.json
  1 {"foo": {
  2 	"_comment": "DO NOT EDIT! This file is generated automatically!",
  3 	"bar": [
  4 		{"baz": "Hello, world!"}
  5 	]
  6 }}

C.2 [] Bash: poƒç√≠tadla
Poƒç√≠tadla COUNT_UP a COUNT_DOWN jsou definov√°na v souboru countb.m4.
Netermin√°ly [‚Ä¶ uvnit≈ô z√°vorek ‚Ä¶] nebudou expandov√°ny, pouze se odeberou vnƒõj≈°√≠ z√°vorky.
Nutno pou≈æ√≠t makro LL() z ko≈ôenov√©ho souboru.

39013f2 hello_world/sh.m4
  1 # A ‚Üí Œ≤
  2 define([LEFT], [$[#]])
  3 define([OP], [-eq])
  4 define([RIGHT], [0])
  5 
  6 # define two counters
  7 # A ‚Üí Œ≤
  8 define([__COUNTUP__], defn([COUNT_UP]))
  9 define([__COUNTDN__], defn([COUNT_DOWN]))
 10 
 11 # init counters
 12 __COUNTUP__(10)
 13 __COUNTDN__(10)
 14 
 15 divert(0)dnl
 16 #!/bin/bash
 17 #
 18 [#] DONTE()
 19 
 20 if [ LEFT OP RIGHT ]
 21 then
 22 	echo '__COUNTUP__] SYMBOL LL()__COUNTDN__'
 23 fi
 24 
 25 if test LEFT OP RIGHT
 26 then
 27 	echo '__COUNTUP__] SYMBOL LL()__COUNTDN__'
 28 fi
 29 
 30 if LL()LL() LEFT OP RIGHT ]]
 31 then
 32 	echo '__COUNTUP__] SYMBOL LL()__COUNTDN__'
 33 fi

$ m4 -DSYMBOL='Hello, world!' root0u.m4 countb.m4 sh.m4 > hello_world.sh

b53eafe hello_world/hello_world.sh
  1 #!/bin/bash
  2 #
  3 # DO NOT EDIT! This file is generated automatically!
  4 
  5 if  LEFT OP RIGHT 
  6 then
  7 	echo '10] Hello, world! [10'
  8 fi
  9 
 10 if test $# -eq 0
 11 then
 12 	echo '11] Hello, world! [9'
 13 fi
 14 
 15 if [[ $# -eq 0 ]]
 16 then
 17 	echo '12] Hello, world! [8'
 18 fi

C.3 [] .h: z√°vorky [], [,], [#], [dnl]
Pr√°zdn√Ω p√°r [] (nebo pr√°zdn√Ω symbol v z√°vork√°ch [Œµ]) slou≈æ√≠ jako oddƒõlovaƒç symbol≈Ø.
Z√°vorky kolem znaku koment√°≈ôe [#] vypnou jeho p≈Øvodn√≠ v√Ωznam, stejnƒõ jako vypnou v√Ωznam silnƒõj≈°√≠ho M4 koment√°≈ôe
[dnl].
Vypnou tak√© p≈Øvodn√≠ v√Ωznam ƒç√°rky [,] jako oddƒõlovaƒçe argument≈Ø maker.
Tyto symboly se stanou obyƒçejn√Ωmi termin√°ln√≠mi symboly bez jak√©hokoliv vedlej≈°√≠ho efektu.

ce5cd99 hello_world/h.m4
  1 # A ‚Üí Œ≤
  2 define([HELLO], [HELLO_WORLD])
  3 
  4 divert(0)dnl
  5 /*
  6  * [dnl] DONTE()
  7  */
  8 
  9 [#]ifndef __[]HELLO[]_H
 10 [#]define __[]HELLO[]_H
 11 
 12 [#]define HELLO	SYMBOL
 13 
 14 [#]endif /* __[]HELLO[]_H */

$ m4 -DSYMBOL='Hello, world!' root0b.m4 h.m4 > hello_world.h

6b10c6c hello_world/hello_world.h
  1 /*
  2  * dnl DO NOT EDIT! This file is generated automatically!
  3  */
  4 
  5 #ifndef __HELLO_WORLD_H
  6 #define __HELLO_WORLD_H
  7 
  8 #define HELLO_WORLD	Hello, world!
  9 
 10 #endif /* __HELLO_WORLD_H */

C.4 [] AWK: p≈ô√≠klady bezpeƒçnƒõj≈°√≠ch maker
Univerz√°ln√≠ v√Ωstraha DONTE se ignoruje bez z√°vorek, stejnƒõ jako LL, RR, ‚Ä¶
Takov√° makra explicitnƒõ vytv√°≈ô√≠ v√Ωvoj√°≈ô skript≈Ø, prohl√©dnƒõte si ko≈ôenov√Ω soubor root1b.m4.

39013f2 hello_world/awk.m4
  1 # AWK
  2 
  3 divert(0)dnl
  4 #!/bin/awk -f
  5 #
  6 [# DONTE()] ---> "DONTE()"
  7 
  8 BEGIN { print "DONTE[]() LL () LL() SYMBOL ]" }

$ m4 -DSYMBOL='Hello, world!' root1b.m4 awk.m4 > hello_world.awk

39013f2 hello_world/hello_world.awk
  1 #!/bin/awk -f
  2 #
  3 # DONTE() ---> "DO NOT EDIT! This file is generated automatically!"
  4 
  5 BEGIN { print "DONTE() LL () LL() Hello, world! ]" }

D Proƒç pou≈æ√≠vat M4 a proƒç ne?
	D.1 üëç Proƒç generovat k√≥d v M4
	D.2 üëé Proƒç se vyhnout M4

D.1 üëç Proƒç generovat k√≥d v M4
‚Ä¢ p≈ô√≠m√© pou≈æit√≠ bezkontextov√© gramatiky (rekurze zdarma)
	‚Ä¢ pro transformaci dat staƒç√≠ napsat minimum M4 k√≥du
‚Ä¢ p≈ô√≠m√© pou≈æit√≠ automat≈Ø
	‚Ä¢ mo≈ænost vymodelovat si pot≈ôebn√© algoritmy (M4 nepot≈ôebuje verze)
‚Ä¢ p≈ô√≠m√© pou≈æit√≠ z√°sobn√≠k≈Ø
	‚Ä¢ z√°sobn√≠ky propojen√© s automaty roz≈°i≈ôuj√≠ mo≈ænosti gener√°toru k√≥du
‚Ä¢ p≈ô√≠m√© pou≈æit√≠ v√Ωstupn√≠ch front pro doƒçasn√© ulo≈æen√≠ v√Ωsledn√Ωch ƒç√°st√≠ k√≥du
	‚Ä¢ jednotliv√© fronty jsou na z√°vƒõr vyps√°ny na v√Ωstup ve vzestupn√©m po≈ôad√≠
‚Ä¢ v√Ωraznƒõ vy≈°≈°√≠ rychlost generov√°n√≠ k√≥du (ve srovn√°n√≠ s XSLT)
	‚Ä¢ n√≠zk√© n√°roky na v√Ωpoƒçetn√≠ zdroje

D.2 üëé Proƒç se vyhnout M4
‚Ä¢ univerz√°ln√≠ jazyk n√≠zk√© √∫rovnƒõ (podobnƒõ jako jazyk C)
	‚Ä¢ co≈æ v√Ωmƒõnou poskytuje ohromnou flexibilitu jako UNIX
‚Ä¢ t√©mƒõ≈ô neexistuj√≠c√≠ komunita v√Ωvoj√°≈ô≈Ø (podzim 2019)
	‚Ä¢ M4 je zapomenut√Ω jazyk, m√°lo existuj√≠c√≠ch projekt≈Ø
‚Ä¢ neobvykl√© programovac√≠ paradigma vy≈æaduj√≠c√≠ splnƒõn√≠ nƒõkolika p≈ôedpoklad≈Ø
	‚Ä¢ pr√°vƒõ proto lze M4 pova≈æovat za n√°roƒçn√Ω jazyk
‚Ä¢ produktivita znaƒçnƒõ z√°vis√≠ na zku≈°enostech (mo≈æn√Ω probl√©m s term√≠ny)
	‚Ä¢ psan√≠ M4 skript≈Ø vy≈æaduje z√°kladn√≠ znalost automat≈Ø a gramatik
‚Ä¢ √∫dr≈æba ≈°patnƒõ napsan√©ho M4 k√≥du nen√≠ jednoduch√°
	‚Ä¢ existuj√≠c√≠ M4 k√≥d je snadn√© promƒõnit ve zmatek (nutn√Ω dohled!)

